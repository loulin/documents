# 五步法Plus - 智能学习CGM分析系统

## 📋 项目概述

五步法Plus是基于原有五步法CGM分析系统的升级版本，增加了**智能学习功能**。系统通过收集医生对AI建议的修改，不断优化和学习，提供更符合临床实践的CGM分析报告。

### 🚀 核心特性

- **🧠 智能学习**: 通过医生反馈持续优化AI建议
- **✏️ 富文本编辑**: 直观的报告编辑界面
- **📊 修改追踪**: 详细记录所有修改历史
- **👨‍⚕️ 个性化适配**: 学习不同医生的临床偏好
- **📈 学习分析**: 深度分析修改模式和趋势

### 🎯 系统优势

1. **持续优化**: 每次医生修改都让系统更智能
2. **个性化服务**: 适应不同医生的临床习惯  
3. **专业提升**: 减少重复性修改工作
4. **知识积累**: 建立可复用的专家经验库

## 🛠️ 安装与使用

### 快速启动

```bash
# 1. 进入项目目录
cd /path/to/5Steps/

# 2. 一键启动系统
python start_five_steps_plus.py
```

启动脚本会自动：
- ✅ 检查并安装依赖包
- ✅ 验证系统文件完整性  
- ✅ 创建默认配置文件
- ✅ 启动Web服务器
- ✅ 自动打开浏览器

### 手动安装依赖

```bash
pip install flask flask-cors pandas openpyxl
```

### 系统要求

- **Python**: 3.7 或更高版本
- **浏览器**: Chrome/Firefox/Edge 现代浏览器
- **内存**: 建议 4GB 以上
- **存储**: 至少 100MB 空闲空间

## 📖 使用指南

### 第一步：启动系统
```bash
python start_five_steps_plus.py
```

### 第二步：访问界面
在浏览器中打开：`http://localhost:5000`

### 第三步：分析CGM数据
1. **上传数据**: 选择Excel或CSV格式的CGM数据文件
2. **或使用示例**: 点击"使用示例数据"快速体验
3. **开始分析**: 点击"开始AI分析"

### 第四步：编辑报告
1. **查看AI建议**: 在右侧富文本编辑器中查看AI生成的报告
2. **修改内容**: 根据临床经验修改建议内容
3. **实时记录**: 系统自动记录所有修改

### 第五步：保存学习
1. **保存报告**: 点击"保存最终报告"
2. **记录反馈**: 系统记录修改用于学习优化
3. **生成报告**: 导出最终的专业报告

## 🏗️ 系统架构

```
五步法Plus系统架构
├── 前端界面 (HTML + JavaScript)
│   ├── 富文本编辑器 (Quill.js)
│   ├── 文件上传组件
│   └── 实时修改追踪
├── 后端API (Flask)
│   ├── CGM数据分析
│   ├── 报告生成
│   └── 反馈收集
├── 学习引擎
│   ├── 修改模式分析
│   ├── 参数优化
│   └── 个性化适配
└── 数据存储
    ├── 反馈数据库 (JSON)
    ├── 配置文件
    └── 临时文件处理
```

## 📁 文件结构

```
5Steps/
├── 📄 README_five_steps_plus.md          # 项目说明文档
├── 🚀 start_five_steps_plus.py           # 一键启动脚本
├── 🌐 five_steps_plus_interactive.html   # Web交互界面
├── ⚙️ five_steps_plus_server.py          # Flask后端服务
├── 📊 learning_analyzer.py               # 学习分析引擎
├── 🧮 run_report_layered_assessment.py   # 五步法分析核心
├── ⚙️ 5Steps.json                        # 系统配置文件
├── 📋 feedback_database.json             # 反馈数据库
└── 📋 five_steps_plus_design.md          # 系统设计文档
```

## 🎨 界面功能详解

### 左侧面板 - 数据分析区
- **📊 文件上传**: 支持 .xlsx 和 .csv 格式
- **👤 患者信息**: 显示患者基本信息
- **⏳ 分析状态**: 实时显示分析进度
- **📝 修改记录**: 追踪所有编辑历史

### 右侧面板 - 报告编辑区
- **✏️ 富文本编辑器**: 专业的报告编辑界面
- **📋 格式工具**: 支持粗体、斜体、列表等格式
- **👀 实时预览**: 即时查看报告效果
- **💾 保存功能**: 保存最终报告和修改记录

## 🧠 学习功能详解

### 双层学习架构
系统采用基础学习+增强学习的双层架构：

#### 🔧 基础学习引擎 (立即可用)
- **修改记录分析**: 完整记录所有医生修改行为
- **用词替换统计**: 识别医生偏好的专业术语
- **修改模式识别**: 分析内容结构和临床判断变化
- **医生画像构建**: 学习不同医生的编辑习惯

#### 🚀 增强学习引擎 (生产级)
- **高级文本分析**: 使用difflib进行精确差异检测
- **语义相似度分析**: 基于医学术语的智能匹配
- **自适应报告生成**: 根据学习模式生成个性化建议
- **学习效果评估**: 量化分析系统优化效果

### 智能优化流程
1. **数据收集**: 记录医生每次修改的详细信息
2. **模式分析**: 提取用词偏好、临床判断、结构调整等模式
3. **自适应生成**: 基于学习模式生成符合医生偏好的报告
4. **效果评估**: 监测修改频率变化，评估学习效果

### 学习算法状态

| 功能模块 | 状态 | 说明 |
|---------|------|------|
| 修改记录收集 | ✅ 完全可用 | 生产就绪，立即可用 |
| 基础模式识别 | ✅ 完全可用 | 用词替换、医生偏好分析 |
| 高级文本分析 | 🔧 需要训练 | 算法完整，需要真实数据训练 |
| 自适应报告生成 | 🔧 需要训练 | 框架完整，随使用时间提升 |
| 学习效果评估 | ✅ 完全可用 | 可量化评估优化效果 |

### 使用学习功能
```bash
# 基础学习分析
python learning_analyzer.py

# 增强学习分析和模型导出
python enhanced_learning_engine.py

# 启动服务器（自动加载增强学习引擎）
python start_five_steps_plus.py
```

## 🔧 配置选项

### 5Steps.json 配置文件
```json
{
  "strict": {
    "tir_excellent": 90,
    "tir_good": 80,
    "tir_acceptable": 70,
    "tbr_safe": 1,
    "tbr_acceptable": 4
  },
  "lenient": {
    "tir_good": 70,
    "tir_acceptable": 50,
    "tbr_safe": 4,
    "tbr_acceptable": 10
  },
  "assessment_rules": {
    "hypoglycemia_priority": true,
    "safety_first": true,
    "age_adjustment": false
  }
}
```

### API端点
- **POST** `/api/analyze` - 分析CGM数据
- **POST** `/api/save_feedback` - 保存修改反馈
- **GET** `/api/stats` - 获取学习统计（包含增强分析）
- **POST** `/api/generate_adaptive_report` - 生成自适应报告
- **GET** `/api/export_learning_model` - 导出学习模型

## 📊 使用示例

### 示例1：分析标准CGM数据
1. 上传14天CGM数据文件
2. AI生成包含五个步骤的分析报告
3. 医生修改"需要强化生活方式管理"为"建议优化运动方案"
4. 系统记录此修改偏好，用于未来类似情况

### 示例2：个性化学习
1. 医生A经常将"血糖控制欠佳"改为"血糖管理待优化"
2. 系统学习后，为医生A自动生成含有"待优化"表述的报告
3. 减少重复修改工作，提高效率

## 🚨 注意事项

### 数据隐私
- 所有患者数据仅在本地处理
- 反馈数据可选择性脱敏存储
- 符合医疗数据安全规范

### 系统限制
- 当前版本支持中文界面
- 建议Chrome/Firefox浏览器
- 大文件分析可能需要较长时间

### 故障排除
```bash
# 检查系统状态
python start_five_steps_plus.py --check-only

# 重新安装依赖
python start_five_steps_plus.py --install-deps

# 查看详细错误信息
python five_steps_plus_server.py
```

## 📈 版本历史

### v1.0 (当前版本)
- ✅ 基础富文本编辑界面
- ✅ 修改记录和反馈收集
- ✅ 学习分析引擎
- ✅ 一键启动脚本

### 计划功能 (v1.1)
- 🔄 实时协作编辑
- 📊 可视化学习报告
- 🔗 HIS系统集成
- 🌐 多语言支持

## 🤝 贡献指南

欢迎贡献代码和建议！
1. Fork 项目
2. 创建功能分支
3. 提交更改
4. 发起 Pull Request

## 📞 技术支持

如遇问题请检查：
1. **依赖安装**: 确保所有依赖包正确安装
2. **文件完整**: 验证所有系统文件存在
3. **端口冲突**: 确保5000端口未被占用
4. **浏览器支持**: 使用现代浏览器访问

---

**五步法Plus** - 让AI更懂临床，让临床更智能！ 🚀