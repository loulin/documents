# ç”¨è¯è¯¦æƒ…å½•å…¥é€»è¾‘è®¾è®¡

## ğŸ“‹ é€‚ç”¨èŒƒå›´

ä»D2Aåˆ°H7æ‰€æœ‰æ¶‰åŠç”¨è¯çš„ç–¾ç—…ï¼ŒåŒ…æ‹¬ï¼š

### ç³–å°¿ç—…å¹¶å‘ç—‡ï¼ˆD2A-D2D3ï¼‰
- **D2A2A**ï¼šç³–å°¿ç—…è‚¾ç—…ç”¨è¯è¯¦æƒ…
- **D2B2A**ï¼šç³–å°¿ç—…è§†ç½‘è†œç—…å˜ç”¨è¯è¯¦æƒ…  
- **D2C2A**ï¼šç³–å°¿ç—…å‘¨å›´ç¥ç»ç—…å˜ç”¨è¯è¯¦æƒ…

### å…¶ä»–ç–¾ç—…å²ï¼ˆH1-H7ï¼‰
- **H1B1**ï¼šé«˜è¡€å‹ç”¨è¯è¯¦æƒ…
- **H2B1**ï¼šå† å¿ƒç—…ç”¨è¯è¯¦æƒ…
- **H3C1**ï¼šå¿ƒå¾‹å¤±å¸¸ç”¨è¯è¯¦æƒ…
- **H4B1**ï¼šè¡€è„‚å¼‚å¸¸ç”¨è¯è¯¦æƒ…
- **H5B1**ï¼šé«˜å°¿é…¸è¡€ç—‡ç”¨è¯è¯¦æƒ…
- **H6B1**ï¼šè„‘æ¢—ç”¨è¯è¯¦æƒ…
- **H7B1**ï¼šè„‘å‡ºè¡€ç”¨è¯è¯¦æƒ…

## ğŸ”„ å½•å…¥æµç¨‹è®¾è®¡

### ç¬¬ä¸€æ­¥ï¼šç–¾ç—…è¯Šæ–­ç¡®è®¤
```
é—®é¢˜ï¼šæ˜¯å¦æ‚£æœ‰ç³–å°¿ç—…è‚¾ç—…ï¼Ÿ
é€‰é¡¹ï¼šâ–¡ æœ‰  â–¡ æ— 

å¦‚æœé€‰æ‹©"æœ‰" â†“
  è¯Šæ–­å¹´ä»½ï¼š[____] å¹´
```

### ç¬¬äºŒæ­¥ï¼šç”¨è¯çŠ¶æ€åˆ¤æ–­
```
é—®é¢˜ï¼šç³–å°¿ç—…è‚¾ç—…æ˜¯å¦ç”¨è¯ï¼Ÿ
é€‰é¡¹ï¼šâ–¡ æ˜¯  â–¡ å¦

å¦‚æœé€‰æ‹©"å¦" â†’ è·³è¿‡ç”¨è¯è¯¦æƒ…ï¼Œè¿›å…¥ä¸‹ä¸€ä¸ªç–¾ç—…
å¦‚æœé€‰æ‹©"æ˜¯" â†’ è¿›å…¥ç”¨è¯è¯¦æƒ…å½•å…¥
```

### ç¬¬ä¸‰æ­¥ï¼šç”¨è¯è¯¦æƒ…å½•å…¥ç•Œé¢
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
        ç³–å°¿ç—…è‚¾ç—…ç”¨è¯è¯¦æƒ…å½•å…¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å½“å‰å·²æ·»åŠ ç”¨è¯ï¼š0ç§

[+ æ·»åŠ ç¬¬1ç§ç”¨è¯]

â”Œâ”€ ç¬¬1ç§ç”¨è¯ä¿¡æ¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¯å“é€šç”¨åï¼š[æœç´¢ä¸‹æ‹‰æ¡†] â–¼             â”‚
â”‚             [é˜¿å¸åŒ¹æ—             ]  â”‚
â”‚                                       â”‚
â”‚ å•†å“åï¼š    [æ‹œé˜¿å¸åŒ¹æ—        ] (å¯é€‰) â”‚
â”‚                                       â”‚
â”‚ è§„æ ¼ï¼š      [ä¸‹æ‹‰é€‰æ‹©] â–¼               â”‚
â”‚             100mg/ç‰‡                  â”‚
â”‚                                       â”‚
â”‚ å•æ¬¡å‰‚é‡ï¼š  [100] [mg] â–¼              â”‚
â”‚                                       â”‚
â”‚ æœç”¨é¢‘æ¬¡ï¼š  [ä¸‹æ‹‰é€‰æ‹©] â–¼               â”‚
â”‚             æ¯æ—¥1æ¬¡                   â”‚
â”‚                                       â”‚
â”‚ ç»™è¯é€”å¾„ï¼š  [ä¸‹æ‹‰é€‰æ‹©] â–¼               â”‚
â”‚             å£æœ                      â”‚
â”‚                                       â”‚
â”‚ å¼€å§‹ç”¨è¯ï¼š  [2023]-[01]-[15] (å¯é€‰)   â”‚
â”‚ åœè¯æ—¥æœŸï¼š  [____]-[__]-[__] (å¯é€‰)   â”‚
â”‚                                       â”‚
â”‚ â˜‘ ç›®å‰ä»åœ¨ä½¿ç”¨                       â”‚
â”‚                                       â”‚
â”‚ ç”¨è¯æ•ˆæœï¼š  [ä¸‹æ‹‰é€‰æ‹©] â–¼               â”‚
â”‚             æœ‰æ•ˆ                      â”‚
â”‚                                       â”‚
â”‚ ä¸è‰¯ååº”ï¼š  â–¡ æ—   â˜‘ èƒƒè‚ ä¸é€‚          â”‚
â”‚             â–¡ å…¶ä»–: ____________      â”‚
â”‚                                       â”‚
â”‚ å¤‡æ³¨ï¼š      [____________________]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[ä¿å­˜ç¬¬1ç§ç”¨è¯]  [å–æ¶ˆ]

â”Œâ”€ ç»§ç»­æ·»åŠ ç”¨è¯ï¼Ÿ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                   â”‚
â”‚  æ˜¯å¦è¿˜æœ‰å…¶ä»–ç³–å°¿ç—…è‚¾ç—…ç”¨è¯ï¼Ÿ        â”‚
â”‚                                   â”‚
â”‚  [+ æ·»åŠ ä¸‹ä¸€ç§ç”¨è¯]  [å½•å…¥å®Œæˆ]      â”‚
â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¬¬å››æ­¥ï¼šå¤šè¯ç‰©å¾ªç¯å½•å…¥
```
å½“å‰å·²æ·»åŠ ç”¨è¯ï¼š1ç§
  1. é˜¿å¸åŒ¹æ— 100mg/ç‰‡ï¼Œæ¯æ—¥1æ¬¡ï¼Œå£æœ

[+ æ·»åŠ ç¬¬2ç§ç”¨è¯]

ï¼ˆé‡å¤ç¬¬3æ­¥çš„å½•å…¥ç•Œé¢ï¼Œåºå·é€’å¢ï¼‰
```

### ç¬¬äº”æ­¥ï¼šå®Œæˆç¡®è®¤
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
      ç³–å°¿ç—…è‚¾ç—…ç”¨è¯è¯¦æƒ…å½•å…¥å®Œæˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… å·²å½•å…¥ 2 ç§ç”¨è¯ï¼š
  1. é˜¿å¸åŒ¹æ— 100mg/ç‰‡ï¼Œæ¯æ—¥1æ¬¡ï¼Œå£æœ
  2. å„è´æ²™å¦ 150mg/ç‰‡ï¼Œæ¯æ—¥1æ¬¡ï¼Œå£æœ

[ä¿®æ”¹ç”¨è¯ä¿¡æ¯]  [ç¡®è®¤å®Œæˆ]

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ç»§ç»­å½•å…¥ä¸‹ä¸€ä¸ªç–¾ç—…...
```

## ğŸ’» æ•°æ®åº“è®¾è®¡

### 1. ä¸»è¡¨å­—æ®µï¼ˆå¦‚diabetes_complicationsï¼‰
```sql
-- æ˜¯å¦ç”¨è¯å­—æ®µ
nephropathy_medication BOOLEAN  -- æ˜¯å¦ç”¨è¯

-- ç”¨è¯è¯¦æƒ…å…³è”å­—æ®µï¼ˆJSONæ ¼å¼å­˜å‚¨medication_idåˆ—è¡¨ï¼‰
nephropathy_medication_details JSON  -- å…³è”medication_listè¡¨çš„è®°å½•ID
-- ç¤ºä¾‹å€¼: ["med_001", "med_002"]
```

### 2. ç”¨è¯æ¸…å•è¡¨ï¼ˆmedication_listï¼‰
```sql
-- åŸºç¡€å…³è”ä¿¡æ¯
medication_id VARCHAR(32)      -- ä¸»é”®
patient_id VARCHAR(32)         -- æ‚£è€…ID
medication_category TINYINT    -- ç”¨è¯åˆ†ç±»ï¼ˆ2=ç³–å°¿ç—…è‚¾ç—…ç”¨è¯ï¼‰
source_table VARCHAR(50)       -- æ¥æºè¡¨ï¼ˆdiabetes_complicationsï¼‰  
source_field VARCHAR(50)       -- æ¥æºå­—æ®µï¼ˆnephropathy_medication_detailsï¼‰

-- è¯¦ç»†ç”¨è¯ä¿¡æ¯
drug_name VARCHAR(100)         -- è¯å“é€šç”¨å
brand_name VARCHAR(100)        -- å•†å“å
specification VARCHAR(50)      -- è§„æ ¼
dosage_amount DECIMAL(8,2)     -- å•æ¬¡å‰‚é‡
dosage_unit VARCHAR(20)        -- å‰‚é‡å•ä½
frequency TINYINT              -- æœç”¨é¢‘æ¬¡
administration_route TINYINT   -- ç»™è¯é€”å¾„

-- æ—¶é—´ç®¡ç†
start_date DATE                -- å¼€å§‹ç”¨è¯æ—¥æœŸ
end_date DATE                  -- åœè¯æ—¥æœŸ
is_current BOOLEAN             -- æ˜¯å¦ç›®å‰åœ¨ç”¨

-- æ•ˆæœè¯„ä¼°
therapeutic_effect TINYINT     -- æ²»ç–—æ•ˆæœ
side_effects JSON              -- ä¸è‰¯ååº”
```

### 3. å…³è”å…³ç³»ç®¡ç†ï¼ˆmedication_associationsï¼‰
```sql
-- å»ºç«‹ç”¨è¯ä¸ç–¾ç—…çš„æ˜ç¡®å…³è”
association_id VARCHAR(32)     -- ä¸»é”®
patient_id VARCHAR(32)         -- æ‚£è€…ID
medication_id VARCHAR(32)      -- ç”¨è¯è®°å½•ID
source_table VARCHAR(50)       -- æ¥æºç–¾ç—…è¡¨
medication_purpose VARCHAR(100) -- ç”¨è¯ç›®çš„ï¼ˆå¦‚ï¼šç³–å°¿ç—…è‚¾ç—…æ²»ç–—ï¼‰
is_primary_treatment BOOLEAN   -- æ˜¯å¦ä¸»è¦æ²»ç–—è¯ç‰©
```

## ğŸ¯ æŠ€æœ¯å®ç°è¦ç‚¹

### 1. å‰ç«¯äº¤äº’é€»è¾‘
```javascript
// ä¼ªä»£ç 
function handleMedicationStatus(diseaseField, medicationField) {
  if (medicationField.value === true) {
    // æ˜¾ç¤ºç”¨è¯è¯¦æƒ…å½•å…¥ç•Œé¢
    showMedicationDetailsForm({
      diseaseType: diseaseField.name,
      onAddMedication: (medicationData) => {
        // ä¿å­˜åˆ°medication_listè¡¨
        saveMedicationToDatabase(medicationData);
        // æ›´æ–°å…³è”å­—æ®µçš„medication_details JSON
        updateMedicationDetailsField(diseaseField, medicationData.id);
        // æ˜¾ç¤ºç»§ç»­æ·»åŠ é€‰é¡¹
        showContinueAddingDialog();
      }
    });
  } else {
    // éšè—ç”¨è¯è¯¦æƒ…ï¼Œæ¸…ç©ºç›¸å…³æ•°æ®
    hideMedicationDetailsForm();
    clearMedicationDetailsField(diseaseField);
  }
}

function showContinueAddingDialog() {
  showDialog({
    message: "æ˜¯å¦è¿˜æœ‰å…¶ä»–ç”¨è¯éœ€è¦æ·»åŠ ï¼Ÿ",
    buttons: [
      { text: "æ·»åŠ ä¸‹ä¸€ç§ç”¨è¯", action: () => showNextMedicationForm() },
      { text: "å½•å…¥å®Œæˆ", action: () => completeMedicationEntry() }
    ]
  });
}
```

### 2. æ•°æ®ä¿å­˜é€»è¾‘
```javascript
// ä¿å­˜ç”¨è¯è¯¦æƒ…çš„å®Œæ•´æµç¨‹
async function saveMedicationDetails(diseaseTable, diseaseField, medications) {
  try {
    // 1. ä¿å­˜æ‰€æœ‰ç”¨è¯åˆ°medication_listè¡¨
    const medicationIds = [];
    for (let med of medications) {
      const medRecord = await saveMedication({
        ...med,
        medication_category: getMedicationCategory(diseaseField),
        source_table: diseaseTable,
        source_field: diseaseField + '_details'
      });
      medicationIds.push(medRecord.id);
      
      // 2. å»ºç«‹å…³è”å…³ç³»
      await saveMedicationAssociation({
        medication_id: medRecord.id,
        source_table: diseaseTable,
        medication_purpose: getMedicationPurpose(diseaseField),
        is_primary_treatment: med.isPrimary
      });
    }
    
    // 3. æ›´æ–°ç–¾ç—…è¡¨çš„medication_detailså­—æ®µ
    await updateDiseaseTable(diseaseTable, {
      [diseaseField + '_details']: JSON.stringify(medicationIds)
    });
    
  } catch (error) {
    console.error('ä¿å­˜ç”¨è¯è¯¦æƒ…å¤±è´¥:', error);
  }
}
```

### 3. æ•°æ®éªŒè¯è§„åˆ™
```javascript
const validationRules = {
  // å¿…å¡«å­—æ®µéªŒè¯
  required: ['drug_name', 'specification', 'dosage_amount', 'frequency', 'administration_route'],
  
  // æ¡ä»¶å¿…å¡«
  conditionalRequired: {
    'brand_name': null,  // å¯é€‰
    'contact_info': (data) => data.participate_project === true,  // å‚ä¸é¡¹ç›®æ—¶å¿…å¡«
    'end_date': (data) => data.is_current === false  // å·²åœè¯æ—¶å¿…å¡«åœè¯æ—¥æœŸ
  },
  
  // é€»è¾‘ä¸€è‡´æ€§
  consistency: {
    startDateBeforeEndDate: (data) => {
      if (data.start_date && data.end_date) {
        return new Date(data.start_date) <= new Date(data.end_date);
      }
      return true;
    }
  }
};
```

## ğŸ“Š ç»Ÿè®¡åˆ†ææ”¯æŒ

### 1. ç”¨è¯ç»Ÿè®¡æŸ¥è¯¢
```sql
-- æŒ‰ç–¾ç—…ç»Ÿè®¡ç”¨è¯æƒ…å†µ
SELECT 
  medication_category,
  COUNT(*) as medication_count,
  COUNT(DISTINCT patient_id) as patient_count
FROM medication_list 
WHERE source_table IN ('diabetes_complications', 'other_diseases')
GROUP BY medication_category;

-- åˆ†æå¸¸ç”¨è¯ç‰©ç»„åˆ
SELECT 
  source_field,
  drug_name,
  COUNT(*) as usage_count,
  AVG(therapeutic_effect) as avg_effectiveness
FROM medication_list ml
JOIN medication_associations ma ON ml.medication_id = ma.medication_id
GROUP BY source_field, drug_name
ORDER BY usage_count DESC;
```

### 2. ç”¨è¯ä¾ä»æ€§åˆ†æ
```sql
-- åˆ†æç”¨è¯ä¾ä»æ€§å’Œæ²»ç–—æ•ˆæœ
SELECT 
  medication_purpose,
  adherence_level,
  therapeutic_effect,
  COUNT(*) as case_count
FROM medication_list ml
JOIN medication_associations ma ON ml.medication_id = ma.medication_id
WHERE adherence_level IS NOT NULL
GROUP BY medication_purpose, adherence_level, therapeutic_effect
ORDER BY medication_purpose, adherence_level;
```

## ğŸ¨ ç”¨æˆ·ä½“éªŒä¼˜åŒ–

### 1. æ™ºèƒ½æç¤ºåŠŸèƒ½
- **è¯ç‰©æœç´¢**ï¼šæ”¯æŒé€šç”¨åã€å•†å“åçš„æ¨¡ç³Šæœç´¢
- **è§„æ ¼è”æƒ³**ï¼šæ ¹æ®é€‰æ‹©çš„è¯ç‰©è‡ªåŠ¨æç¤ºå¸¸è§è§„æ ¼
- **å‰‚é‡å»ºè®®**ï¼šåŸºäºè¯ç‰©å’Œè§„æ ¼æä¾›æ¨èå‰‚é‡
- **é¢‘æ¬¡ä¼˜åŒ–**ï¼šæ ¹æ®è¯ç‰©ç‰¹æ€§å»ºè®®æœ€ä½³æœç”¨é¢‘æ¬¡

### 2. æ•°æ®è´¨é‡æ§åˆ¶
- **é‡å¤æ£€æŸ¥**ï¼šé˜²æ­¢å½•å…¥ç›¸åŒè¯ç‰©
- **ç›¸äº’ä½œç”¨æé†’**ï¼šæ£€æµ‹æ½œåœ¨çš„è¯ç‰©ç›¸äº’ä½œç”¨
- **å‰‚é‡åˆç†æ€§**ï¼šéªŒè¯å‰‚é‡æ˜¯å¦åœ¨å®‰å…¨èŒƒå›´å†…
- **å®Œæ•´æ€§éªŒè¯**ï¼šç¡®ä¿å¿…å¡«ä¿¡æ¯å®Œæ•´

### 3. ä¾¿æ·æ“ä½œ
- **å¿«é€Ÿå½•å…¥**ï¼šå¸¸ç”¨è¯ç‰©çš„å¿«æ·é€‰æ‹©æ¨¡æ¿
- **æ‰¹é‡æ“ä½œ**ï¼šæ”¯æŒç›¸ä¼¼è¯ç‰©çš„æ‰¹é‡å½•å…¥
- **å†å²å‚è€ƒ**ï¼šæ˜¾ç¤ºè¯¥æ‚£è€…çš„å†å²ç”¨è¯è®°å½•
- **æ‰“å°è¾“å‡º**ï¼šæ”¯æŒç”¨è¯æ¸…å•çš„æ‰“å°è¾“å‡º

è¿™ç§è®¾è®¡ç¡®ä¿äº†ä»D2Aåˆ°H7æ‰€æœ‰ç–¾ç—…çš„ç”¨è¯è¯¦æƒ…éƒ½èƒ½å¾—åˆ°å®Œæ•´ã€å‡†ç¡®çš„è®°å½•ï¼ŒåŒæ—¶æä¾›è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒå’Œæ•°æ®ç®¡ç†åŠŸèƒ½ã€‚