# PSQI 匹兹堡睡眠质量指数量表数据库表设计
# 量表说明：评估患者最近一个月的睡眠质量状况
# 计分方式：总分范围0-21分，≤7分睡眠质量良好；>7分睡眠质量较差
# 适用对象：需要睡眠质量评估的患者（如糖尿病、失眠症、心理疾病患者）
# 问卷指导语："下面一些问题是关于您最近一个月的睡眠状况，这仅仅与您的睡眠习惯有关"
"表名","字段名","数据类型","必填","中文说明","交互设计","验证规则","选项值","关联关系","备注","题目编号"
"psqi_scale","patient_id","VARCHAR_32","是","患者唯一ID","外键关联","外键约束","","patient_basic_info","关联患者基本信息表",""
"psqi_scale","patient_name","VARCHAR_50","是","患者姓名","输入框","必填","","","患者真实姓名",""
"psqi_scale","patient_birthday","DATE","是","患者出生日期","日期选择器","必填","","","患者出生日期",""
"psqi_scale","patient_age","INT","是","患者年龄","自动计算","自动计算","","","根据出生日期自动计算当前年龄",""
"psqi_scale","patient_gender","TINYINT","是","患者性别","单选按钮","必选","0:女;1:男","","患者性别",""
"psqi_scale","education_level","VARCHAR_20","是","文化程度","下拉选择","必选","小学及以下;初中;高中/中专;大专;本科;硕士及以上","","患者受教育程度",""
"psqi_scale","occupation","VARCHAR_50","否","职业","输入框","选填","","","患者职业信息",""
"psqi_scale","assessment_date","DATE","是","评估日期","日期选择器","必填","","","评估实施日期",""
"psqi_scale","assessor_name","VARCHAR_50","是","评估人姓名","输入框","必填","","","实施评估的医护人员姓名",""
"psqi_scale","record_number","VARCHAR_20","否","编号","输入框","选填","","","问卷记录编号",""

# 基本睡眠信息
"psqi_scale","bedtime","TIME","是","晚上上床睡觉时间","时间选择器","必填","","","最近一个月通常上床时间","Q1"
"psqi_scale","sleep_latency_minutes","INT","是","入睡所需时间（分钟）","数字输入","必填，范围0-999","","","从上床到入睡的时间","Q2"
"psqi_scale","wake_time","TIME","是","早上起床时间","时间选择器","必填","","","最近一个月通常起床时间","Q3"
"psqi_scale","actual_sleep_hours","DECIMAL(3,1)","是","实际睡眠时间（小时）","数字输入","必填，范围0-24","","","每晚实际睡眠时间，可有小数","Q4"

# 睡眠困扰因素
"psqi_scale","sleep_disturbance_30min","TINYINT","是","不能在30分钟内入睡","单选按钮","必选","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","","睡眠困扰评估","Q5A"
"psqi_scale","sleep_disturbance_wake","TINYINT","是","在晚上睡眠过程中醒来或早醒","单选按钮","必选","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","","夜间觉醒或早醒","Q5B"
"psqi_scale","sleep_disturbance_bathroom","TINYINT","是","晚上起床上洗手间","单选按钮","必选","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","","夜间如厕","Q5C"
"psqi_scale","sleep_disturbance_breathing","TINYINT","是","晚上睡觉时出现不舒服的呼吸","单选按钮","必选","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","","呼吸不适","Q5D"
"psqi_scale","sleep_disturbance_cough_snore","TINYINT","是","晚上睡觉出现大声咳嗽或鼾声","单选按钮","必选","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","","咳嗽或打鼾","Q5E"
"psqi_scale","sleep_disturbance_cold","TINYINT","是","晚上睡觉感到寒冷","单选按钮","必选","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","","感觉寒冷","Q5F"
"psqi_scale","sleep_disturbance_hot","TINYINT","是","晚上睡觉感到太热","单选按钮","必选","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","","感觉太热","Q5G"
"psqi_scale","sleep_disturbance_nightmare","TINYINT","是","晚上睡觉做恶梦","单选按钮","必选","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","","做恶梦","Q5H"
"psqi_scale","sleep_disturbance_pain","TINYINT","是","晚上睡觉身上出现疼痛不适","单选按钮","必选","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","","疼痛不适","Q5I"
"psqi_scale","sleep_disturbance_other","TINYINT","否","其他影响睡眠的问题","单选按钮","选填","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","","其他睡眠问题","Q5J"
"psqi_scale","sleep_disturbance_other_desc","TEXT","否","其他睡眠问题描述","文本框","条件必填","","sleep_disturbance_other","当sleep_disturbance_other≥1时显示并必填",""

# 睡眠质量评估
"psqi_scale","sleep_quality","TINYINT","是","总的来说睡眠质量","单选按钮","必选","0:很好;1:较好;2:较差;3:很差","","主观睡眠质量评估","Q6"
"psqi_scale","sleep_medication","TINYINT","是","服药物才能入睡","单选按钮","必选","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","","睡眠药物使用情况","Q7"
"psqi_scale","daytime_dysfunction_sleepy","TINYINT","是","开车、吃饭、或参加社会活动时感到困倦","单选按钮","必选","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","","日间功能障碍-困倦","Q8"
"psqi_scale","daytime_dysfunction_energy","TINYINT","是","在积极完成事情上感到精力不足","单选按钮","必选","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","","日间功能障碍-精力不足","Q9"

# 睡眠伴侣信息
"psqi_scale","sleep_partner","TINYINT","是","是否与人同睡一床或有室友","单选按钮","必选","0:没有;1:同伴或室友在另一房间;2:同伴在同一房间但不同床;3:同伴在同一床上","","睡眠伴侣情况","Q10"
"psqi_scale","partner_report_snoring","TINYINT","否","睡觉时有无打鼾声（伴侣报告）","单选按钮","条件必填","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","sleep_partner","当sleep_partner≥1时显示并必填","Q10A"
"psqi_scale","partner_report_breathing_pause","TINYINT","否","呼吸之间有无长时间停顿（伴侣报告）","单选按钮","条件必填","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","sleep_partner","当sleep_partner≥1时显示并必填","Q10B"
"psqi_scale","partner_report_leg_twitch","TINYINT","否","腿是否有抽动或痉挛（伴侣报告）","单选按钮","条件必填","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","sleep_partner","当sleep_partner≥1时显示并必填","Q10C"
"psqi_scale","partner_report_disorientation","TINYINT","否","是否出现不能辨认方向或混乱状态（伴侣报告）","单选按钮","条件必填","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","sleep_partner","当sleep_partner≥1时显示并必填","Q10D"
"psqi_scale","partner_report_other","TINYINT","否","其他睡觉不安宁的情况（伴侣报告）","单选按钮","条件必填","0:过去一个月没有;1:每周平均不足一个晚上;2:每周平均有一或两个晚上;3:每周有平均三个或更多晚上","sleep_partner","当sleep_partner≥1时显示并必填","Q10E"
"psqi_scale","partner_report_other_desc","TEXT","否","其他不安宁情况描述","文本框","条件必填","","partner_report_other","当partner_report_other≥1时显示并必填",""

# 计分组件和总分
"psqi_scale","component1_sleep_quality","TINYINT","是","成分1：主观睡眠质量","自动计算","0-3","","","基于Q6计算",""
"psqi_scale","component2_sleep_latency","TINYINT","是","成分2：入睡时间","自动计算","0-3","","","基于Q2和Q5A计算",""
"psqi_scale","component3_sleep_duration","TINYINT","是","成分3：睡眠时间","自动计算","0-3","","","基于Q4计算",""
"psqi_scale","component4_sleep_efficiency","TINYINT","是","成分4：习惯性睡眠效率","自动计算","0-3","","","基于实际睡眠时间/卧床时间计算",""
"psqi_scale","component5_sleep_disturbance","TINYINT","是","成分5：睡眠困扰","自动计算","0-3","","","基于Q5B-Q5J计算",""
"psqi_scale","component6_sleep_medication","TINYINT","是","成分6：睡眠药物使用","自动计算","0-3","","","基于Q7计算",""
"psqi_scale","component7_daytime_dysfunction","TINYINT","是","成分7：日间功能障碍","自动计算","0-3","","","基于Q8和Q9计算",""
"psqi_scale","psqi_total_score","INT","是","PSQI 总分","自动计算","0-21","","","7个成分得分总和。≤7分:睡眠质量良好;>7分:睡眠质量较差。",""

# ==================== 开发说明 ====================
# PSQI 匹兹堡睡眠质量指数量表技术实现要求：
#
# 1. 评分标准：
#    PSQI由7个成分组成，每个成分0-3分：
#    成分1：主观睡眠质量（直接来自Q6）
#    成分2：入睡时间（基于Q2入睡时间和Q5A入睡困难）
#    成分3：睡眠时间（基于Q4实际睡眠时间）
#    成分4：习惯性睡眠效率（实际睡眠时间/卧床时间×100%）
#    成分5：睡眠困扰（基于Q5B-Q5J的总和）
#    成分6：睡眠药物使用（直接来自Q7）
#    成分7：日间功能障碍（基于Q8和Q9）
#    总分范围：0-21分，得分越高表示睡眠质量越差
#
# 2. 问卷说明：
#    适用对象：需要睡眠质量评估的患者
#    评估时间范围：最近一个月
#    问卷指导语："下面一些问题是关于您最近一个月的睡眠状况"
#    包含主观和客观睡眠质量指标
#
# 3. 成分计分详细规则：
#    成分1（主观睡眠质量）：Q6分数直接转换
#    成分2（入睡时间）：
#      - Q2≤15分钟=0分，16-30分钟=1分，31-60分钟=2分，>60分钟=3分
#      - 与Q5A分数相加，总分0=0分，1-2=1分，3-4=2分，5-6=3分
#    成分3（睡眠时间）：
#      - >7小时=0分，6-7小时=1分，5-6小时=2分，<5小时=3分
#    成分4（睡眠效率）：
#      - >85%=0分，75-84%=1分，65-74%=2分，<65%=3分
#    成分5（睡眠困扰）：Q5B-Q5J总分，0=0分，1-9=1分，10-18=2分，19-27=3分
#    成分6（睡眠药物）：Q7分数直接转换
#    成分7（日间功能障碍）：Q8+Q9，0=0分，1-2=1分，3-4=2分，5-6=3分
#
# 4. 表单交互：
#    - 患者基本信息：姓名、出生日期（自动计算年龄）、性别、文化程度、职业等
#    - Q1-Q4为基本睡眠信息，需要时间/数值输入
#    - Q5A-Q5J为睡眠困扰评估，使用相同的4级评分
#    - Q6为主观睡眠质量，4级评分
#    - Q7-Q9为功能评估，使用相同的4级评分
#    - Q10及其子项为伴侣观察，有伴侣时才需要填写
#
# 5. 数据验证：
#    - 基本信息字段必填（姓名、出生日期、性别、文化程度等）
#    - 出生日期合理性验证（不能未来日期，不能过于久远）
#    - 年龄自动计算并显示，无需用户输入
#    - 时间字段格式验证
#    - 数值字段范围验证
#    - 伴侣观察项基于Q10条件显示
#
# 6. 计分方法：
#    - 7个成分分别计算后求和
#    - 系统自动计算各成分和总分
#    - 需要实现复杂的成分计分逻辑
#
# 7. 临床解释：
#    - 总分≤7分：睡眠质量良好
#    - 总分>7分：睡眠质量较差，提示存在睡眠障碍
#    - 各成分分析可识别具体睡眠问题
#    - 结合伴侣观察可评估睡眠呼吸障碍等
#
# 8. 问卷管理：
#    - 评估环境应安静、私密
#    - 需要足够时间完成（约10-15分钟）
#    - 必要时可协助患者理解问题
#    - 伴侣观察项需要伴侣配合
#
# 9. 临床应用：
#    - 睡眠障碍筛查和诊断辅助
#    - 治疗效果评估
#    - 慢性病患者睡眠质量监测
#    - 心理健康评估的重要组成部分
#
# 10. 技术实现注意事项：
#     - 成分计分逻辑复杂，需要精确实现
#     - 睡眠效率计算需要卧床时间（起床时间-上床时间）
#     - 自动计算字段的技术实现：
#       * 年龄自动计算：基于patient_birthday和当前日期计算周岁年龄（当前日期-出生日期）
#       * 睡眠效率自动计算：基于实际睡眠时间和卧床时间的百分比
#       * 各成分得分自动计算：按照PSQI标准计分规则
#     - 条件显示逻辑的技术实现：
#       * Q10伴侣观察项逻辑：当Q10=0（没有同伴）时，Q10A-Q10E不显示，不计分；当Q10≥1时显示并必填
#       * Q5J其他睡眠问题描述：当Q5J=0时不显示描述框；当Q5J≥1时显示并必填描述
#       * Q10E其他不安宁描述：当Q10E=0时不显示描述框；当Q10E≥1时显示并必填描述
#     - 时间格式处理和计算
#     - 多层级条件字段的前端交互逻辑实现
#
# 备注：此量表为匹兹堡睡眠质量指数量表，是国际公认的睡眠质量评估工具，广泛用于临床睡眠评估