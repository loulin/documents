# 饮食偏好功能说明

## 📋 功能概述

营养管理系统现已集成完整的**饮食偏好功能**，能够根据患者的个人口味偏好、饮食限制、过敏史等因素，提供个性化的营养建议和菜谱推荐。

## 🎯 主要功能

### 1. 饮食偏好采集
系统支持收集以下饮食偏好信息：

#### 基础偏好
- **偏好菜系**: 川菜、粤菜、鲁菜、苏菜、浙菜、闽菜、湘菜、徽菜、清淡等
- **不喜食物**: 具体不喜欢的食材或菜品
- **辣度承受**: 不能吃辣、微辣、中等、重辣

#### 饮食限制
- **宗教限制**: 清真、素食等
- **健康限制**: 低盐、低脂、无糖、无麸质等
- **个人限制**: 其他个人原因的饮食限制

#### 烹饪偏好
- **烹饪方式**: 蒸、煮、炒、炖、烤、凉拌等
- **口感偏好**: 影响食材搭配和调味建议

#### 安全信息
- **食物过敏**: 明确的过敏原，影响食谱安全性
- **药物冲突**: 与服用药物可能冲突的食物

### 2. 个性化推荐算法

#### 菜系匹配
```python
# 根据偏好菜系选择对应风味的菜谱
if patient.preferred_cuisines:
    selected_cuisine = patient.preferred_cuisines[0]  # 选择首选菜系
    recommendations = base_recipes[selected_cuisine]
```

#### 安全筛选
```python
# 排除过敏和不喜欢的食物
avoid_foods = patient.disliked_foods + patient.allergies
filtered_recipes = [r for r in recipes if not any(avoid in r for avoid in avoid_foods)]
```

#### 限制适配
```python
# 素食主义者筛选
if "素食" in patient.dietary_restrictions:
    recipes = [r for r in recipes if not contains_meat(r)]
```

## 📝 患者档案结构

### PatientProfile 新增字段

```python
@dataclass
class PatientProfile:
    # ... 原有字段 ...

    # 饮食偏好 (新增)
    preferred_cuisines: List[str] = None     # 偏好菜系
    disliked_foods: List[str] = None         # 不喜欢的食物
    dietary_restrictions: List[str] = None    # 饮食限制
    spice_tolerance: str = "中等"            # 辣度承受
    cooking_preferences: List[str] = None     # 烹饪偏好
    allergies: List[str] = None              # 过敏史 (已有，重新归类)
```

## 🎯 使用示例

### 案例1: 川菜爱好者
```python
patient = PatientProfile(
    name="张先生",
    age=42,
    gender="男",
    height=175,
    weight=70,
    diagnosed_diseases=["高血压"],

    # 饮食偏好设置
    preferred_cuisines=["川菜"],           # 偏好川菜
    disliked_foods=["海鲜", "羊肉"],       # 不喜欢海鲜和羊肉
    spice_tolerance="重辣",                # 重辣偏好
    cooking_preferences=["炒", "煮", "蒸"], # 偏好炒煮蒸
    allergies=["虾"]                       # 对虾过敏
)

# 生成个性化推荐
recommendations = system._recommend_recipes(patient)
# 结果: 川菜风味 + 重辣调味 + 排除海鲜虾类
```

### 案例2: 素食主义者
```python
patient = PatientProfile(
    name="王女士",
    age=35,
    gender="女",
    height=168,
    weight=60,

    # 素食偏好设置
    preferred_cuisines=["清淡"],           # 偏好清淡
    dietary_restrictions=["素食"],         # 素食主义
    spice_tolerance="中等",                # 中等辣度
    cooking_preferences=["蒸", "煮", "炖"], # 偏好健康烹饪
    allergies=["花生"]                     # 花生过敏
)

# 结果: 清淡素食 + 排除所有肉类 + 排除花生
```

## 📊 推荐逻辑流程

### 1. 偏好分析
```
输入患者偏好 → 解析菜系偏好 → 确定基础菜谱库
```

### 2. 安全筛选
```
基础菜谱 → 排除过敏食物 → 排除不喜食物 → 安全菜谱
```

### 3. 限制适配
```
安全菜谱 → 应用饮食限制 → 调整烹饪方式 → 最终推荐
```

### 4. 个性化调味
```
基础推荐 → 根据辣度偏好调整 → 添加个性化说明
```

## 🏥 临床应用建议

### 信息采集时机
1. **初诊时**: 详细采集完整饮食偏好信息
2. **复诊时**: 更新变化的偏好和限制
3. **特殊时期**: 疾病变化时重新评估

### 采集要点
1. **准确性优先**: 特别是过敏信息，关系安全
2. **详细程度**: 具体到食材级别，避免模糊描述
3. **文化敏感**: 尊重宗教和文化饮食习惯
4. **动态更新**: 偏好可能随时间和健康状况变化

### 推荐原则
1. **安全第一**: 过敏和禁忌食物绝对避免
2. **营养优先**: 在偏好基础上确保营养需求
3. **可执行性**: 考虑患者的实际执行能力
4. **循序渐进**: 逐步引导健康饮食习惯

## 📋 饮食偏好采集表单

### 基本偏好信息
| 项目 | 选项 | 说明 |
|------|------|------|
| **偏好菜系** | 川菜、粤菜、鲁菜、苏菜、浙菜、闽菜、湘菜、徽菜、清淡、其他 | 可多选，影响风味推荐 |
| **辣度承受** | 不能吃辣、微辣、中等、重辣 | 影响调料和烹饪方式 |
| **烹饪偏好** | 蒸、煮、炒、炖、烤、凉拌、其他 | 可多选，影响制作方式 |

### 限制和禁忌
| 项目 | 内容 | 重要性 |
|------|------|--------|
| **食物过敏** | 具体过敏原 | ⭐⭐⭐ 安全关键 |
| **不喜食物** | 具体不喜欢的食材 | ⭐⭐ 影响接受度 |
| **饮食限制** | 素食、清真、低盐、低脂等 | ⭐⭐⭐ 必须遵守 |

### 特殊情况
- **宗教信仰**: 影响食材选择和烹饪方式
- **地域习惯**: 考虑当地饮食文化
- **家庭环境**: 考虑家庭成员的配合度
- **经济条件**: 推荐经济实用的方案

## 🔄 系统集成效果

### 推荐个性化程度提升
- **基础推荐**: 仅考虑营养需求
- **偏好集成**: 营养需求 + 个人偏好 + 安全限制

### 患者接受度提升
- **标准化推荐**: 通用性强，个性化不足
- **偏好化推荐**: 高度个性化，执行性强

### 临床应用价值
- **提高依从性**: 符合患者口味偏好
- **确保安全性**: 严格排除过敏和禁忌
- **增强效果**: 患者更愿意长期坚持

## 💡 使用建议

### 对医疗机构
1. **建立标准流程**: 制定饮食偏好采集的标准操作程序
2. **培训人员**: 确保医护人员了解偏好采集的重要性
3. **定期更新**: 建立偏好信息的更新机制
4. **质量控制**: 确保偏好信息的准确性和完整性

### 对营养师
1. **详细询问**: 耐心收集患者的真实偏好
2. **专业解释**: 解释为什么需要收集这些信息
3. **灵活调整**: 在营养需求和个人偏好间找平衡
4. **持续跟进**: 定期评估和调整推荐方案

### 对患者
1. **如实告知**: 准确提供偏好和限制信息
2. **详细描述**: 具体说明不喜欢的原因
3. **及时更新**: 偏好变化时及时告知医护人员
4. **积极配合**: 在医生指导下适当调整饮食习惯

---

## 🎉 总结

饮食偏好功能的集成使营养管理系统更加**人性化**和**实用化**：

✅ **个性化程度高** - 充分考虑患者个人偏好
✅ **安全性保障** - 严格管理过敏和禁忌信息
✅ **文化适应性** - 支持多种菜系和饮食文化
✅ **临床实用性** - 提高患者依从性和治疗效果

**这一功能让营养管理从"标准化"走向"个性化"，是系统的重要进步！**

---
*功能版本: v2.0*
*文档更新时间: 2025年09月20日*