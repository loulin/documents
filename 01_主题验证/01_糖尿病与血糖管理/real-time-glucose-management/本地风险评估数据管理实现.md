# 本地风险评估数据管理实现

## 任务理解

### 核心需求
1. **本地存储API**：创建独立的API文件，模拟服务器端的风险评估数据增删查改
2. **状态管理**：为RiskAssessment类型添加状态属性，区分"管理中"和"已结束"
3. **实时管理页面改造**：从本地获取"管理中"的患者，添加退出管理功能
4. **既往患者列表**：新增页面显示已退出的患者，支持重新加入管理

### 数据模型设计

#### RiskAssessment类型扩展
```typescript
export type RiskAssessment = {
  patientId: number;
  patientData: PatientData;
  result: RiskResult;
  timestamp: string;
  status: 'active' | 'completed'; // 新增状态字段
};
```

#### 状态说明
- `active`: 正在进行实时管理的患者
- `completed`: 已退出管理的患者

### 技术架构

#### 文件结构
```
RealTimeManagement/
├── index.tsx                      # 实时管理主页（修改）
├── PatientRiskForm.tsx           # 风险评估表单（修改）
├── HistoryList.tsx               # 既往患者列表（新增）
├── utils/
│   └── riskAssessmentStorage.ts  # 本地存储API（新增）
├── types.ts                      # 类型定义（修改）
└── components/                   # 现有组件
```

#### 本地存储API设计
`utils/riskAssessmentStorage.ts`提供以下方法：
- `createRiskAssessment()`: 创建新的风险评估记录
- `getRiskAssessmentsByStatus()`: 按状态获取患者列表
- `updateRiskAssessmentStatus()`: 更新患者管理状态
- `deleteRiskAssessment()`: 删除风险评估记录
- `getRiskAssessmentByPatientId()`: 根据患者ID获取记录

### 功能实现

#### 1. 实时管理页面改造
- **数据源变更**：从`api.patient.queryInpatient`改为本地存储
- **患者筛选**：只显示`status='active'`的患者
- **退出功能**：在"查看详情"旁添加"退出"按钮
- **血糖数据**：仍从服务器API获取

#### 2. 既往患者列表页面
- **页面类型**：ProTable表格展示
- **数据源**：`status='completed'`的患者
- **操作功能**：重新加入管理（改为active状态）
- **附加功能**：搜索、筛选、分页

#### 3. 风险评估表单修改
- **存储方式**：使用新的`createRiskAssessment` API
- **默认状态**：新评估的患者状态为`active`
- **数据迁移**：兼容现有localStorage数据

### 实施计划

#### 第一阶段：基础架构
1. 扩展RiskAssessment类型定义
2. 创建本地存储API文件
3. 实现完整的CRUD操作

#### 第二阶段：页面改造
1. 修改PatientRiskForm.tsx使用新API
2. 改造实时管理主页数据获取逻辑
3. 添加退出管理功能

#### 第三阶段：新增功能
1. 创建既往患者列表页面
2. 配置路由和菜单
3. 实现重新加入管理功能

### 技术要求

#### 前端开发规范
- **类型安全**：严格的TypeScript类型定义
- **错误处理**：localStorage操作的异常捕获
- **数据一致性**：确保状态变更的原子性
- **用户体验**：操作反馈和确认机制

#### UI/UX设计
- **按钮位置**：退出按钮放在查看详情右侧
- **状态标识**：清晰的视觉区分不同状态
- **交互反馈**：操作成功/失败的消息提示

### 数据流程

#### 新患者加入流程
1. 患者列表 → 风险评估表单
2. 提交评估 → 创建记录（status: 'active'）
3. 自动跳转 → 实时管理页面

#### 退出管理流程
1. 实时管理页面 → 点击退出按钮
2. 确认操作 → 更新状态（status: 'completed'）
3. 从当前列表移除 → 进入既往列表

#### 重新加入流程
1. 既往患者列表 → 点击重新加入
2. 更新状态（status: 'active'）
3. 从既往列表移除 → 进入实时管理

## 开发准备就绪

以上是对任务需求的完整理解和设计方案。接下来将按照实施计划逐步开发，确保功能完整性和代码质量。 