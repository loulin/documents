# 190模式风险分层生成规则
## 版本信息
- **版本**: v1.2
- **发布日期**: 2025年6月19日 (修订)
- **适用范围**: xAI Grok 3风险分层系统

## 文档目的
本文档旨在详细说明风险分层的参数定义、权重分配和总分计算逻辑，为技术人员提供实现和扩展的指导。

## 参数定义
### 区间划分规则
**重要说明**: 除非特别指明，所有数值区间均采用**左闭右开**原则，即包含左端点，不包含右端点。
例如："7-8%"表示 [7%, 8%)，即 7% ≤ 值 < 8%。

### 完整参数列表
以下是所有参数及其区间划分，基于临床指南（如ADA标准）和数据分布：

- **诊断**: 
  - 健康人, 1型糖尿病, 2型糖尿病, GDM
  - **注**: LADA, MODY等特殊类型糖尿病需由专家进行个案评估，不直接套用此通用模型。
- **GDM分期**: 
  - 无GDM, 妊娠早期, 妊娠中期, 妊娠晚期
  - **注**: GDM的风险评分仅在妊娠期内生效。
- **HbA1c**: 
  - <7%, 7-8%, 8-10%, >10%
- **动态CGM数据**:
  - TIR_week: >70%, 50-70%, 30-50%, <30%
  - TBR_week: <4%, 4-5%, 5-7%, >7%
  - TAR_week: <30%, >=30%
  - TIR_yesterday: >70%, 50-70%, 30-50%, <30%
  - TBR_yesterday: <4%, 4-5%, 5-7%, >7%
  - TAR_yesterday: <30%, >=30%
  - TIR_today: >70%, 50-70%, 30-50%, <30%
  - TBR_today: <4%, 4-5%, 5-7%, >7%
  - TAR_today: <30%, >=30%
  - CV: <40%, >=40%
  - MAGE: <4, >=4
- **低血糖**: 
  - 0 (<1次/周), 1 (>=1次/周)
- **GI值**: 
  - 低 (<55), 中 (55-69), 高 (>=70)
- **运动**: 
  - 低 (0-2小时/周), 中 (2-5小时/周), 高 (>5小时/周)
- **年龄**: 
  - <13, 13-18, 18-60, 60-80, >80
- **身高**: 
  - 连续值 (厘米, 用于BMI计算)
- **体重**: 
  - 连续值 (公斤, 用于BMI计算)
- **BMI**: 
  - <18.5, 18.5-24.9, 25-29.9, >=30
- **患病年数**: 
  - <5年, 5-10年, 10-20年, >20年
- **生活方式**: 
  - 良好 (0-4), 差 (5-10)
  - **注：原始分(0-10分)反向计分规则** (分数越高，生活方式越差):
    - **饮食习惯 (满分4分)**: 
      - 主食GI值 (满分2分): 低GI为主(0分), 中GI为主(1分), 高GI为主(2分)
      - 饮食均衡度 (满分2分): 优/科学均衡(0分), 良/基本均衡(1分), 差/严重失衡(2分)
    - **运动习惯 (满分3分)**: 积极规律(0分), 偶有活动(1分), 活动不足(2分), 久坐不动(3分)
    - **其他风险习惯 (满分3分)**: 
      - 吸烟情况 (满分2分): 从不吸烟(0分), 已戒烟>1年(1分), 目前吸烟(2分)
      - 饮酒情况 (满分1分): 从不或仅社交性浅酌(0分), 规律性/过量饮酒(1分)
    - 三项得分相加，得出原始分。原始分0-4分归类为"良好"，5-10分归类为"差"。
- **用药**: 
  - 降糖药: 0=无, 1=有
  - 胰岛素: 0=无, 1=有
  - 降压药: 0=无, 1=有
  - 降脂药: 0=无, 1=有
- **并发症**: 
  - 0=无, 1=有
- **趋势箭头**: 
  - 上升 (-1), 稳定 (0), 下降 (1)

**问题3：** 技术人员可能需要调整区间。您觉得是否应提供区间优化的建议（如TIR分5个区间），这对灵活性有何影响？

### 权重分配规则
#### 权重表
以下是每个参数的权重和得分规则：

- **诊断**: 1.0
  - 健康人: 0
  - GDM: 1 (**注**: 仅在GDM分期为妊娠期时计算此分数，否则为0)
  - 2型糖尿病: 2
  - 其他: 2
  - 1型糖尿病: 3
- **HbA1c**: 1.0
  - <7%: 0
  - 7-8%: 2
  - 8-10%: 4
  - >10%: 6
- **动态CGM**:
  - TIR_week: 0.8
    - >70%: 0
    - 50-70%: 2
    - 30-50%: 4
    - <30%: 6
  - TBR_week: 0.8
    - <4%: 0
    - 4-5%: 3
    - 5-7%: 6
    - >7%: 9
  - TAR_week: 0.7
    - <30%: 0
    - >=30%: 4
  - TIR_yesterday: 0.9 (同TIR_week)
  - TBR_yesterday: 0.9 (同TBR_week)
  - TAR_yesterday: 0.9 (同TAR_week)
  - TIR_today: 1.0 (同TIR_week)
  - TBR_today: 1.0 (同TBR_week)
  - TAR_today: 1.0 (同TAR_week)
- **CV**: 0.6
  - <40%: 0
  - >=40%: 4
- **MAGE**: 0.5
  - <4: 0
  - >=4: 4
- **低血糖**: 0.5
  - 0: 0
  - 1: 4
- **GI值**: 0.5
  - 低: 0
  - 中: 2
  - 高: 4
- **运动**: 0.5
  - 高: 0
  - 中: 2
  - 低: 4
- **年龄**: 0.5
  - <13: 0
  - 13-18: 1
  - 18-60: 2
  - 60-80: 3
  - >80: 4
- **BMI**: 0.5
  - <18.5: 0
  - 18.5-24.9: 1
  - 25-29.9: 2
  - >=30: 3
- **患病年数**: 0.5
  - <5年: 0
  - 5-10年: 1
  - 10-20年: 2
  - >20年: 3
- **生活方式**: 0.5
  - 得分 = (原始得分/10)×2 
  - **注意**: 原始得分为反向计分，分数越高生活方式越差
- **用药 (各)**: 0.5
  - 无: 0
  - 有: 2
- **并发症**: 0.5
  - 无: 0
  - 有: 2
- **趋势箭头**: 0.5
  - 稳定: 0
  - 上升/下降: 1

#### 总分公式
总分 = Σ(参数得分 × 权重)

**问题4：** 技术人员可能需要动态调整权重。您觉得是否应加入权重优化的方法（如回归分析），这对适应性有何帮助？

### 模式生成逻辑
#### 总分与风险分层
- <25: **低风险**
- 25-50: **中等风险**
- 50-75: **高风险**
- >75: **极高风险**

#### 主要驱动参数
- 风险画像主要由以下参数组合驱动:
- 诊断、HbA1c、TIR_today、TBR_today
- 理论组合数: 4 (诊断) × 4 (HbA1c) × 4 (TIR_today) × 4 (TBR_today) = 256

#### 细化参数
- 动态CGM (TIR_week, TBR_week, TIR_yesterday, TBR_yesterday) 和辅助参数 (TAR, CV, MAGE等) 用于在同一风险层级内进一步细化风险画像。
- **分层逻辑**:
  - 根据总分落入对应的风险层级。
  - 在层级内部，可根据主要驱动参数和细化参数的组合，生成具体的风险画像描述。

#### 风险画像示例
- **画像描述**: 患者近期血糖波动较大，但整体处于中等风险水平。
- **对应参数组合**: TIR_today 30-70%, TBR_today 4-7%, HbA1c 7-8%。
- **细化分析**: TIR_week 30-50%, TBR_week 4-5%, 其他参数匹配。

**问题5：** 技术人员可能需要自动化生成。您觉得是否应提供伪代码生成模式，这对实现效率有何影响？

### 示例计算
#### 输入数据
- 诊断: 2型糖尿病
- GDM分期: 无GDM
- HbA1c: 7.5% (7-8%)
- TIR_week: 45% (30-50%)
- TBR_week: 5% (4-5%)
- TIR_yesterday: 40% (30-70%)
- TBR_yesterday: 6% (4-7%)
- TIR_today: 35% (30-50%)
- TBR_today: 7% (5-7%)
- TAR: 25% (<30%)
- CV: 35% (<40%)
- MAGE: 3 (<4)
- 低血糖: 0 (<1次/周)
- GI值: 中 (55-69)
- 运动: 中 (2-5小时/周)
- 年龄: 40 (18-60)
- 身高: 165厘米
- 体重: 70公斤 (BMI ≈ 25.75, 25-29.9)
- 患病年数: 7年 (5-10年)
- 生活方式: 4 (原始分4分，属于良好类别)
- 降糖药: 0
- 胰岛素: 0
- 降压药: 0
- 降脂药: 0
- 并发症: 0
- 趋势箭头: 稳定 (0)

#### 计算 (已根据v1.1规则修正)
- 诊断(2型): 2×1.0 = 2.0
- HbA1c(7-8%): 2×1.0 = 2.0
- TIR_week(30-50%): 4×0.8 = 3.2
- TBR_week(4-5%): 3×0.8 = 2.4
- TIR_yesterday(30-50%): 4×0.9 = 3.6
- TBR_yesterday(5-7%): 6×0.9 = 5.4
- TIR_today(30-50%): 4×1.0 = 4.0
- TBR_today(5-7%): 6×1.0 = 6.0
- TAR(<30%): 0×0.7 = 0
- CV(<40%): 0×0.6 = 0
- MAGE(<4): 0×0.5 = 0
- 低血糖(<1次/周): 0×0.5 = 0
- GI值(中): 2×0.5 = 1.0
- 运动(中): 2×0.5 = 1.0
- 年龄(18-60): 2×0.5 = 1.0
- BMI(25-29.9): 2×0.5 = 1.0
- 患病年数(5-10年): 1×0.5 = 0.5
- 生活方式(4/10): (4/10)×2×0.5 = 0.4
- 降糖药/胰岛素/降压药/降脂药/并发症/趋势箭头: 均为0
- **总分 = 33.3** (属于**中等风险**范围)

#### 风险画像归类
- **总分33.3**，落入**中等风险**层级。
- **核心画像**: 2型糖尿病患者，近期（今日/昨日）血糖控制不佳(TIR/TBR差)，但长期指标(HbA1c)尚可，无明显并发症及不良生活习惯。

#### 高风险示例（总分70.1，高风险）
- **输入数据**: 诊断: 2型糖尿病, GDM分期: 无GDM, HbA1c: 9.5% (>10%), TIR_week: 25% (<30%), TBR_week: 6% (5-7%), TIR_yesterday: 20% (<30%), TBR_yesterday: 7% (>7%), TIR_today: 15% (<30%), TBR_today: 8% (>7%), TAR: 35% (>=30%), CV: 45% (>=40%), MAGE: 5 (>=4), 低血糖: 1, GI值: 高, 运动: 低, 年龄: 70 (60-80), 身高: 165厘米, 体重: 90公斤 (BMI ≈ 33.06, >=30), 患病年数: 15年 (10-20年), 生活方式: 3 (差), 降糖药: 1, 胰岛素: 1, 降压药: 1, 降脂药: 1, 并发症: 1, 趋势箭头: 上升
- **计算 (已根据v1.1规则修正)**: 总分 = 70.1 (落入**高风险**范围)
- **风险画像**: 2型糖尿病患者，长期(HbA1c)和短期(CGM)血糖控制均极差，存在多种心血管风险因素和并发症，生活方式不良，需要立即进行医疗干预。
- **建议**: 医生立即调整治疗方案，增加监测频率；患者优化饮食，减少高GI食物；家属关注夜间低血糖风险

#### 极高风险示例（总分75.4，极高风险）
- **输入数据**: 诊断: 2型糖尿病, GDM分期: 无GDM, HbA1c: 11% (>10%), TIR_week: 20% (<30%), TBR_week: 8% (>7%), TIR_yesterday: 15% (<30%), TBR_yesterday: 9% (>7%), TIR_today: 10% (<30%), TBR_today: 10% (>7%), TAR: 45% (>=30%), CV: 55% (>=40%), MAGE: 7 (>=4), 低血糖: 1, GI值: 高, 运动: 低, 年龄: 85 (>80), 身高: 160厘米, 体重: 110公斤 (BMI ≈ 42.97, >=30), 患病年数: 25年 (>20年), 生活方式: 2 (差), 降糖药: 1, 胰岛素: 1, 降压药: 1, 降脂药: 1, 并发症: 1, 趋势箭头: 上升
- **计算 (已根据v1.1规则修正)**: 总分 = 75.4 (落入**极高风险**范围)
- **风险画像**: 老年2型糖尿病患者，病程长，血糖全面失控，各项指标均处于最差区间，合并多种用药和并发症，属于最高风险级别。
- **建议**: 医生紧急干预，考虑住院观察；患者严格控制饮食，立即就医；家属24小时监护

**问题6：** 技术人员可能需要更多示例。您觉得是否应加入更多边界案例，这对覆盖率有何帮助？

## 技术人员指导
- **阅读规则**: 理解参数区间和权重。
- **实现逻辑**: 按公式计算总分，匹配**风险分层**。
- **扩展画像**: 根据参数组合，可以生成更具体的风险画像描述。

## 未来改进
- 考虑动态调整权重（如回归分析）。
- 提供区间优化建议。

