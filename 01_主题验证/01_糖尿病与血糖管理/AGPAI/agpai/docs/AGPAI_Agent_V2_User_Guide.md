# AGPAI Agent V2.0 用户指南

## 🎯 系统概述

AGPAI Agent V2.0 是基于循证医学的专业血糖分析智能体，集成了双重变异性分析、临床表型识别、历史数据对比和个性化诊疗建议功能。

### 🚀 核心特性

1. **双重变异性分析框架**
   - 整体血糖变异系数 (Glucose CV)
   - 昼夜模式变异系数 (Percentile Band CV)

2. **智能临床表型识别**
   - 稳定性高血糖型
   - 接近达标型
   - 餐后激发型
   - 优化控制型
   - 高变异性型
   - 低血糖风险型

3. **历史数据对比分析**
   - 自动保存患者历史数据
   - TIR/CV趋势分析
   - 治疗效果评估

4. **专业临床建议生成**
   - 基于表型的个性化建议
   - 优先级分类（紧急/高/中/低）
   - 病理生理机制解释
   - 预期效果和监测要点

## 📊 使用示例

### 基本使用

```python
from AGPAI_Agent_V2 import AGPAI_Agent_V2

# 初始化Agent
agent = AGPAI_Agent_V2()

# 分析单个患者
report = agent.generate_comprehensive_report(
    patient_id="R022_v11",
    cgm_file_path="/path/to/cgm_data.txt",
    include_historical=True
)

print(report)
```

### 批量分析

```python
# 批量分析多个患者
patients = [
    ("R016_v5", "/path/to/R016_data.txt"),
    ("R017_v11", "/path/to/R017_data.txt"),
    ("R022_v11", "/path/to/R022_data.txt")
]

for patient_id, file_path in patients:
    report = agent.generate_comprehensive_report(
        patient_id=patient_id,
        cgm_file_path=file_path,
        include_historical=True
    )
    
    # 保存报告
    with open(f"report_{patient_id}.md", "w", encoding="utf-8") as f:
        f.write(report)
```

## 🔍 临床表型识别逻辑

### 1. 餐后激发型
- **条件**: TIR > 75%, CV < 30%, TBR < 2%, 昼夜CV < 15%
- **特征**: 基础控制优秀，主要问题为餐后血糖激发
- **治疗重点**: 精准餐时血糖管理

### 2. 稳定性高血糖型
- **条件**: CV < 30%, TIR < 60%, TBR < 2%, 黎明现象 > 3.0 mmol/L
- **特征**: 血糖稳定但水平偏高，无低血糖风险
- **治疗重点**: 积极强化基础和餐时胰岛素

### 3. 接近达标型
- **条件**: 60% ≤ TIR < 75%, 20% ≤ CV ≤ 35%, TBR < 5%
- **特征**: 接近达标，需要精细化调整
- **治疗重点**: 温和优化，防范低血糖

### 4. 优化控制型
- **条件**: TIR > 85%, CV < 25%, TBR < 2%
- **特征**: 血糖控制优秀
- **治疗重点**: 维持性管理

## 📈 历史数据分析

### 数据存储结构
```json
{
  "analysis_date": "2025-08-14T10:30:00",
  "metrics": {
    "tir": 86.7,
    "glucose_cv": 23.09,
    "percentile_band_cv": 66.73,
    "tbr_level1": 0.0,
    "phenotype": "优化控制型",
    "dawn_phenomenon": 2.43
  }
}
```

### 趋势分析指标
- **TIR变化**: ±5%为显著变化阈值
- **CV变化**: ±2%为临床意义阈值
- **表型转换**: 自动识别患者管理模式变化

## 🎯 临床建议体系

### 建议优先级

1. **紧急优先级** 🚨
   - TIR < 50%或严重下降
   - 反复严重低血糖
   - 血糖控制急剧恶化

2. **高优先级** ⚠️
   - 显著黎明现象 (>3.0 mmol/L)
   - TIR显著低于目标
   - 低血糖风险需要管理

3. **中等优先级** 📋
   - 精细化TIR优化
   - 餐后血糖管理
   - 生活方式调整

4. **低优先级** 💡
   - 维持性管理
   - 长期优化目标
   - 预防性措施

### 建议内容结构
- **建议内容**: 具体的治疗建议
- **机制解释**: 病理生理学基础
- **预期效果**: 治疗目标和时间框架
- **监测要点**: 需要关注的指标
- **实施时间**: 建议的时间安排

## 📊 报告解读指南

### 血糖变异性解读
- **< 25%**: 优秀稳定性
- **25-30%**: 良好稳定性
- **30-36%**: 可接受范围
- **> 36%**: 需要改善

### TIR目标解读
- **> 85%**: 优秀控制
- **70-85%**: 良好控制
- **50-70%**: 需要改善
- **< 50%**: 需要积极干预

### 昼夜节律评估
- **< 30%**: 节律稳定
- **30-50%**: 轻度不稳定
- **> 50%**: 显著紊乱

## ⚠️ 使用注意事项

### 数据质量要求
- CGM数据完整性 > 70%
- 监测时长 ≥ 10天
- 数据格式符合质肽生物标准

### 临床应用限制
1. **诊断辅助**: 系统提供决策支持，不替代医生判断
2. **个体差异**: 建议需要结合患者具体情况调整
3. **安全性**: 所有治疗调整需要专业医生指导
4. **随访**: 建议实施后需要密切监测效果

### 技术限制
1. **算法基础**: 基于现有循证医学证据
2. **数据依赖**: 分析质量依赖CGM数据质量
3. **更新需求**: 需要定期更新算法和参考标准

## 🔧 系统配置

### 环境要求
```bash
# Python依赖
pip install pandas numpy datetime typing dataclasses

# 数据存储目录
mkdir ./agpai_patient_data/
```

### 文件格式支持
- **质肽生物格式**: ID\t时间\t记录类型\t葡萄糖历史记录（mmol/L）
- **编码格式**: UTF-8
- **时间格式**: YYYY/MM/DD HH:MM

## 📞 技术支持

### 常见问题
1. **文件读取失败**: 检查文件格式和编码
2. **分析结果异常**: 验证数据质量和完整性
3. **历史数据丢失**: 检查存储目录权限

### 联系方式
- **技术支持**: AGPAI开发团队
- **文档更新**: 2025年8月
- **版本信息**: V2.0

---

**⚡ 快速开始**: 
1. 安装依赖包
2. 准备CGM数据文件
3. 运行示例代码
4. 查看生成的专业分析报告

**🎯 最佳实践**: 
- 定期分析，建立患者历史档案
- 结合临床表型调整治疗策略
- 重视趋势分析，动态优化管理
- 注重安全性，防范治疗风险