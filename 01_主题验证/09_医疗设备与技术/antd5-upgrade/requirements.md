# Ant Design v5 & Pro Components 升级需求文档

## 项目背景

GPlus医疗平台客户端基于Ant Design Pro开发，目前使用：
- Ant Design v4.24.16
- 多个独立的Pro Components包（v2.x版本）
- UmiJS Max v4.0.71
- React 18.2.0

## 升级目标

### 主要升级内容
1. **Ant Design**: v4.24.16 → v5.25.4
2. **Pro Components**: 从独立包迁移到总包 @ant-design/pro-components v2.8.9
3. **技术架构**: 从Less迁移到CSS-in-JS
4. **构建优化**: 移除babel-plugin-import依赖

### 具体组件升级映射

| 当前依赖 | 版本 | 升级后 | 版本 |
|---------|------|--------|------|
| antd | 4.24.16 | antd | 5.25.4 |
| @ant-design/pro-card | 2.8.8 | @ant-design/pro-components | 2.8.9 |
| @ant-design/pro-descriptions | 2.5.53 | @ant-design/pro-components | 2.8.9 |
| @ant-design/pro-field | 2.16.2 | @ant-design/pro-components | 2.8.9 |
| @ant-design/pro-form | 2.30.2 | @ant-design/pro-components | 2.8.9 |
| @ant-design/pro-layout | 6.38.22 | @ant-design/pro-components | 2.8.9 |
| @ant-design/pro-list | 2.5.69 | @ant-design/pro-components | 2.8.9 |
| @ant-design/pro-table | 3.17.2 | @ant-design/pro-components | 2.8.9 |

## 业务需求

### 功能兼容性要求
1. **患者管理**: 患者列表、表单、详情页面必须完全兼容
2. **血糖数据**: CGM数据展示、图表渲染、报告生成功能正常
3. **系统管理**: 用户权限、组织架构、系统设置功能不受影响
4. **移动端**: 移动端患者应用界面保持一致

### 性能要求
1. **首屏加载**: 不超过当前加载时间的110%
2. **打包体积**: 控制在合理范围内，不超过当前大小的120%
3. **运行时性能**: 页面渲染、表单操作响应时间不受影响

### 兼容性要求
1. **浏览器兼容**: 支持Chrome 90+, Firefox 90+, Safari 14+
2. **移动设备**: iOS 14+, Android 10+
3. **屏幕分辨率**: 1920x1080, 1366x768, 移动端各种分辨率

## 技术需求

### 架构变更
1. **CSS架构**: 从Less变量系统迁移到CSS-in-JS token系统
2. **组件导入**: 统一使用@ant-design/pro-components总包
3. **主题配置**: 适配新的ConfigProvider theme配置方式
4. **国际化**: 保持现有多语言支持功能

### 开发体验
1. **TypeScript**: 保持完整的类型支持
2. **热更新**: 开发环境快速热更新功能正常
3. **构建速度**: 构建时间不明显增加
4. **调试体验**: SourceMap和开发工具正常工作

## 质量标准

### 测试覆盖
1. **单元测试**: 所有现有测试用例通过
2. **E2E测试**: 关键业务流程自动化测试通过
3. **手工测试**: 完整的功能回归测试
4. **性能测试**: 关键页面性能基准测试

### 代码质量
1. **ESLint**: 代码规范检查通过
2. **TypeScript**: 类型检查无错误
3. **Prettier**: 代码格式化标准统一
4. **依赖检查**: 无冗余或冲突依赖

## 风险评估

### 高风险项
1. **Pro Layout v7**: API重大变更可能影响整体布局
2. **CSS-in-JS**: 样式系统重构可能导致样式问题
3. **组件API变更**: visible→open等API变更影响功能

### 中风险项
1. **第三方集成**: ECharts、PDF生成等第三方组件兼容性
2. **自定义组件**: 基于antd封装的业务组件适配
3. **UmiJS兼容**: 构建和路由配置兼容性

### 低风险项
1. **业务逻辑**: 纯业务代码不受影响
2. **数据处理**: API调用和数据处理逻辑保持不变
3. **工具函数**: 工具类函数无需改动

## 成功指标

### 功能指标
- [ ] 所有页面正常渲染，无样式差异
- [ ] 所有表单功能正常，数据提交无误
- [ ] 图表组件正常显示数据
- [ ] PDF报告生成功能完整
- [ ] 移动端界面适配正常

### 技术指标
- [ ] 所有自动化测试通过
- [ ] TypeScript编译无错误
- [ ] ESLint检查通过
- [ ] 打包构建成功
- [ ] 开发环境正常运行

### 性能指标
- [ ] 首屏LCP < 2.5s
- [ ] 页面CLS < 0.1
- [ ] 包体积增长 < 20%
- [ ] 内存使用稳定

## 交付物

1. **升级后的代码库**: 完整的升级后代码
2. **升级文档**: 详细的升级过程和变更说明
3. **测试报告**: 完整的测试结果和性能对比
4. **部署指南**: 生产环境部署注意事项
5. **回滚方案**: 紧急情况下的快速回滚步骤

## 时间计划

- **研究准备**: 2-3天
- **核心升级**: 3-4天  
- **代码迁移**: 5-7天
- **测试修复**: 4-6天
- **部署准备**: 2-3天

**总计**: 16-23个工作日

## 验收标准

升级完成后需要满足以下所有条件：
1. 所有现有功能正常工作
2. 所有自动化测试通过
3. 性能指标在可接受范围内
4. 代码质量检查通过
5. 在测试环境稳定运行48小时
6. 产品团队验收通过