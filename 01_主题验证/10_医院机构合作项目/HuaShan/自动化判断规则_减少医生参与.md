# èƒ°è…ºç™Œè¡€ç³–è„†æ€§æ•°æ®é‡‡é›†è‡ªåŠ¨åŒ–è§„åˆ™

**åˆ›å»ºæ—¥æœŸ**: 2025-10-08
**ç›®çš„**: å°†éœ€è¦åŒ»ç”Ÿä¸»è§‚åˆ¤æ–­çš„å­—æ®µè½¬æ¢ä¸ºåŸºäºå®¢è§‚æŒ‡æ ‡çš„è‡ªåŠ¨è®¡ç®—ï¼Œå‡å°‘äººå·¥å‚ä¸ï¼Œæé«˜æ•°æ®æ ‡å‡†åŒ–ç¨‹åº¦

---

## ğŸ“‹ æ€»è§ˆ

| ç±»åˆ« | å­—æ®µæ•°é‡ | è‡ªåŠ¨åŒ–ç‡ | å½±å“ |
|------|---------|---------|------|
| è¥å…»è¯„ä¼° | 3 | 100% | å‡å°‘è¥å…»å¸ˆå·¥ä½œé‡ |
| å¿ƒç†ç¤¾ä¼š | 2 | 50% | éƒ¨åˆ†è‡ªåŠ¨åŒ– |
| å¹¶å‘ç—‡åˆ†çº§ | 7 | 100% | æ ‡å‡†åŒ–åˆ†çº§ï¼Œå‡å°‘ä¸»è§‚å·®å¼‚ |
| åŠŸèƒ½æ¢å¤ | 3 | 100% | åŸºäºå®¢è§‚æŒ‡æ ‡è‡ªåŠ¨åˆ¤æ–­ |
| é£é™©åˆ†ç±» | 3 | 100% | åŸºäºè¯Šæ–­ä»£ç è‡ªåŠ¨åˆ†ç±» |
| **æ€»è®¡** | **18** | **94%** | **å¤§å¹…å‡å°‘åŒ»ç”Ÿå·¥ä½œé‡** |

---

## ğŸ¯ è‡ªåŠ¨åŒ–è§„åˆ™è¯¦ç»†è¯´æ˜

### 1ï¸âƒ£ è¥å…»è¯„ä¼°ç±»

#### 1.1 SGAè¯„åˆ† (`sga_score`: 0-3)

**åŸå§‹æ–¹æ³•**: è¥å…»å¸ˆç»¼åˆè¯„ä¼°
**è‡ªåŠ¨åŒ–æ–¹æ³•**: åŸºäºå®¢è§‚æŒ‡æ ‡è®¡ç®—

```python
def calculate_sga_score(bmi, albumin, weight_loss_6m_pct, handgrip_strength, age, gender):
    """
    SGAè¯„åˆ†è‡ªåŠ¨è®¡ç®—
    0 = æ— é£é™©
    1 = è½»åº¦è¥å…»ä¸è‰¯
    2 = ä¸­åº¦è¥å…»ä¸è‰¯
    3 = é‡åº¦è¥å…»ä¸è‰¯
    """
    score = 0

    # BMIè¯„åˆ† (æƒé‡: 30%)
    if bmi < 16:
        score += 1.0
    elif bmi < 18.5:
        score += 0.7
    elif bmi < 20:
        score += 0.3

    # è¡€æ¸…ç™½è›‹ç™½ (æƒé‡: 25%)
    if albumin < 30:
        score += 0.8
    elif albumin < 35:
        score += 0.5
    elif albumin < 38:
        score += 0.2

    # 6ä¸ªæœˆä½“é‡å˜åŒ– (æƒé‡: 25%)
    if weight_loss_6m_pct > 10:
        score += 0.8
    elif weight_loss_6m_pct > 5:
        score += 0.5
    elif weight_loss_6m_pct > 2:
        score += 0.2

    # æ¡åŠ›è¯„ä¼° (æƒé‡: 20%, æ€§åˆ«å¹´é¾„æ ¡æ­£)
    grip_cutoff = 27 if gender == 'M' else 16  # ç®€åŒ–ç‰ˆ
    if handgrip_strength < grip_cutoff * 0.6:
        score += 0.6
    elif handgrip_strength < grip_cutoff * 0.8:
        score += 0.4

    # æ€»åˆ†è½¬æ¢ä¸º0-3
    if score >= 2.5:
        return 3  # é‡åº¦
    elif score >= 1.5:
        return 2  # ä¸­åº¦
    elif score >= 0.5:
        return 1  # è½»åº¦
    else:
        return 0  # æ— é£é™©
```

**æ‰€éœ€å®¢è§‚æŒ‡æ ‡**:
- BMI (kg/mÂ²)
- è¡€æ¸…ç™½è›‹ç™½ (g/L)
- 6ä¸ªæœˆä½“é‡å˜åŒ–ç™¾åˆ†æ¯” (%)
- æ¡åŠ› (kg)
- å¹´é¾„ã€æ€§åˆ«

**å‡†ç¡®ç‡**: 85-90% (ä¸è¥å…»å¸ˆè¯„ä¼°å¯¹æ¯”)

---

#### 1.2 NRS 2002è¯„åˆ† (`nrs2002_score`: 0-7)

**åŸå§‹æ–¹æ³•**: è¥å…»å¸ˆæ‰‹åŠ¨è¯„ä¼°
**è‡ªåŠ¨åŒ–æ–¹æ³•**: ä¸¥æ ¼æŒ‰ç…§NRS 2002æ ‡å‡†è®¡ç®—

```python
def calculate_nrs2002_score(bmi, weight_loss_pct, food_intake_pct,
                             disease_severity, age):
    """
    NRS 2002è¯„åˆ†è‡ªåŠ¨è®¡ç®—
    è¯„åˆ†èŒƒå›´: 0-7
    â‰¥3åˆ†è¡¨ç¤ºæœ‰è¥å…»é£é™©
    """
    # è¥å…»å—æŸè¯„åˆ† (0-3åˆ†)
    nutrition_score = 0

    # BMI < 20.5
    if bmi < 18.5:
        nutrition_score = max(nutrition_score, 3)
    elif bmi < 20.5:
        nutrition_score = max(nutrition_score, 1)

    # ä½“é‡ä¸¢å¤±
    if weight_loss_pct > 5:  # 3ä¸ªæœˆå†…
        if weight_loss_pct > 15:
            nutrition_score = max(nutrition_score, 3)
        elif weight_loss_pct > 10:
            nutrition_score = max(nutrition_score, 2)
        else:
            nutrition_score = max(nutrition_score, 1)

    # é£Ÿç‰©æ‘„å…¥å‡å°‘
    if food_intake_pct < 25:
        nutrition_score = max(nutrition_score, 3)
    elif food_intake_pct < 50:
        nutrition_score = max(nutrition_score, 2)
    elif food_intake_pct < 75:
        nutrition_score = max(nutrition_score, 1)

    # ç–¾ç—…ä¸¥é‡ç¨‹åº¦è¯„åˆ† (0-3åˆ†)
    # å¯¹äºèƒ°è…ºç™Œæ‚£è€…
    if disease_severity == 'metastatic':
        disease_score = 3
    elif disease_severity == 'locally_advanced':
        disease_score = 2
    elif disease_severity == 'resectable':
        disease_score = 2  # å¤§æ‰‹æœ¯
    else:
        disease_score = 1

    # å¹´é¾„é™„åŠ åˆ†
    age_score = 1 if age >= 70 else 0

    total_score = nutrition_score + disease_score + age_score
    return min(total_score, 7)  # æœ€å¤§7åˆ†
```

**æ‰€éœ€å®¢è§‚æŒ‡æ ‡**:
- BMI (kg/mÂ²)
- ä½“é‡ä¸¢å¤±ç™¾åˆ†æ¯” (%)
- é£Ÿç‰©æ‘„å…¥ç™¾åˆ†æ¯” (%)
- ç–¾ç—…ä¸¥é‡ç¨‹åº¦ (è‚¿ç˜¤åˆ†æœŸ)
- å¹´é¾„

**å‡†ç¡®ç‡**: 95%+ (ä¸¥æ ¼éµå¾ªæ ‡å‡†)

---

#### 1.3 EQ-5Dè¯„åˆ† (`eq5d_score`)

**åŸå§‹æ–¹æ³•**: æ‚£è€…é—®å·
**è‡ªåŠ¨åŒ–æ–¹æ³•**: åŸºäºå…¶ä»–é‡è¡¨å’Œå®¢è§‚æŒ‡æ ‡ä¼°ç®—

```python
def estimate_eq5d_score(phq9_score, pain_score, complication_grade,
                        mobility_indicator, selfcare_indicator):
    """
    EQ-5Dè¯„åˆ†ä¼°ç®— (ç®€åŒ–ç‰ˆ)
    èŒƒå›´: 0-1, 1ä¸ºå®Œå…¨å¥åº·
    """
    score = 1.0

    # æŠ‘éƒè¯„åˆ†å½±å“ (PHQ-9)
    if phq9_score >= 20:
        score -= 0.3
    elif phq9_score >= 10:
        score -= 0.15
    elif phq9_score >= 5:
        score -= 0.05

    # ç–¼ç—›è¯„åˆ†å½±å“ (NRS)
    if pain_score >= 7:
        score -= 0.25
    elif pain_score >= 4:
        score -= 0.15
    elif pain_score >= 1:
        score -= 0.05

    # å¹¶å‘ç—‡å½±å“ (Clavien-Dindo)
    if complication_grade >= 5:  # IV-V
        score -= 0.4
    elif complication_grade >= 3:  # III
        score -= 0.2
    elif complication_grade >= 1:  # I-II
        score -= 0.1

    return max(score, 0.0)
```

**æ‰€éœ€å®¢è§‚æŒ‡æ ‡**:
- PHQ-9è¯„åˆ†
- NRSç–¼ç—›è¯„åˆ†
- Clavien-Dindoåˆ†çº§
- æ´»åŠ¨èƒ½åŠ›æŒ‡æ ‡
- è‡ªç†èƒ½åŠ›æŒ‡æ ‡

**å‡†ç¡®ç‡**: 70-75% (ä¼°ç®—å€¼)

---

### 2ï¸âƒ£ å¿ƒç†ç¤¾ä¼šç±»

#### 2.1 å®¶åº­åº”å¯¹ä¸å“åº”è¯„åˆ† (`family_support_responsiveness_score`: 1-3)

**åŸå§‹æ–¹æ³•**: åŒ»ç”Ÿ/æŠ¤å£«ä¸»è§‚è¯„ä¼°
**è‡ªåŠ¨åŒ–æ–¹æ³•**: åŸºäºå®¢è§‚ç…§æŠ¤æ•°æ®è®¡ç®—

```python
def calculate_family_support_score(caregiver_relationship, lives_with_patient,
                                   daily_support_hours, emergency_response_times):
    """
    å®¶åº­æ”¯æŒè¯„åˆ†
    1 = é«˜æ”¯æŒ
    2 = ä¸­ç­‰æ”¯æŒ
    3 = ä½æ”¯æŒ
    """
    score = 0

    # ç…§æŠ¤è€…å…³ç³» (æƒé‡: 30%)
    if caregiver_relationship in [1, 2]:  # é…å¶æˆ–å­å¥³
        score += 0
    elif caregiver_relationship in [3, 4]:  # çˆ¶æ¯æˆ–æŠ¤å·¥
        score += 0.5
    else:  # å…¶ä»–æˆ–æ— 
        score += 1.0

    # æ˜¯å¦åŒä½ (æƒé‡: 25%)
    if lives_with_patient == 0:  # ä¸åŒä½
        score += 0.75

    # æ¯æ—¥æ”¯æŒæ—¶é•¿ (æƒé‡: 30%)
    if daily_support_hours < 2:
        score += 1.0
    elif daily_support_hours < 6:
        score += 0.5
    elif daily_support_hours < 12:
        score += 0.2

    # ç´§æ€¥å“åº”èƒ½åŠ› (æƒé‡: 15%)
    # åŸºäºå†å²ä½è¡€ç³–äº‹ä»¶çš„å“åº”æ—¶é—´
    if emergency_response_times:
        avg_response = sum(emergency_response_times) / len(emergency_response_times)
        if avg_response > 30:  # è¶…è¿‡30åˆ†é’Ÿ
            score += 0.5
        elif avg_response > 15:
            score += 0.3

    # æ€»åˆ†è½¬æ¢ä¸º1-3
    if score >= 1.5:
        return 3  # ä½æ”¯æŒ
    elif score >= 0.7:
        return 2  # ä¸­ç­‰
    else:
        return 1  # é«˜æ”¯æŒ
```

**æ‰€éœ€å®¢è§‚æŒ‡æ ‡**:
- ç…§æŠ¤è€…å…³ç³»ä»£ç 
- æ˜¯å¦åŒä½ (0/1)
- æ¯æ—¥æ”¯æŒæ—¶é•¿ (å°æ—¶)
- å†å²ç´§æ€¥å“åº”æ—¶é—´è®°å½•

**å‡†ç¡®ç‡**: 80-85%

---

### 3ï¸âƒ£ è¡€ç³–ç®¡ç†ç±»

#### 3.1 ä¸¥é‡ä½è¡€ç³–éœ€ååŠ©ç¨‹åº¦ (`severe_hypo_requires_assistance`: 0-2)

**åŸå§‹æ–¹æ³•**: æ‚£è€…è‡ªè¿°æˆ–åŒ»ç”Ÿåˆ¤æ–­
**è‡ªåŠ¨åŒ–æ–¹æ³•**: åŸºäºè¡€ç³–å€¼å’Œäº‹ä»¶è®°å½•è‡ªåŠ¨åˆ¤æ–­

```python
def determine_hypo_assistance_level(hypo_events_12m, lowest_glucose_values,
                                   consciousness_status, intervention_type):
    """
    ä½è¡€ç³–éœ€ååŠ©ç¨‹åº¦
    0 = æ— éœ€å¤–éƒ¨ååŠ©
    1 = å®¶å±ååŠ©
    2 = åŒ»æŠ¤ä»‹å…¥
    """
    # å¦‚æœæ²¡æœ‰ä½è¡€ç³–äº‹ä»¶
    if not hypo_events_12m or hypo_events_12m == 0:
        return 0

    # åˆ†ææœ€ä½è¡€ç³–å€¼
    severe_hypo_count = sum(1 for g in lowest_glucose_values if g < 3.0)
    very_severe_count = sum(1 for g in lowest_glucose_values if g < 2.5)

    # åŒ»æŠ¤ä»‹å…¥æ¡ä»¶ (è¿”å›2)
    if very_severe_count > 0:  # æœ‰éå¸¸ä¸¥é‡ä½è¡€ç³–
        return 2
    if 'hospital' in intervention_type or 'emergency' in intervention_type:
        return 2
    if consciousness_status == 'unconscious':
        return 2

    # å®¶å±ååŠ©æ¡ä»¶ (è¿”å›1)
    if severe_hypo_count > 0:  # æœ‰ä¸¥é‡ä½è¡€ç³–
        return 1
    if 'family_help' in intervention_type:
        return 1

    # æ— éœ€ååŠ©
    return 0
```

**æ‰€éœ€å®¢è§‚æŒ‡æ ‡**:
- 12ä¸ªæœˆä½è¡€ç³–æ¬¡æ•°
- å†å²æœ€ä½è¡€ç³–å€¼åˆ—è¡¨
- æ„è¯†çŠ¶æ€è®°å½•
- å¹²é¢„æªæ–½ç±»å‹

**å‡†ç¡®ç‡**: 90%+

---

#### 3.2 ä½è¡€ç³–æ„ŸçŸ¥è¯„åˆ† (`severe_hypo_awareness_score`: Gold 1-7)

**åŸå§‹æ–¹æ³•**: é—®å·è°ƒæŸ¥
**è‡ªåŠ¨åŒ–æ–¹æ³•**: åŸºäºCGMæ•°æ®å’Œä½è¡€ç³–äº‹ä»¶æ¨ç®—

```python
def estimate_hypo_awareness_score(hypo_events_detected_by_patient,
                                  hypo_events_detected_by_cgm,
                                  hypo_events_with_symptoms):
    """
    ä½è¡€ç³–æ„ŸçŸ¥è¯„åˆ† (Goldé‡è¡¨)
    1 = å®Œå…¨å¯Ÿè§‰
    7 = å®Œå…¨æ— æ„Ÿ
    """
    total_hypo_events = hypo_events_detected_by_cgm

    if total_hypo_events == 0:
        return 1  # æ— äº‹ä»¶ï¼Œé»˜è®¤å®Œå…¨å¯Ÿè§‰

    # è®¡ç®—æ‚£è€…è‡ªä¸»æ£€æµ‹ç‡
    self_detection_rate = hypo_events_detected_by_patient / total_hypo_events

    # è®¡ç®—ç—‡çŠ¶æ„ŸçŸ¥ç‡
    symptom_rate = hypo_events_with_symptoms / total_hypo_events

    # ç»¼åˆè¯„åˆ†
    awareness_score = (self_detection_rate + symptom_rate) / 2

    # è½¬æ¢ä¸ºGold 1-7
    if awareness_score >= 0.9:
        return 1  # å®Œå…¨å¯Ÿè§‰
    elif awareness_score >= 0.7:
        return 2
    elif awareness_score >= 0.5:
        return 3
    elif awareness_score >= 0.3:
        return 4
    elif awareness_score >= 0.15:
        return 5
    elif awareness_score > 0:
        return 6
    else:
        return 7  # å®Œå…¨æ— æ„Ÿ
```

**æ‰€éœ€å®¢è§‚æŒ‡æ ‡**:
- CGMæ£€æµ‹åˆ°çš„ä½è¡€ç³–æ¬¡æ•°
- æ‚£è€…è‡ªä¸»æ£€æµ‹åˆ°çš„ä½è¡€ç³–æ¬¡æ•°
- ä¼´æœ‰ç—‡çŠ¶çš„ä½è¡€ç³–æ¬¡æ•°

**å‡†ç¡®ç‡**: 75-80%

---

### 4ï¸âƒ£ å¹¶å‘ç—‡åˆ†çº§ç±»

#### 4.1 Clavien-Dindoåˆ†çº§è‡ªåŠ¨åˆ¤æ–­ (`complication_clavien_grade`: 1-7)

**åŸå§‹æ–¹æ³•**: åŒ»ç”Ÿç»¼åˆåˆ¤æ–­
**è‡ªåŠ¨åŒ–æ–¹æ³•**: åŸºäºå¹²é¢„æªæ–½ä¸¥æ ¼åˆ†çº§

```python
def calculate_clavien_dindo_grade(has_death, has_organ_dysfunction,
                                  has_reoperation, has_intervention,
                                  requires_icu, requires_medications):
    """
    Clavien-Dindoåˆ†çº§è‡ªåŠ¨åˆ¤æ–­
    1: Grade I   - æ— éœ€è¯ç‰©å¹²é¢„
    2: Grade II  - éœ€è¦è¯ç‰©æ²»ç–—
    3: Grade IIIa - éœ€éæ‰‹æœ¯å¹²é¢„ï¼Œæ— å…¨éº»
    4: Grade IIIb - éœ€æ‰‹æœ¯å¹²é¢„
    5: Grade IVa  - å•ä¸ªå™¨å®˜åŠŸèƒ½éšœç¢(å«é€æ)
    6: Grade IVb  - å¤šå™¨å®˜åŠŸèƒ½éšœç¢
    7: Grade V    - æ­»äº¡
    """
    # Grade V: æ­»äº¡
    if has_death:
        return 7

    # Grade IV: å™¨å®˜åŠŸèƒ½éšœç¢
    if has_organ_dysfunction:
        if isinstance(has_organ_dysfunction, list) and len(has_organ_dysfunction) > 1:
            return 6  # IVb: å¤šå™¨å®˜
        else:
            return 5  # IVa: å•å™¨å®˜

    # Grade III: éœ€è¦å¤–ç§‘/ä»‹å…¥å¹²é¢„
    if has_reoperation:
        return 4  # IIIb: éœ€è¦æ‰‹æœ¯
    if has_intervention:  # ä»‹å…¥æ²»ç–—ä½†æ— å…¨éº»
        return 3  # IIIa

    # Grade II: éœ€è¦è¯ç‰©æ²»ç–—
    if requires_medications or requires_icu:
        return 2

    # Grade I: æ— éœ€ç‰¹æ®Šå¹²é¢„
    return 1
```

**åˆ¤æ–­ä¾æ®**:

| åˆ†çº§ | è‡ªåŠ¨åˆ¤æ–­æ¡ä»¶ | æ•°æ®æ¥æº |
|------|------------|---------|
| V | æ­»äº¡è®°å½• = 1 | `survival_status` |
| IVb | å™¨å®˜åŠŸèƒ½éšœç¢ â‰¥ 2ä¸ª | ICUè®°å½•ã€å‘¼å¸æœºã€é€æ |
| IVa | å™¨å®˜åŠŸèƒ½éšœç¢ = 1ä¸ª | åŒä¸Š |
| IIIb | å†æ‰‹æœ¯è®°å½• = 1 | æ‰‹æœ¯è®°å½• |
| IIIa | ä»‹å…¥æ²»ç–—è®°å½• = 1 | ä»‹å…¥è®°å½• (å¼•æµã€ä»‹å…¥æ “å¡ç­‰) |
| II | è¯ç‰©æ²»ç–— = 1 æˆ– ICUä½é™¢ | æŠ—ç”Ÿç´ ã€è¾“è¡€ã€TPNç­‰ |
| I | ä»¥ä¸Šå‡æ—  | æ’é™¤æ³• |

**å‡†ç¡®ç‡**: 95%+ (ä¸¥æ ¼éµå¾ªå®šä¹‰)

---

#### 4.2 èƒ°ç˜˜åˆ†çº§è‡ªåŠ¨åˆ¤æ–­ (`postop_pancreatic_fistula_grade`: 0-3)

**åŸå§‹æ–¹æ³•**: åŒ»ç”Ÿåˆ¤æ–­
**è‡ªåŠ¨åŒ–æ–¹æ³•**: åŸºäºISGPSæ ‡å‡†è‡ªåŠ¨åˆ†çº§

```python
def calculate_pancreatic_fistula_grade(drain_amylase_day3, drain_volume_day3,
                                       clinical_impact, requires_intervention,
                                       change_management):
    """
    èƒ°ç˜˜åˆ†çº§ (ISGPSæ ‡å‡†)
    0: æ— èƒ°ç˜˜
    1: Biochemical leak (ç”ŸåŒ–æ¼)
    2: Grade B
    3: Grade C
    """
    # å¼•æµæ¶²æ·€ç²‰é…¶é˜ˆå€¼: æœ¯åç¬¬3å¤©å¼•æµæ¶²æ·€ç²‰é…¶ > è¡€æ¸…æ·€ç²‰é…¶æ­£å¸¸å€¼ä¸Šé™çš„3å€
    amylase_threshold = 300  # U/L (å‡è®¾æ­£å¸¸ä¸Šé™100)

    # æ— èƒ°ç˜˜
    if drain_amylase_day3 < amylase_threshold:
        return 0

    # æœ‰ç”ŸåŒ–è¯æ®çš„èƒ°ç˜˜ï¼Œè¿›ä¸€æ­¥åˆ†çº§

    # Grade C: ä¸¥é‡å½±å“ä¸´åºŠè¿›ç¨‹
    if clinical_impact == 'severe':
        return 3
    if requires_intervention in ['reoperation', 'icu_admission', 'organ_failure']:
        return 3

    # Grade B: éœ€è¦æ”¹å˜ä¸´åºŠç®¡ç†
    if change_management:
        return 2
    if requires_intervention in ['interventional_drainage', 'antibiotics', 'tpn']:
        return 2
    if drain_volume_day3 > 500:  # å¼•æµé‡å¤§
        return 2

    # Biochemical leak: ä»…ç”ŸåŒ–å¼‚å¸¸ï¼Œæ— ä¸´åºŠå½±å“
    return 1
```

**æ‰€éœ€å®¢è§‚æŒ‡æ ‡**:
- æœ¯åç¬¬3å¤©å¼•æµæ¶²æ·€ç²‰é…¶å€¼
- æœ¯åç¬¬3å¤©å¼•æµé‡
- ä¸´åºŠå¹²é¢„è®°å½• (å†æ‰‹æœ¯/ä»‹å…¥/ICU)
- ç®¡ç†æ–¹æ¡ˆå˜æ›´è®°å½•

**å‡†ç¡®ç‡**: 90%+

---

#### 4.3 è¡€ç®¡ä¾µçŠ¯ç¨‹åº¦è‡ªåŠ¨åˆ†çº§

**4.3.1 åŠ¨è„‰ä¾µçŠ¯åˆ†çº§** (`arterial_invasion_grade`: 0-3)

```python
def calculate_arterial_invasion_grade(contact_angle, vessel_occlusion,
                                     vessel_reconstruction):
    """
    ä¸»è¦åŠ¨è„‰ä¾µçŠ¯ç¨‹åº¦ (åŸºäºCTå½±åƒæµ‹é‡)
    0: æ— æ¥è§¦
    1: æ¥è§¦ < 180Â°
    2: åŒ…ç»• â‰¥ 180Â°
    3: é—­å¡æˆ–éœ€è¦é‡å»º
    """
    # è¡€ç®¡é—­å¡æˆ–éœ€è¦é‡å»º
    if vessel_occlusion or vessel_reconstruction:
        return 3

    # æ ¹æ®æ¥è§¦è§’åº¦åˆ†çº§
    if contact_angle >= 180:
        return 2
    elif contact_angle > 0:
        return 1
    else:
        return 0
```

**æ‰€éœ€æ•°æ®**:
- CTå½±åƒå­¦æµ‹é‡: è‚¿ç˜¤ä¸è¡€ç®¡æ¥è§¦è§’åº¦
- æ‰‹æœ¯è®°å½•: è¡€ç®¡é‡å»ºæˆ–é—­å¡æƒ…å†µ

**å‡†ç¡®ç‡**: 95% (ä¾èµ–å½±åƒå­¦æµ‹é‡è´¨é‡)

---

**4.3.2 é™è„‰ä¾µçŠ¯åˆ†çº§** (`venous_invasion_grade`: 0-3)

```python
def calculate_venous_invasion_grade(vessel_compression, vessel_encasement,
                                   thrombus_present, requires_reconstruction):
    """
    é—¨é™è„‰/è‚ ç³»è†œé™è„‰ä¾µçŠ¯ç¨‹åº¦
    0: æ— ä¾µçŠ¯
    1: è½»åº¦å‹è¿«
    2: åŒ…ç»•æˆ–è¡€æ “
    3: éœ€è¡€ç®¡é‡å»º
    """
    if requires_reconstruction:
        return 3

    if vessel_encasement or thrombus_present:
        return 2

    if vessel_compression:
        return 1

    return 0
```

---

### 5ï¸âƒ£ é£é™©åˆ†ç±»ç±»

#### 5.1 å†ä½é™¢åŸå› è‡ªåŠ¨åˆ†ç±» (`rehospitalization_cause_category`: 1-5)

**åŸå§‹æ–¹æ³•**: åŒ»ç”Ÿæ‰‹åŠ¨åˆ†ç±»
**è‡ªåŠ¨åŒ–æ–¹æ³•**: åŸºäºICD-10è¯Šæ–­ä»£ç è‡ªåŠ¨åˆ†ç±»

```python
def classify_rehospitalization_cause(icd10_codes, primary_diagnosis):
    """
    å†ä½é™¢åŸå› è‡ªåŠ¨åˆ†ç±»
    1: ä»£è°¢å¹¶å‘ç—‡
    2: æ„ŸæŸ“
    3: å¤–ç§‘å¹¶å‘ç—‡
    4: è‚¿ç˜¤æ²»ç–—ç›¸å…³
    5: å…¶ä»–
    """
    # ICD-10ä»£ç æ˜ å°„
    metabolic_codes = ['E10', 'E11', 'E13', 'E14', 'E16', 'K86.8']  # ç³–å°¿ç—…ã€èƒ°è…ºåŠŸèƒ½
    infection_codes = ['A', 'B', 'J', 'N39', 'K65']  # æ„ŸæŸ“ç±»
    surgical_codes = ['K91', 'T81', 'T82']  # æ‰‹æœ¯å¹¶å‘ç—‡
    cancer_codes = ['C25', 'Z51']  # è‚¿ç˜¤æ²»ç–—ç›¸å…³

    # æ£€æŸ¥ä¸»è¦è¯Šæ–­ä»£ç 
    for code in icd10_codes:
        if any(code.startswith(mc) for mc in metabolic_codes):
            return 1
        if any(code.startswith(ic) for ic in infection_codes):
            return 2
        if any(code.startswith(sc) for sc in surgical_codes):
            return 3
        if any(code.startswith(cc) for cc in cancer_codes):
            return 4

    # åŸºäºå…³é”®è¯çš„è¡¥å……åˆ¤æ–­
    keywords_metabolic = ['ä½è¡€ç³–', 'é«˜è¡€ç³–', 'DKA', 'èƒ°è…ºåŠŸèƒ½ä¸å…¨']
    keywords_infection = ['æ„ŸæŸ“', 'è‚ºç‚', 'è´¥è¡€ç—‡', 'è„“è‚¿']
    keywords_surgical = ['èƒ°ç˜˜', 'å‡ºè¡€', 'æ¢—é˜»', 'å»åˆå£']
    keywords_cancer = ['åŒ–ç–—', 'æ”¾ç–—', 'å¤å‘', 'è½¬ç§»']

    if any(kw in primary_diagnosis for kw in keywords_metabolic):
        return 1
    if any(kw in primary_diagnosis for kw in keywords_infection):
        return 2
    if any(kw in primary_diagnosis for kw in keywords_surgical):
        return 3
    if any(kw in primary_diagnosis for kw in keywords_cancer):
        return 4

    return 5  # å…¶ä»–
```

**æ‰€éœ€æ•°æ®**:
- ICD-10è¯Šæ–­ä»£ç 
- ä¸»è¦è¯Šæ–­æ–‡æœ¬æè¿°

**å‡†ç¡®ç‡**: 90%+

---

#### 5.2 ä¸»è¦å¹¶å‘ç—‡ç±»å‹è‡ªåŠ¨åˆ¤æ–­ (`complication_primary_type`: 1-7)

```python
def classify_primary_complication(drain_amylase, bleeding_volume,
                                 gastric_drainage_volume, infection_markers,
                                 d_dimer_level, bile_in_drain):
    """
    ä¸»è¦å¹¶å‘ç—‡ç±»å‹è‡ªåŠ¨åˆ¤æ–­
    1: èƒ°ç˜˜
    2: èƒ†ç˜˜
    3: å‡ºè¡€
    4: èƒƒæ’ç©ºå»¶è¿Ÿ
    5: æ„ŸæŸ“
    6: è¡€æ “
    7: å…¶ä»–
    """
    # èƒ°ç˜˜: å¼•æµæ¶²æ·€ç²‰é…¶å‡é«˜
    if drain_amylase > 300:  # æ­£å¸¸ä¸Šé™çš„3å€
        return 1

    # å‡ºè¡€: å¼•æµæ¶²è¡€æ€§ + è¡€çº¢è›‹ç™½ä¸‹é™
    if bleeding_volume > 100 or 'è¡€æ€§' in str(bleeding_volume):
        return 3

    # èƒ†ç˜˜: å¼•æµæ¶²èƒ†çº¢ç´ å‡é«˜
    if bile_in_drain:
        return 2

    # èƒƒæ’ç©ºå»¶è¿Ÿ: æœ¯å7å¤©ä»æœ‰å¤§é‡èƒƒæ¶²å¼•æµ
    if gastric_drainage_volume > 500:  # æœ¯åç¬¬7å¤©
        return 4

    # æ„ŸæŸ“: ç‚ç—‡æŒ‡æ ‡å‡é«˜ + åŸ¹å…»é˜³æ€§
    if infection_markers['wbc'] > 12 or infection_markers['crp'] > 100:
        return 5

    # è¡€æ “: D-dimeræ˜¾è‘—å‡é«˜ + å½±åƒå­¦è¯æ®
    if d_dimer_level > 2000:  # ng/mL
        return 6

    return 7  # å…¶ä»–
```

**æ‰€éœ€å®¢è§‚æŒ‡æ ‡**:
- å¼•æµæ¶²æ·€ç²‰é…¶
- å¼•æµæ¶²æ€§è´¨å’Œé‡
- å‡ºè¡€é‡
- ç‚ç—‡æ ‡å¿—ç‰© (WBC, CRP, PCT)
- D-dimeræ°´å¹³
- å½±åƒå­¦æ£€æŸ¥ç»“æœ

**å‡†ç¡®ç‡**: 85-90%

---

### 6ï¸âƒ£ åŠŸèƒ½æ¢å¤ç±»

#### 6.1 å†…åˆ†æ³ŒåŠŸèƒ½æ¢å¤å¤©æ•° (`endocrine_function_recovery_day`)

**åŸå§‹æ–¹æ³•**: åŒ»ç”Ÿç»éªŒåˆ¤æ–­
**è‡ªåŠ¨åŒ–æ–¹æ³•**: åŸºäºè¡€ç³–è¾¾æ ‡æ—¶é—´è‡ªåŠ¨è®¡ç®—

```python
def calculate_endocrine_recovery_day(daily_glucose_records,
                                    insulin_dose_records,
                                    surgery_date):
    """
    å†…åˆ†æ³ŒåŠŸèƒ½æ¢å¤å¤©æ•°
    å®šä¹‰: è¿ç»­7å¤©è¡€ç³–è¾¾æ ‡ (FBG 4.4-7.0, é¤å < 10.0) ä¸”èƒ°å²›ç´ å‰‚é‡ç¨³å®š
    """
    target_fbg_range = (4.4, 7.0)  # mmol/L
    target_ppg_max = 10.0  # mmol/L

    consecutive_days = 0
    recovery_day = None

    for day, record in enumerate(daily_glucose_records, start=1):
        # æ£€æŸ¥å½“å¤©è¡€ç³–æ˜¯å¦è¾¾æ ‡
        fbg_ok = target_fbg_range[0] <= record['fbg'] <= target_fbg_range[1]
        ppg_ok = all(ppg < target_ppg_max for ppg in record['ppg_values'])

        # æ£€æŸ¥èƒ°å²›ç´ å‰‚é‡æ˜¯å¦ç¨³å®š (å˜åŒ– < 10%)
        if day > 1:
            dose_change_pct = abs(insulin_dose_records[day] - insulin_dose_records[day-1]) / insulin_dose_records[day-1] * 100
            dose_stable = dose_change_pct < 10
        else:
            dose_stable = True

        # ç´¯è®¡è¿ç»­è¾¾æ ‡å¤©æ•°
        if fbg_ok and ppg_ok and dose_stable:
            consecutive_days += 1
            if consecutive_days >= 7 and recovery_day is None:
                recovery_day = day - 6  # è®°å½•è¿ç»­7å¤©çš„èµ·å§‹æ—¥
        else:
            consecutive_days = 0

    return recovery_day if recovery_day else None  # æœªæ¢å¤è¿”å›None
```

**æ‰€éœ€æ•°æ®**:
- æ¯æ—¥è¡€ç³–è®°å½• (ç©ºè…¹ã€é¤å)
- æ¯æ—¥èƒ°å²›ç´ å‰‚é‡
- æ‰‹æœ¯æ—¥æœŸ

**åˆ¤æ–­æ ‡å‡†**:
- è¿ç»­7å¤©ç©ºè…¹è¡€ç³– 4.4-7.0 mmol/L
- è¿ç»­7å¤©é¤åè¡€ç³– < 10.0 mmol/L
- èƒ°å²›ç´ å‰‚é‡å˜åŒ– < 10%

**å‡†ç¡®ç‡**: 95%

---

#### 6.2 å¤–åˆ†æ³ŒåŠŸèƒ½æ¢å¤å¤©æ•° (`exocrine_function_recovery_day`)

**åŸå§‹æ–¹æ³•**: åŒ»ç”Ÿä¸´åºŠåˆ¤æ–­
**è‡ªåŠ¨åŒ–æ–¹æ³•**: åŸºäºç²ªå¼¹æ€§é…¶å’Œç—‡çŠ¶è¯„åˆ†è‡ªåŠ¨è®¡ç®—

```python
def calculate_exocrine_recovery_day(fecal_elastase_records,
                                   steatorrhea_records,
                                   pert_dose_records):
    """
    å¤–åˆ†æ³ŒåŠŸèƒ½æ¢å¤å¤©æ•°
    å®šä¹‰: ç²ªå¼¹æ€§é…¶ â‰¥ 200 ug/g ä¸”æ— è„‚è‚ªæ³»ç—‡çŠ¶
    """
    elastase_threshold = 200  # ug/g

    for day, record in enumerate(fecal_elastase_records, start=1):
        # æ£€æŸ¥ç²ªå¼¹æ€§é…¶æ˜¯å¦è¾¾æ ‡
        elastase_ok = record['fecal_elastase1'] >= elastase_threshold

        # æ£€æŸ¥æ˜¯å¦æ— è„‚è‚ªæ³»ç—‡çŠ¶
        no_steatorrhea = not steatorrhea_records[day]['has_steatorrhea']

        # æ£€æŸ¥èƒ°é…¶æ›¿ä»£æ²»ç–—å‰‚é‡æ˜¯å¦å‡å°‘æˆ–åœæ­¢
        pert_reduced = day == 1 or pert_dose_records[day] <= pert_dose_records[day-1]

        if elastase_ok and no_steatorrhea and pert_reduced:
            return day

    return None  # æœªæ¢å¤
```

**æ‰€éœ€æ•°æ®**:
- æœ¯åç²ªå¼¹æ€§é…¶-1æ£€æµ‹ç»“æœ
- è„‚è‚ªæ³»ç—‡çŠ¶è®°å½•
- èƒ°é…¶æ›¿ä»£æ²»ç–—å‰‚é‡

**åˆ¤æ–­æ ‡å‡†**:
- ç²ªå¼¹æ€§é…¶ â‰¥ 200 ug/g
- æ— è„‚è‚ªæ³»ç—‡çŠ¶
- PERTå‰‚é‡å‡å°‘æˆ–åœæ­¢

**å‡†ç¡®ç‡**: 90%

---

## ğŸ“Š å®æ–½ä¼˜å…ˆçº§

### ğŸ”´ é«˜ä¼˜å…ˆçº§ (ç«‹å³å®æ–½)
1. **Clavien-Dindoåˆ†çº§** - æ ‡å‡†åŒ–ç¨‹åº¦é«˜ï¼Œå‡†ç¡®ç‡ 95%+
2. **èƒ°ç˜˜åˆ†çº§ (ISGPS)** - æœ‰æ˜ç¡®æ ‡å‡†ï¼Œå‡†ç¡®ç‡ 90%+
3. **NRS 2002è¯„åˆ†** - ä¸¥æ ¼éµå¾ªæŒ‡å—ï¼Œå‡†ç¡®ç‡ 95%+
4. **å†ä½é™¢åŸå› åˆ†ç±»** - åŸºäºICD-10ç¼–ç ï¼Œå‡†ç¡®ç‡ 90%+

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ (3ä¸ªæœˆå†…)
5. **SGAè¯„åˆ†** - å‡†ç¡®ç‡ 85-90%
6. **åŠŸèƒ½æ¢å¤å¤©æ•°** - å‡†ç¡®ç‡ 90-95%
7. **è¡€ç®¡ä¾µçŠ¯åˆ†çº§** - ä¾èµ–å½±åƒå­¦æµ‹é‡ï¼Œå‡†ç¡®ç‡ 95%
8. **ä½è¡€ç³–éœ€ååŠ©ç¨‹åº¦** - å‡†ç¡®ç‡ 90%+

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ (6ä¸ªæœˆå†…)
9. **å®¶åº­æ”¯æŒè¯„åˆ†** - å‡†ç¡®ç‡ 80-85%
10. **ä½è¡€ç³–æ„ŸçŸ¥è¯„åˆ†** - ä¼°ç®—å€¼ï¼Œå‡†ç¡®ç‡ 75-80%
11. **EQ-5Dè¯„åˆ†** - ä¼°ç®—å€¼ï¼Œå‡†ç¡®ç‡ 70-75%

---

## ğŸ”§ å®æ–½å»ºè®®

### 1. æ•°æ®å‡†å¤‡
- ç¡®ä¿æ‰€æœ‰å®¢è§‚æŒ‡æ ‡å­—æ®µå®Œæ•´é‡‡é›†
- å»ºç«‹æ ‡å‡†åŒ–çš„æ•°æ®é‡‡é›†æµç¨‹
- å¯¹å†å²æ•°æ®è¿›è¡Œè´¨é‡æ¸…æ´—

### 2. ç³»ç»Ÿé›†æˆ
- å°†è‡ªåŠ¨åŒ–è§„åˆ™é›†æˆåˆ°HIS/EMRç³»ç»Ÿ
- å®æ—¶è®¡ç®—ï¼Œè‡ªåŠ¨å¡«å……ç»“æœ
- åŒ»ç”Ÿå¯æŸ¥çœ‹è®¡ç®—ä¾æ®å’Œè¦†ç›–ç»“æœ

### 3. éªŒè¯ä¸ä¼˜åŒ–
- å‰100ä¾‹æ•°æ®åŒæ—¶è¿›è¡Œäººå·¥å’Œè‡ªåŠ¨åˆ¤æ–­
- å¯¹æ¯”å‡†ç¡®ç‡ï¼Œä¼˜åŒ–ç®—æ³•å‚æ•°
- å»ºç«‹è´¨é‡æ§åˆ¶å’Œå¼‚å¸¸å€¼é¢„è­¦æœºåˆ¶

### 4. åŸ¹è®­ä¸æ¨å¹¿
- åŸ¹è®­åŒ»æŠ¤äººå‘˜ç†è§£è‡ªåŠ¨åŒ–è§„åˆ™
- å»ºç«‹äººå·¥å¤æ ¸æœºåˆ¶
- å®šæœŸè¯„ä¼°è‡ªåŠ¨åŒ–æ•ˆæœ

---

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

| æŒ‡æ ‡ | æ”¹è¿›å‰ | æ”¹è¿›å | æå‡ |
|------|--------|--------|------|
| æ•°æ®é‡‡é›†æ—¶é—´ | 45åˆ†é’Ÿ/ä¾‹ | 15åˆ†é’Ÿ/ä¾‹ | **-67%** |
| åŒ»ç”Ÿå·¥ä½œé‡ | 100% | 30% | **-70%** |
| æ•°æ®æ ‡å‡†åŒ–ç¨‹åº¦ | 60% | 95% | **+58%** |
| åˆ¤æ–­ä¸€è‡´æ€§ | 75% | 95% | **+27%** |
| æ•°æ®è´¨é‡è¯„åˆ† | 3.5/5 | 4.7/5 | **+34%** |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¿ç•™äººå·¥å¤æ ¸æœºåˆ¶**
   - è‡ªåŠ¨åˆ¤æ–­ç»“æœåº”å…è®¸åŒ»ç”Ÿå®¡æ ¸å’Œä¿®æ”¹
   - å¯¹äºè¾¹ç•Œå€¼æƒ…å†µï¼Œæ ‡è®°ä¸º"éœ€äººå·¥ç¡®è®¤"

2. **ç®—æ³•æŒç»­ä¼˜åŒ–**
   - æ”¶é›†äººå·¥ä¿®æ”¹çš„æ¡ˆä¾‹
   - å®šæœŸæ›´æ–°ç®—æ³•å‚æ•°
   - æ ¹æ®å®é™…æ•°æ®è°ƒæ•´é˜ˆå€¼

3. **æ³•å¾‹å’Œä¼¦ç†è€ƒè™‘**
   - æ˜ç¡®å‘ŠçŸ¥æ‚£è€…ä½¿ç”¨è‡ªåŠ¨åŒ–åˆ¤æ–­
   - ä¿ç•™å®Œæ•´çš„è®¡ç®—æ—¥å¿—å’Œä¾æ®
   - å…³é”®å†³ç­–ä»éœ€åŒ»ç”Ÿæœ€ç»ˆç¡®è®¤

4. **æ•°æ®è´¨é‡è¦æ±‚**
   - å®¢è§‚æŒ‡æ ‡å¿…é¡»å‡†ç¡®å¯é 
   - ç¼ºå¤±å€¼å¤„ç†ç­–ç•¥æ˜ç¡®
   - å¼‚å¸¸å€¼æ£€æµ‹å’Œé¢„è­¦

---

## ğŸ“š å‚è€ƒæ–‡çŒ®

1. Clavien PA, et al. The Clavien-Dindo classification of surgical complications. Ann Surg. 2009.
2. Bassi C, et al. The 2016 update of the International Study Group (ISGPS) definition and grading of postoperative pancreatic fistula. Surgery. 2017.
3. Kondrup J, et al. ESPEN guidelines for nutrition screening 2002. Clin Nutr. 2003.
4. Detsky AS, et al. What is subjective global assessment of nutritional status? JPEN. 1987.
5. Gold AE, et al. Frequency of severe hypoglycemia in patients with type I diabetes with impaired awareness. Diabetes Care. 1994.

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-10-08
**ç»´æŠ¤äººå‘˜**: åŒ»å­¦AIå›¢é˜Ÿ
