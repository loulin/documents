# 胰腺癌患者血糖脆性分型与预测 - 模拟数据验证

**创建日期**: 2025-10-07
**项目状态**: 模拟数据验证完成 ✅
**下一步**: 准备真实数据分析

---

## 📋 项目概述

本项目通过虚拟数据验证了胰腺癌患者围手术期血糖脆性分型和预测模型的可行性。

### 核心目标
1. 建立术前血糖脆性三级分型（低/中/高）
2. 预测术后3个月血糖脆性恶化风险
3. 识别关键影响因素
4. 生成个性化临床管理建议

---

## 📁 文件结构

```
2025-10-07_胰腺癌血糖脆性模拟分析/
│
├── README.md                        # 项目总览（本文档）
├── 说明.md                          # 详细说明文档
├── 运行全部.sh                      # 一键运行脚本
│
├── [Python脚本]
├── 01_模拟患者数据生成.py           # 生成50例虚拟患者数据
├── 02_血糖脆性分析.py               # 分析和预测建模
├── 03_可视化与报告.py               # 生成图表和报告
│
├── [数据文件]
├── 虚拟患者数据_术前术中术后.csv    # 生成的数据集（50例×68特征）
├── 血糖脆性分析报告.txt             # 模型性能和临床洞察
│
└── [可视化结果]
    └── 可视化结果/
        ├── 01_脆性分布.png          # 脆性和风险分布饼图
        ├── 02_术前术后对比.png      # HbA1c/TIR/CV/MAGE对比
        ├── 03_时间轨迹.png          # TIR和CV时间演变
        ├── 04_风险转移矩阵.png      # 术前→术后风险转移
        ├── 05_并发症影响.png        # 并发症对风险的影响
        ├── 06_相关性热图.png        # 关键指标相关性
        ├── 患者报告_PC0001.txt     # 示例患者1报告
        ├── 患者报告_PC0002.txt     # 示例患者2报告
        └── 患者报告_PC0003.txt     # 示例患者3报告
```

---

## 🚀 快速开始

### 方法1: 一键运行（推荐）
```bash
cd "2025-10-07_胰腺癌血糖脆性模拟分析"
./运行全部.sh
```

### 方法2: 分步运行
```bash
# 1. 安装依赖
pip install pandas numpy scikit-learn matplotlib seaborn

# 2. 生成数据
python 01_模拟患者数据生成.py

# 3. 运行分析
python 02_血糖脆性分析.py

# 4. 生成可视化
python 03_可视化与报告.py
```

---

## 📊 核心发现

### 1. 患者基线特征（n=50）
| 脆性类型 | 患者数 | 比例 | 平均HbA1c | 平均TIR |
|---------|--------|------|-----------|---------|
| 低脆性 | 17 | 34% | 6.0% | 90% |
| 中脆性 | 23 | 46% | 7.3% | 68% |
| 高脆性 | 10 | 20% | 9.2% | 43% |

### 2. 术前→术后指标变化
| 指标 | 术前均值 | 术后3月均值 | 变化幅度 |
|------|---------|------------|---------|
| HbA1c(%) | 7.34 | 7.76 | +5.7% ⬆️ |
| TIR(%) | 70.3 | 68.9 | -1.9% ⬇️ |
| CV(%) | 34.6 | 38.2 | +10.2% ⬆️ |
| MAGE(mmol/L) | 3.59 | 4.37 | +21.5% ⬆️ |

**💡 关键洞察**: MAGE增幅最大（+21.5%），提示术后血糖波动显著加剧

### 3. 风险转移矩阵
| 术前脆性 → 术后风险 | 低风险 | 中风险 | 高风险 |
|--------------------|--------|--------|--------|
| **低脆性** | 100% | 0% | 0% |
| **中脆性** | 0% | 70% | 30% |
| **高脆性** | 0% | 0% | 100% |

**💡 关键洞察**:
- 低脆性患者术后风险稳定
- 30%的中脆性患者恶化为高风险
- 高脆性患者100%保持高风险

### 4. 并发症影响
| 并发症类型 | 高风险比例 |
|-----------|-----------|
| 严重胰瘘(B/C级) | 100% 🔴 |
| 迟发性胃排空 | 69.2% 🟠 |
| 术后感染 | 45.5% 🟡 |

### 5. 模型性能
**Random Forest分类器**:
- 准确率: **80%**
- 交叉验证: **87.5%** (±22.4%)
- 对低风险患者预测最准确 (F1=1.00)

**Gradient Boosting分类器**:
- 准确率: **70%**
- 交叉验证: **72.5%** (±24.5%)

---

## 🔑 关键特征重要性 Top 10

根据Random Forest模型分析：

1. **术前CGM-TIR** - 最重要预测因子
2. **术前HbA1c** - 基线血糖控制
3. **糖尿病病程** - 疾病持续时间
4. **术前MAGE** - 基线血糖波动
5. **术后72h CV** - 早期恢复指标
6. **术前胰岛素剂量** - 治疗强度
7. **肿瘤分期** - 疾病严重程度
8. **术中胰岛素输注速率** - 围术期管理
9. **术后并发症** - 术后恢复情况
10. **手术类型** - 手术创伤程度

**💡 临床意义**: 术前TIR和HbA1c是最强预测因子，术后72小时CV是早期预警指标

---

## 🎯 临床应用建议

### 术前评估（手术前1-2周）
✅ **必须做**:
- CGM监测至少14天，计算TIR、CV、MAGE
- 评估HbA1c，目标<7.5%
- 识别高脆性患者（TIR<60%或CV>40%）

⚠️ **高脆性患者**:
- 延迟手术，强化血糖控制2-4周
- 考虑胰岛素泵或CGM辅助
- 多学科会诊制定方案

### 围术期管理（手术中和术后3天）
✅ **必须做**:
- 持续CGM监测
- 目标血糖6-10 mmol/L
- 精准胰岛素输注（避免大波动）
- 预防低血糖（特别是高脆性患者）

⚠️ **术后72小时警戒指标**:
- CV >45% → 高度警惕
- TIR <50% → 加强监测
- 低血糖≥2次 → 调整方案

### 术后随访（出院后3个月）
✅ **低风险患者**:
- 每月随访
- HbA1c每3个月
- 自我血糖监测

⚠️ **中高风险患者**:
- 每2周随访
- CGM监测至少1个月
- HbA1c每1.5个月
- 营养和胰酶评估

---

## 🔬 方法学说明

### 数据模拟方法
基于文献和临床经验，模拟了50例患者的完整数据：
- 术前: 糖尿病基线、CGM指标、肿瘤特征
- 术中: 手术信息、胰岛素管理、血糖波动
- 术后: 并发症、72h/2周/3月CGM轨迹

### 脆性分型标准
| 分型 | HbA1c | TIR | CV | MAGE |
|------|-------|-----|-----|------|
| 低 | 5.5-6.5% | 85-95% | 20-30% | 1.5-2.5 |
| 中 | 6.5-8.0% | 60-75% | 30-40% | 3.0-4.5 |
| 高 | 8.0-10.5% | 30-55% | 40-55% | 4.8-7.0 |

### 预测模型
- **输入特征**: 术前和术后早期（≤2周）数据
- **输出**: 未来3个月脆性恶化风险（低/中/高）
- **算法**: Random Forest + Gradient Boosting
- **验证**: 5-fold交叉验证

---

## ⚠️ 局限性

1. **虚拟数据**: 基于假设生成，可能不完全反映真实临床情况
2. **样本量小**: 仅50例，统计效能有限
3. **缺乏验证**: 需要独立数据集验证
4. **简化因素**: 未考虑所有临床变量（如具体用药、心理因素等）

---

## 🔄 下一步计划

### ✅ 已完成
- [x] 虚拟数据生成
- [x] 基础预测模型
- [x] 可视化和报告
- [x] 项目框架验证

### 🎯 近期计划（1-2个月）
- [ ] 增加样本量到200例
- [ ] 尝试深度学习模型（LSTM时序预测）
- [ ] 敏感性分析
- [ ] 特征工程优化

### 🚀 中期计划（3-6个月）
- [ ] 真实数据采集方案
- [ ] 伦理审批准备
- [ ] 前瞻性队列研究设计
- [ ] 数据标注和质控规范

### 🏆 长期目标（6-12个月）
- [ ] 多中心真实数据验证
- [ ] 开发临床决策支持系统
- [ ] 集成到医院HIS系统
- [ ] 发表研究论文

---

## 📚 参考资料

**项目相关文档**:
1. `说明.md` - 详细技术说明
2. `../胰腺癌患者血糖脆性虚拟数据与解释.md` - 数据设计理念
3. `../胰腺癌血糖脆性分型与预测项目_优化方法.md` - 优化策略
4. `../pancreatic_cancer_glycemic_brittleness_factors.csv` - 数据字典

**CGM指标参考**:
- TIR: Time in Range (3.9-10.0 mmol/L), 目标≥70%
- CV: Coefficient of Variation, 目标<36%
- MAGE: Mean Amplitude of Glycemic Excursions, 目标<3.9 mmol/L
- GMI: Glucose Management Indicator, 估算HbA1c

---

## 👥 团队信息

- **项目负责**: 医学AI团队
- **合作单位**: 华山医院
- **技术支持**: Python 3.x + scikit-learn + pandas
- **创建日期**: 2025-10-07
- **最后更新**: 2025-10-07

---

## 📞 联系方式

如有问题或建议，请查看项目文档或联系项目组。

---

## 📄 许可声明

本项目仅用于科研和临床研究目的，不得用于商业用途。
数据和代码遵循医学研究伦理规范。

---

**状态**: ✅ 模拟验证完成
**下一步**: 准备真实数据采集
