# 胰腺癌患者血糖脆性分型与预测项目

## 项目概述

本项目旨在建立胰腺癌患者围手术期血糖脆性分型和预测模型，通过CGM（连续血糖监测）数据和临床特征，实现：
1. 术前血糖脆性分型（低/中/高）
2. 术后血糖脆性恶化风险预测
3. 个体化临床管理建议

## 项目结构

```
HuaShan/
├── README_胰腺癌血糖脆性项目.md          # 本文档
├── pancreatic_cancer_glycemic_brittleness_factors.csv  # 数据字典
│
├── 01_模拟患者数据生成.py               # 虚拟患者数据生成脚本
├── 02_血糖脆性分析.py                   # 血糖脆性分析和预测建模
├── 03_可视化与报告.py                   # 可视化和报告生成
│
├── 虚拟患者数据_术前术中术后.csv        # 生成的虚拟数据（50例）
├── 血糖脆性分析报告.txt                 # 分析报告
│
└── 可视化结果/                          # 可视化图表和患者报告
    ├── 01_脆性分布.png
    ├── 02_术前术后对比.png
    ├── 03_时间轨迹.png
    ├── 04_风险转移矩阵.png
    ├── 05_并发症影响.png
    ├── 06_相关性热图.png
    └── 患者报告_*.txt
```

## 快速开始

### 1. 环境准备

```bash
pip install pandas numpy scikit-learn matplotlib seaborn
```

### 2. 运行完整流程

**步骤1：生成虚拟患者数据**
```bash
python 01_模拟患者数据生成.py
```
- 生成50例虚拟患者数据
- 包含术前、术中、术后完整数据
- 输出：`虚拟患者数据_术前术中术后.csv`

**步骤2：运行血糖脆性分析**
```bash
python 02_血糖脆性分析.py
```
- 探索性数据分析
- 构建预测模型（Random Forest, Gradient Boosting）
- 特征重要性分析
- 时间轨迹分析
- 输出：`血糖脆性分析报告.txt`

**步骤3：生成可视化和报告**
```bash
python 03_可视化与报告.py
```
- 生成6类可视化图表
- 生成示例患者详细报告
- 输出：`可视化结果/` 文件夹

### 3. 使用真实数据

将真实患者数据整理成与 `pancreatic_cancer_glycemic_brittleness_factors.csv` 相同的格式，然后：

1. 将数据文件命名为 `真实患者数据.csv`
2. 修改脚本中的 `data_file` 参数：
   ```python
   data_file = '真实患者数据.csv'
   ```
3. 运行分析和可视化脚本

## 核心功能说明

### 1. 数据模拟 (`01_模拟患者数据生成.py`)

**核心类：`PancreaticCancerPatientSimulator`**

生成的数据包括：
- **基本信息**：年龄、性别、评估日期
- **糖尿病基线**：类型、病程、治疗方案、既往病史
- **术前血糖指标**：HbA1c、CGM指标（TIR、CV、MAGE、GMI等）
- **肿瘤特征**：类型、分期、位置、肿瘤标志物
- **手术信息**：手术类型、麻醉、输液、出血、并发症
- **术中血糖指标**：CV、平均血糖、波动幅度、低血糖事件
- **术后并发症**：胰瘘、迟发性胃排空、出血、感染
- **术后血糖轨迹**：72小时、2周、3个月的CGM指标
- **风险预测**：未来3个月脆性恶化风险（低/中/高）

**脆性类型定义**：
- **低脆性**：HbA1c 5.5-6.5%, TIR 85-95%, CV 20-30%, MAGE 1.5-2.5
- **中脆性**：HbA1c 6.5-8.0%, TIR 60-75%, CV 30-40%, MAGE 3.0-4.5
- **高脆性**：HbA1c 8.0-10.5%, TIR 30-55%, CV 40-55%, MAGE 4.8-7.0

### 2. 血糖脆性分析 (`02_血糖脆性分析.py`)

**核心类：`GlycemicBrittlenessAnalyzer`**

**主要分析模块**：

1. **探索性数据分析**
   - 脆性类型分布
   - 术前/术后指标对比
   - 不同脆性类型的风险分布
   - 并发症对风险的影响

2. **预测建模**
   - Random Forest分类器
   - Gradient Boosting分类器
   - 交叉验证
   - 混淆矩阵分析

3. **特征重要性分析**
   - 识别Top 20最重要特征
   - 用于临床决策支持

4. **时间轨迹分析**
   - 不同脆性类型在术前→术后72h→2周→3月的指标变化

5. **临床洞察**
   - 高风险患者特征识别
   - 并发症影响量化
   - 改善病例特点分析
   - 临床管理建议

### 3. 可视化与报告 (`03_可视化与报告.py`)

**核心类：`GlycemicBrittlenessVisualizer`**

**生成的可视化图表**：

1. **脆性分布图** (`01_脆性分布.png`)
   - 术前脆性类型饼图
   - 术后风险等级饼图

2. **术前术后对比图** (`02_术前术后对比.png`)
   - HbA1c、TIR、CV、MAGE的箱线图
   - 按脆性类型分组

3. **时间轨迹图** (`03_时间轨迹.png`)
   - TIR和CV的时间演变曲线
   - 包含标准差区间

4. **风险转移矩阵** (`04_风险转移矩阵.png`)
   - 术前脆性类型→术后风险等级的转移概率热图

5. **并发症影响图** (`05_并发症影响.png`)
   - 胰瘘、迟发性胃排空、感染对风险的影响

6. **相关性热图** (`06_相关性热图.png`)
   - 关键血糖指标之间的相关性矩阵

**个性化患者报告**：
每个患者生成详细的PDF格式报告，包括：
- 基本信息和脆性分型
- 术前血糖控制指标
- 手术与围术期管理
- 术后恢复情况
- 风险评估与预测
- 个性化临床建议

## 关键指标说明

### CGM指标

| 指标 | 英文全称 | 说明 | 正常范围 |
|------|---------|------|---------|
| TIR | Time in Range | 目标范围内时间(3.9-10.0 mmol/L) | ≥70% |
| TAR | Time Above Range | 高血糖时间 | <25% |
| TBR | Time Below Range | 低血糖时间 | <4% |
| CV | Coefficient of Variation | 变异系数 | <36% |
| MAGE | Mean Amplitude of Glycemic Excursions | 平均血糖漂移幅度 | <3.9 mmol/L |
| GMI | Glucose Management Indicator | 血糖管理指标（估算HbA1c） | <7% |

### 脆性分型标准

基于多指标综合判断：
- **低脆性**：血糖稳定，波动小，很少低血糖
- **中脆性**：血糖有一定波动，偶有低血糖
- **高脆性**：血糖极不稳定，频繁出现低血糖或高血糖

## 模型性能

基于50例虚拟数据的初步结果：

**Random Forest模型**：
- 准确率：80%
- 交叉验证：87.5% (±22.4%)
- 对低风险患者预测最准确（F1=1.00）

**特征重要性Top 5**：
1. 术前CGM-TIR
2. 术前HbA1c
3. 糖尿病病程
4. 术前MAGE
5. 术后72h CGM-CV

## 临床应用场景

### 1. 术前评估
- 识别高脆性患者
- 制定个体化术前准备方案
- 优化血糖控制目标

### 2. 围术期管理
- 实时监测血糖波动
- 精准胰岛素管理
- 预防低血糖事件

### 3. 术后随访
- 早期识别脆性恶化风险
- 及时调整治疗方案
- 多学科协作管理

### 4. 科研应用
- 血糖脆性机制研究
- 新型干预措施评估
- 预后因素分析

## 数据要求

使用真实数据时，建议满足以下要求：

### 最小数据集
- 患者基本信息
- 术前HbA1c和CGM数据（至少14天）
- 手术信息
- 术后并发症记录
- 术后3个月随访数据

### 推荐数据集
在最小数据集基础上增加：
- 糖尿病详细病史
- 肿瘤特征和分期
- 术中详细数据
- 术后72小时和2周CGM数据
- 营养和胰腺功能评估

## 下一步计划

### 短期（适用于虚拟数据验证）
- [x] 完成数据模拟
- [x] 构建分类模型
- [x] 生成可视化
- [ ] 模型调优和特征工程
- [ ] 增加深度学习模型（LSTM for time series）

### 中期（准备真实数据应用）
- [ ] 真实数据采集方案
- [ ] 伦理审批准备
- [ ] 数据标注规范
- [ ] 模型验证计划

### 长期（临床转化）
- [ ] 前瞻性临床验证
- [ ] 开发临床决策支持系统
- [ ] 集成到医院信息系统
- [ ] 多中心推广应用

## 参考文献

1. 胰腺癌患者血糖脆性虚拟数据与解释.md
2. 胰腺癌血糖脆性分型与预测项目_优化方法.md
3. pancreatic_cancer_glycemic_brittleness_factors.csv（数据字典）

## 联系方式

- 项目负责人：医学AI团队
- 创建日期：2025-10-07
- 最后更新：2025-10-07

## 许可证

本项目仅用于科研和临床研究目的，不得用于商业用途。
