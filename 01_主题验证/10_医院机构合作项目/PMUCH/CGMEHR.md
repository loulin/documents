# 精准住院血糖管理：整合CGM与EHR的动态风险分层策略

## 0. 模型基础情况 (Model Foundation)

**0.1 核心目的：**
本模型旨在构建一个**智能化、动态化**的临床决策支持系统，通过深度整合住院患者的**连续血糖监测（CGM）数据**与**电子健康记录（EHR）数据**，实现对患者血糖风险的**实时、多维度、精准评估与分层**。

**0.2 解决的核心问题：**
在住院环境中，患者血糖管理面临挑战：
*   **数据碎片化：** CGM提供高频动态数据，但与EHR中的实验室、用药、诊断等静态/半静态数据割裂。
*   **风险识别滞后：** 传统血糖监测频率低，难以捕捉快速变化的血糖波动和潜在风险。
*   **资源分配不均：** 临床资源（医护人员时间、内分泌会诊）有限，难以有效识别并优先干预高风险患者。
*   **管理个体化不足：** 缺乏基于患者复杂情况的个性化风险评估和管理建议。

**0.3 目标用户：**
*   **一线医护人员：** 医生（住院医师、主治医师）、护士。
*   **专科医生：** 内分泌科医生、重症医学科医生。
*   **辅助医疗人员：** 药师、营养师、病例管理员、糖尿病教育专科护士。

**0.4 数据输入：**
模型将实时或近实时地摄取以下数据：
*   **CGM数据：** 血糖值、趋势、变异性指标（TIR, TBR, CV, GRI等）以及CGM设备品牌和型号信息。
*   **EHR数据：**
    *   **患者基本信息：** 年龄、性别、诊断（包括糖尿病类型、合并症）。
    *   **实验室检验结果：** HbA1c、eGFR、肝功能、炎症指标（CRP, WBC, PCT）、红细胞压积等。
    *   **用药数据：** 胰岛素（类型、剂量、给药途径）、糖皮质激素、升压药、其他可能影响血糖的药物。
    *   **医嘱与治疗计划：** 禁食（NPO）、肠内/肠外营养、透析计划、手术计划、转科计划。
    *   **临床事件：** 低血糖事件记录、感染/脓毒症诊断。
    *   **社会心理因素：** 健康素养、社会支持、经济状况、精神健康诊断。
            *   **对接系统：** EHR (病史记录/社工评估模块) / IGRS系统 (结构化评估表)。
            *   **操作：** 自动同步 / 医护人员在IGRS系统内手动录入（如EHR中无结构化记录，则通过IGRS系统内的结构化问卷或评估表录入）。

**0.5 预期产出：**
*   **实时风险分层：** 提供清晰的风险等级（紧急、高危、关注、稳定），并附带量化分数。
*   **风险因素可视化：** 直观展示导致当前风险等级的关键因素。
*   **个性化管理建议：** 针对性地提供用药调整、监测频率、会诊建议、出院计划等行动指南。
*   **数据质量警示：** 提示CGM数据可能存在的偏差或不确定性。

---

## 1. 引言与核心问题

**目标：** 创建一个整合连续血糖监测（CGM）和电子健康记录（EHR）数据的先进临床决策支持系统。该系统旨在对住院患者进行精准的、动态的风险分层，以优化临床资源分配、预测并预防不良事件（尤其是严重低血糖），并指导个性化的血糖管理方案。

**核心问题：** 如何将高频、动态的CGM数据与EHR中丰富但相对静态的临床数据（实验室检验、用药记录、医嘱、诊断）相结合，以精确评估住院患者的实时血糖风险，并对其管理优先级进行排序？

---

## 2. 方法论：基于鱼骨图的系统性风险分析

我们采用鱼骨图（Ishikawa Diagram）作为系统性梳理所有相关风险因素的框架，确保分析的全面性与MECE（相互独立、完全穷尽）原则。核心问题是“如何精确评估住院患者的血糖风险”，围绕此问题，我们构建了十一个关键的风险维度（主骨架）。

![Fishbone Diagram Sketch](placeholder_for_diagram_image.png) *<-- 此处未来可替换为一张真实的鱼骨图图片 -->*

### 十一个关键风险维度：

1.  **CGM 动态数据 (Dynamic CGM Data):** 反映即时状态与紧急程度。
2.  **EHR 基线与实验室数据 (Baseline & Lab EHR Data):** 定义患者的基础风险等级。
3.  **EHR 动态干预数据 (Dynamic Intervention EHR Data):** 理解风险的医源性来源。
4.  **患者个体化因素 (Individual Patient Factors):** 关乎不良事件的后果与管理的复杂性。
5.  **临床情境与应激因素 (Clinical Context & Stress Factors):** 决定资源分配的外部压力。
6.  **高级CGM衍生指标 (Advanced CGM-Derived Metrics):** 描述血糖控制的质量与安全，整合最新研究进展。
7.  **药代动力学与药效学因素 (Pharmacodynamic & Kinetic Factors):** 评估药物在特定患者体内的实际效果与交互。
8.  **动态临床轨迹 (Dynamic Clinical Trajectory):** 捕捉患者病情是改善还是恶化，增加预测能力。
9.  **数据完整性与CGM性能因素 (Data Integrity & CGM Performance Factors):** 评估CGM数据本身的可靠性。
10. **出院计划与转归风险 (Discharge Planning & Transition Risk):** 评估患者出院后的风险。
11. **患者中心与社会心理因素 (Patient-Centered & Psychosocial Factors):** 考虑患者的整体背景和能力。

---

## 3. IGRS 3.0: 住院患者动态血糖风险评分模型

基于上述框架，我们构建一个量化的、可计算的评分模型：**住院患者动态血糖风险评分 (Inpatient Glycemic Risk Score - IGRS) 3.0版**。该模型旨在将多源数据转化为一个可实时更新、具有临床可解释性且行动导向的单一风险分数。

### 3.1. 模型架构：分层与覆盖策略

IGRS 3.0采用分层和“模型覆盖”策略，以应对复杂临床情境：

```
Function calculateRisk(patient):
    // 1. 计算基础风险分数
    baseScore = IGRS_Core_Model.calculate(patient)
    
    // 2. 应用特殊人群附加评估 (叠加模式，非覆盖)
    specialRiskAdjustment = 0
    
    IF patient.isPregnant: // 妊娠状态
        specialRiskAdjustment += Maternal-Fetal_Risk_Assessment.calculate(patient)
        // 并调整CGM目标范围为63-140 mg/dL
    
    IF patient.hasUndergonePancreaticSurgery: // 胰腺相关手术
        specialRiskAdjustment += Post-Pancreatectomy_Risk_Assessment.calculate(patient)

    IF patient.isOnTPN AND patient.isReceivingIVInsulin: // TPN+静脉胰岛素
        specialRiskAdjustment += TPN_IV_Insulin_Risk_Assessment.calculate(patient)

    IF patient.hasHematologicDisorder: // 血液病患者
        specialRiskAdjustment += Hematologic_Risk_Assessment.calculate(patient)

    // 3. 应用情境乘数调整 (针对极端临床情况)
    finalScore = baseScore + specialRiskAdjustment
    
    IF patient.isOnDialysis: // 透析患者
        dialysisMultiplier = Dialysis_Cycle_Dependent_Model.getMultiplier(patient) // 乘数随透析周期动态变化
        finalScore = finalScore * dialysisMultiplier
        
    IF patient.hasEndocrineHyperfunction: // 内分泌高功能状态 (如库欣综合征)
        finalScore = finalScore * 1.3 // 适度调整倍数
    
    // 4. 紧急情况直接触发最高风险级别
    IF patient.hasDKA OR patient.hasHHS OR (patient.currentGlucose < 54):
        RETURN URGENT_RISK_LEVEL // 直接返回紧急级别
    
    // 5. 返回最终风险分数
    RETURN finalScore
```

### 3.2. 评分细则表 (IGRS Core Model)

| 风险维度 | 评估项目 | 具体指标 / 状态 | 判断/诊断/行为 | 数据来源/对接系统 | 系统操作/录入 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **CGM 动态数据** | **严重低血糖** | 任何一次血糖读数 < 54 mg/dL | **+30** | CGM | ADA/ISPAD |
| | **显著低血糖** | 过去24h TBR (<70mg/dL) > 4% | **+20** | CGM | International Consensus |
| | **血糖不稳定** | 过去24h 血糖变异系数 CV > 36% **或 MAGE > 5.4 mmol/L 或 GRI 20-60** | **+10** | CGM | ADA, 血糖变异性研究 |
| | **严重高血糖** | 过去24h TAR (>250mg/dL) > 25% **或 综合血糖质量指标高风险** | **+15** | CGM | ADA, 各厂商CGM质量指标 |
| | **血糖控制良好** | 过去24h GRI < 20 (或等效综合血糖质量指标良好) | **-5** (风险降低) | CGM | 各厂商CGM质量指标 |
| | **高血糖负荷** | 过去24h TIR < 50% **或 TITR (<140) < 30%** | **+10** | CGM | Consensus, ICU studies |
| | **预测性风险** | **过去12h内 > 3次 "即将低血糖" 警报** | **+15** | CGM | Diabetes Technology research |
| **EHR 基线/轨迹** | **肾功能恶化** | **eGFR下降 > 25% 在过去7天内，且至少有3个检测点** | **+20** | LIS | AKI Guidelines |
| | **严重肾功能不全** | eGFR < 30 ml/min/1.73m² | **+25** | LIS | ADA, KDOQI |
| | **中度肾功能不全** | eGFR 30-60 ml/min/1.73m² | **+15** | LIS | ADA, KDOQI |
| | **炎症加重** | **CRP/WBC 上升 > 50% 在过去24h内** | **+10** | LIS | Sepsis/Inflammation studies |
| | **严重贫血** | **红细胞压积 < 25%** | **+25** | LIS | 血液黏度显著改变，影响组织灌注和血糖调节 |
| | **中度贫血** | **红细胞压积 25-30%** | **+15** | LIS | 氧气携带能力下降，组织代谢异常 |
| | **红细胞增多症** | **红细胞压积 > 55%** | **+20** | LIS | 血液黏度增加，微循环阻力大，血糖波动风险 |
| | **血液系统恶性肿瘤** | **急性白血病、淋巴瘤化疗期** | **+35** | EHR-Diagnosis | 血象剧烈变化，化疗药物影响，血糖极不稳定 |
| | **严重血小板减少** | **血小板 < 20,000/μL** | **+20** | LIS | 出血风险高，监测手段受限，治疗复杂化 |
| | **输血期间** | **正在输注红细胞悬液** | **+15** | EHR-Orders | 血液成分快速变化，红细胞压积突然改变 |
| | **造血功能衰竭** | **全血细胞减少** | **+30** | LIS | 多系统功能异常，血糖调节机制严重受损 |
| | **长期血糖控制差** | 入院 HbA1c > 9.0% | **+15** | LIS | ADA |
| | **严重肝功能不全** | Child-Pugh C级 或 ALT/AST > 5倍正常上限 | **+15** | LIS / EHR-Diagnosis | Hepatology Guidelines |
| | **急性代谢紊乱** | **血酮体阳性 (≥0.6 mmol/L) 或尿酮体(++)** | **+25** | LIS | ADA DKA/HHS Guidelines |
| | | **血清碳酸氢盐 < 18 mmol/L** | **+20** | LIS | ADA DKA/HHS Guidelines |
| | | **血钾异常 (<3.5 或 >5.0 mmol/L)** | **+15** | LIS | ADA DKA/HHS Guidelines |
| | | **血钠异常 (<130 或 >150 mmol/L)** | **+10** | LIS | ADA DKA/HHS Guidelines |
| | **酸碱失衡** | **动脉血pH < 7.3** | **+20** | LIS | ADA DKA/HHS Guidelines |
| | | **动脉血PCO2异常 (<35 或 >45 mmHg)** | **+10** | LIS | ADA DKA/HHS Guidelines |
| **EHR 动态干预** | **高危药物: 激素** | 正在使用等效强的松 > 20mg/天的糖皮质激素 | **+20** | PIS / EHR-Orders | 自动同步，IGRS系统计算等效剂量 |
| | **高危药物: 胰岛素** | 正在接受静脉胰岛素输注 | **+15** | EHR-Orders | 自动同步 |
| | **胰岛素叠加风险** | **过去3h内接受 >2次追加胰岛素** | **+20** | PIS / EHR-Orders | 自动同步，IGRS系统计算 |
| | **高危情境: 营养** | **胰岛素使用者** 且 当前状态为禁食(NPO) | **+30** | EHR-Orders / PIS | 自动同步 |
| | **高危情境: 流程** | **未来24h内有透析、手术或转科计划** | **+15** | EHR-Orders | 自动同步 |
| **患者个体因素** | **高龄合并症负担** | 年龄 > 75岁 且 合并症 ≥ 3个 | **+15** | EHR-Demographics / EHR-Diagnosis | 自动同步，系统计算合并症数量 |
| | **衰弱综合征** | 有衰弱症诊断 或 Barthel指数 < 60 | **+10** | EHR-Diagnosis / 护理评估 | 自动同步 / 护士录入 |
| | **老年低血糖高危** | 年龄 ≥ 65岁 且 (认知障碍 或 独居 或 多重用药 ≥ 5种) | **+10** | EHR综合评估 | 系统自动判断 |
| | **认知障碍** | 有谵妄、痴呆等诊断 | **+15** | EHR-Diagnosis | 自动同步 |
| | **1型糖尿病** | 诊断为1型糖尿病 | **+10** | EHR-Diagnosis | 自动同步 |
| | **高胰岛素敏感性** | 系统识别为高敏感性 (例如：过去24小时内，单次追加胰岛素剂量（如2单位）导致血糖下降超过80mg/dL，或每日总胰岛素剂量（TDD）/体重（kg）< 0.3 单位/kg) | **+10** | IGRS-Calc | 自动计算 |
| **临床应激因素** | **严重感染** | 脓毒症 (Sepsis) 或感染性休克 | **+30** | EHR-Diagnosis | 自动同步 |
| | **围手术期** | 术后24小时内 | **+15** | EHR-Orders | 自动同步 | 

### 3.3. 风险等级映射与行动指令

1.  **基础分计算:**
    *   系统自动汇总所有适用项目的分值，得出基础总分。分数应近乎实时地根据新数据（CGM读数、新医嘱、新检验结果）进行更新。

2.  **绝对高危规则 (Overrides):**
    *   **如果患者入院诊断为 DKA 或 HHS，则直接标记为“紧急 (Urgent)”，无论分数如何。**
    *   **如果患者当前CGM读数 < 54 mg/dL，则直接标记为“紧急 (Urgent)”。**
    *   这些是临床安全底线，必须被最高优先级处理。

3.  **风险等级映射与行动指令:**
    *   **紧急 (Urgent):** 总分 > 60分 或 触发任何“绝对高危规则”。
        *   **行动:** 立即床边响应 (30分钟内)。系统应自动向责任护士和值班医生发送高优先级警报。
    *   **高危 (High-Risk):** 总分 40 - 59分。
        *   **行动:** 纳入“重点关注”列表。当班医生需在2-4小时内完成评估。系统可建议启动内分泌会诊流程。
    *   **关注 (At-Risk):** 总分 20 - 39分。
        *   **行动:** 在电子病历的患者列表中以特定颜色（如黄色）高亮。每日例行查房时必须进行血糖管理方案的审查。
    *   **稳定 (Stable):** 总分 < 20分。
        *   **行动:** 按常规方案管理。每日自动生成血糖报告供查房参考即可。

---

## 4. 特殊模型覆盖 (Model Overrides)

某些临床情境具有根本性的特殊性，其风险评估逻辑应独立于通用IGRS模型，并具有最高优先级。当系统识别到以下情境时，将自动激活对应的子模型。

### 4.1. 母胎血糖风险与安全模型 (Maternal-Fetal Glycemic Safety Model)

**触发条件:** 当 `patient.isPregnant == true` (通过EHR诊断码或特定EHR字段识别) 时，系统激活此模型.

**核心原则的转变:**
*   **目标更严格:** 血糖目标从住院患者标准的140-180 mg/dL，收紧为妊娠期标准（例如：空腹<95, 餐后1h<140, 餐后2h<120）。TIR (Time in Range) 的定义也随之改变为63-140 mg/dL。
*   **风险双向性:** 风险不再仅仅是患者本人的风险，而是**母亲风险**和**胎儿风险**的叠加。
*   **时间敏感性:** 风险与**孕周 (Gestational Age)** 强相关。孕早期的高血糖可能致畸，而孕晚期的高血糖导致巨大儿和新生儿低血糖。

**新增及调整的风险因素:**

| 风险维度 | 评估项目 | 具体指标 / 状态 | 风险权重/处理 | 临床意义与依据 |
| :--- | :--- | :--- | :--- | :--- |
| **妊娠核心状态** | **孕周** | 孕早期 (<14周) | 高风险 (致畸) | ACOG/ADA指南强调孕早期严格控制的重要性。**（参考ACOG Practice Bulletin No. 201, Gestational Diabetes Mellitus (2018); American Diabetes Association (ADA) Standards of Medical Care in Diabetes - Pregnancy章节）** |
| | | 孕晚期 (>28周) | 高风险 (巨大儿) | 晚期胎儿生长加速，胰岛素抵抗加剧。 |
| | **诊断类型** | 孕前糖尿病 (T1DM/T2DM) | **极高风险基础** | 相比GDM，孕前糖尿病患者通常有更长的病程和更高的并发症风险。 |
| | | 妊娠期糖尿病 (GDM) | 高风险基础 | | 
| **CGM (妊娠目标)** | **TIR未达标** | 过去24h TIR (70-140mg/dL) < 70% | **高风险** | 妊娠期TIR目标远高于非妊娠人群，是评估母婴结局的关键预测因子。 |
| | **高血糖暴露** | 任何一次血糖 > 160 mg/dL | **中度风险** | 即使是短暂的高血糖也可能对胎儿发育产生影响。 |
| | **夜间低血糖** | 夜间 (0-6点) 出现低血糖 | **高风险** | 夜间低血糖对孕妇和胎儿都构成威胁，且不易被察觉。 |
| **母亲并发症** | **子痫前期/高血压** | 诊断为子痫前期或妊娠期高血压 | **极高风险** | 血糖异常与高血压疾病相互加重，显著增加不良结局风险。 |
| | **酮症倾向** | 1型糖尿病或胰岛素严重缺乏 | **高风险** | 孕期饥饿性酮症更易发生，对胎儿神经系统有害。 |
| **胎儿状态 (EHR)** | **胎儿生长异常** | B超提示巨大儿 (LGA) 或生长受限 (IUGR) | **极高风险** | 这是血糖控制不良的直接后果体现，需要立即干预。 |
| | **羊水量异常** | B超提示羊水过多/过少 | **高风险** | 通常与胎儿高血糖或胎盘功能不良相关。 |
| **住院特殊干预** | **促胎肺成熟** | 正在使用**倍他米松/地塞米松** | **极高风险** | 这是住院期间导致严重、难以控制的高血糖的超强诱因。 |
| | **静脉用药** | 使用含糖液体（如部分抗生素溶媒） | 中度风险 | 容易被忽略的血糖升高来源。 |

### 4.2. 胰腺术后血糖模型 (Post-Pancreatectomy Glycemic Model)

**触发条件:** 当 `patient.hasUndergonePancreaticSurgery == true` (通过EHR手术记录或诊断码识别) 时，系统激活此模型。

**核心原则:** 患者的内源性胰岛素分泌能力被部分或完全、永久性地移除了，导致血糖极度“脆性”。

**新增及调整的风险因素:**

| 风险维度 | 评估项目 | 具体指标 / 状态 | 风险权重/处理 | 临床意义与依据 |
| :--- | :--- | :--- | :--- | :--- |
| **胰岛素分泌缺失** | **胰腺切除范围** | 全胰切除 / 部分胰腺切除 | **极高风险基础** | 完全依赖外源胰岛素，血糖波动大。 |
| **外源性胰岛素** | **胰岛素剂量不足** | 胰岛素/碳水化合物比率 (I:CHO) 远低于预期 | **高风险** | 提示胰岛素抵抗或剂量不足。 |
| | **胰岛素给药中断** | 胰岛素泵故障或皮下注射遗漏 | **紧急警报** | 需要立即评估，防止严重高血糖或DKA风险。 |
| **营养支持** | **营养中断/改变** | 肠内/肠外营养突然中断或速率大幅改变 | **紧急警报** | 营养中断可导致严重低血糖，需立即调整胰岛素方案。 |
| | **口服摄入恢复** | 术后开始口服饮食，但胰岛素未相应调整 | **高风险** | 需调整胰岛素方案以匹配新的营养摄入模式。 |


### 4.3. TPN/静脉胰岛素滴定模型 (TPN/IV Insulin Titration Model)

**触发条件:** 当 `patient.isOnTPN == true` (通过EHR医嘱识别) 且 `patient.isReceivingIVInsulin == true` (通过EHR医嘱识别) 时，系统激活此模型。

**核心原则:** 血糖水平是TPN葡萄糖输注速度和静脉胰岛素输注速度之间的一个精密数学平衡。风险主要来自速率匹配的失衡。

**新增及调整的风险因素:**

| 风险维度 | 评估项目 | 具体指标 / 状态 | 风险权重/处理 | 临床意义与依据 |
| :--- | :--- | :--- | :--- | :--- |
| **速率匹配失衡** | **TPN速率改变未调整胰岛素** | TPN输注速率改变 > 20% 而静脉胰岛素速率未在30分钟内相应调整 | **紧急警报** | 血糖来源与胰岛素清除不匹配，极易导致血糖剧烈波动。 |
| | **TPN意外中断** | TPN输注意外中断（如管路脱落、泵故障）而静脉胰岛素仍在输注 | **紧急警报** | 持续胰岛素输注而缺乏葡萄糖来源，极易导致严重低血糖。 |
| **血糖波动** | **血糖波动剧烈** | 过去1小时血糖变化 > 50 mg/dL | **高风险** | 提示滴定方案可能不稳或患者胰岛素敏感性变化。 |

### 4.4. 透析周期依赖模型 (Dialysis-Cycle Dependent Model)

**触发条件:** 当 `patient.isOnDialysis == true` (通过EHR医嘱或诊断识别) 时，系统激活此模型。

**核心原则:** 胰岛素的清除途径依赖人工透析，导致血糖风险随透析周期呈现周期性变化。

**新增及调整的风险因素:**

| 风险维度 | 评估项目 | 具体指标 / 状态 | 风险权重/处理 | 临床意义与依据 |
| :--- | :--- | :--- | :--- | :--- |
| **透析周期风险** | **透析中血糖异常** | 透析过程中血糖 < 70 mg/dL 或 > 250 mg/dL | **紧急警报** | 透析中血糖波动大，需立即调整透析液葡萄糖浓度或胰岛素方案。 |
| | **透析后即刻风险** | 距离上次透析结束 < 2小时 | **中度血糖风险** | 透析后血糖可能出现反跳，需密切监测。 |
| | **透析间期后段** | 距离下次透析开始 < 6小时 | **低血糖风险增加** | 透析间期后段，液体潴留和代谢产物蓄积可能影响血糖稳定性。 |
| | **透析方案变更** | 透析方案(时间/频率/透析液)在过去24h内发生改变 | **高风险** | 透析方案变更影响体液平衡和代谢清除，需重新评估血糖管理方案。 |

### 4.5. 血液病血糖风险评估模型 (Hematologic Disorder Glycemic Risk Model)

**触发条件:** 当 `patient.hasHematologicDisorder == true` (通过EHR诊断码或血常规异常识别) 时，系统激活此模型。

**核心原则:** 血液病通过多种机制影响血糖调节：①改变血液黏度和组织灌注；②影响氧气携带和组织代谢；③化疗药物直接干扰血糖调节；④监测手段的可靠性下降。

**新增及调整的风险因素:**

| 风险维度 | 评估项目 | 具体指标 / 状态 | 风险权重/处理 | 临床意义与依据 |
| :--- | :--- | :--- | :--- | :--- |
| **贫血相关风险** | **严重贫血** | Hct < 25% 或 Hb < 80g/L | **极高风险基础 +30分** | 血液黏度显著降低，组织灌注异常，血糖调节机制受损 |
| | **贫血伴心功能不全** | Hct < 30% 且有心衰诊断 | **高风险 +25分** | 心脏代偿能力下降，进一步影响组织灌注和血糖稳定性 |
| | **慢性肾病性贫血** | CKD + Hct < 30% | **高风险 +25分** | 肾脏EPO产生不足+毒素蓄积，血糖调节复杂化 |
| **血液肿瘤风险** | **急性白血病未缓解期** | 外周血见原始细胞 >20% | **极高风险 +40分** | 血象极不稳定，化疗期间血糖波动剧烈 |
| | **淋巴瘤化疗期** | 正在接受化疗方案 | **高风险 +30分** | 化疗药物（如糖皮质激素、L-门冬酰胺酶）直接影响血糖 |
| | **造血干细胞移植** | 移植前预处理期 | **极高风险 +35分** | 大剂量化疗+全身放疗，血糖调节机制严重受损 |
| | | 移植后早期 (30天内) | **高风险 +25分** | 造血功能重建期，血象不稳定 |
| | | 急性GVHD期间 | **高风险 +30分** | 大剂量激素治疗，血糖控制困难 |
| **凝血功能异常** | **严重血小板减少** | 血小板 < 20,000/μL | **高风险 +25分** | 出血风险限制监测手段，治疗选择受限 |
| | **DIC (弥散性血管内凝血)** | 有DIC诊断 | **极高风险 +35分** | 微循环障碍严重，组织灌注极不稳定 |
| **输血相关风险** | **大量输血** | 24小时内输血 >4个单位 | **高风险 +20分** | 血液成分剧烈变化，红细胞压积大幅波动 |
| | **输血反应** | 输血过程中出现发热、过敏等 | **中度风险 +15分** | 炎症反应影响血糖调节，应激状态 |
| **特殊血液病** | **镰状细胞病危象** | 镰状细胞病急性发作 | **极高风险 +40分** | 血管闭塞危象，严重疼痛和组织缺血 |
| | **血栓性血小板减少性紫癜 (TTP)** | TTP急性期 | **极高风险 +35分** | 微血管血栓形成，多器官功能受损 |
| **监测可靠性** | **CGM不适用情况** | Hct<25% 或血液肿瘤化疗期 | **CGM权重降至0%** | CGM数据完全不可靠，必须依赖BGM |
| | **BGM限制情况** | 血小板<20k 或严重凝血异常 | **限制穿刺频率** | 出血风险高，需平衡监测需求与安全性 |

**血液病特异性处理逻辑:**

```
IF patient.hematocrit < 25:
    DISABLE_CGM()
    ENABLE_INTENSIVE_BGM_MONITORING(frequency="every_2_hours")
    ALERT("严重贫血，CGM不可用，已启动密集BGM监测")

IF patient.hasAcuteLeukemia AND patient.isOnChemotherapy:
    DISABLE_CGM()
    ENABLE_INTENSIVE_BGM_MONITORING(frequency="every_1-2_hours")  
    INCREASE_GLUCOSE_MONITORING_DURING_STEROID_THERAPY()
    ALERT("血液肿瘤化疗期，血糖极不稳定，需密切监测")

IF patient.plateletCount < 20000:
    MINIMIZE_FINGER_STICK_FREQUENCY()
    CONSIDER_ALTERNATIVE_MONITORING(urine_glucose=True)
    ALERT("血小板过低，限制穿刺次数，考虑替代监测方法")

IF patient.isReceivingTransfusion:
    REDUCE_CGM_WEIGHT(reduction=50%)
    INCREASE_BGM_FREQUENCY(during_transfusion="hourly", post_transfusion="every_2_hours")
    MONITOR_HEMATOCRIT_CHANGES()
```

---

## 5. 数据完整性与CGM性能因素 (Data Integrity & CGM Performance Factors)

评估CGM数据本身的可靠性，并据此调整模型对CGM数据的依赖程度。

**处理方式:** 创建一个**CGM数据置信度 (CGM Data Confidence)** 评分（高/中/低），并用它来调节IGRS模型的行为。

| 评估项目 | 具体指标 / 状态 | 模型处理方式 | 临床意义与依据 | 
| :--- | :--- | :--- | :--- | 
| **生理干扰** | **红细胞压积 (Hct) 异常** | Hct < 30% (贫血) 或 > 55% (红细胞增多症) | **降低CGM数据置信度** | FDA和设备制造商明确指出干扰因素。 | 
| | **严重贫血** | Hct < 25% | **标记为"严重干扰，建议暂停CGM"** | 血液黏度显著降低，组织灌注模式改变，CGM读数偏低10-25% |
| | **轻-中度贫血** | Hct 25-30% | **降低CGM数据置信度，增加BGM验证频率** | 氧气携带能力下降，影响组织代谢，CGM响应延迟增加 |
| | **红细胞增多症** | Hct > 55% | **降低CGM数据置信度，警惕读数波动** | 血液黏度增加，葡萄糖扩散受阻，CGM读数可能偏高或波动大 |
| | **血液系统恶性肿瘤** | 急性白血病、淋巴瘤化疗期 | **标记为"禁用CGM"** | 血象剧烈变化 + 化疗药物干扰，CGM完全不可靠 |
| | **凝血功能异常** | 血小板 < 20,000/μL | **标记为"出血风险，避免CGM安装"** | 穿刺部位出血风险高，安全性考虑 |
| | **血小板减少** | 血小板 20,000-50,000/μL | **谨慎使用CGM，密切观察穿刺点** | 轻度出血风险，需加强局部观察 |
| | **输血期间** | 正在输注红细胞悬液 | **暂时降低CGM权重，每小时BGM验证** | 血液成分快速变化，红细胞压积突然改变 |
| | **造血干细胞移植** | 移植前化疗期 | **禁用CGM** | 化疗导致血象异常，CGM完全不可靠 |
| | | 移植后造血恢复期 | **CGM准确性逐渐改善，需持续评估** | 造血功能恢复过程中血象动态变化 |
| | **严重低氧血症** | PaO2 < 60 mmHg | **降低CGM数据置信度** | 组织缺氧影响组织间液葡萄糖测量。 |
| | **严重酸中毒** | pH < 7.25 | **降低CGM数据置信度** | 极端pH值影响传感器化学反应。 |
| **药物干扰 (按CGM品牌)** | **大剂量维生素C** | 正在接受 >1g/天的静脉维生素C治疗 | **标记为"可能假性升高"** | 影响所有品牌CGM，电化学干扰机制。 | 
| | **对乙酰氨基酚 (扑热息痛)** | 正在使用对乙酰氨基酚 | **按CGM品牌区分处理** | **Medtronic Guardian/MiniMed**: 严重干扰，假性升高；**Dexcom G6/G7**: 轻微影响；**FreeStyle Libre**: 中等影响 |
| | **羟基脲** | 正在使用羟基脲（化疗药物） | **标记为"严重干扰，建议暂停CGM"** | FDA警告：影响所有品牌CGM，建议使用期间暂停CGM或增加BGM验证频率。 |
| | **多巴胺类药物** | 正在使用左旋多巴或多巴胺激动剂 | **按CGM品牌区分处理** | **Dexcom系列**: 轻微影响；**Medtronic系列**: 中等影响；**FreeStyle**: 影响较小 |
| | **抗坏血酸类药物** | 正在使用高剂量抗坏血酸类药物 | **按CGM品牌区分处理** | **所有品牌**: 可能干扰，但**FreeStyle Libre 2/3**相对抗干扰能力较强 |
| | **某些抗生素** | 正在使用四环素类、磺胺类抗生素 | **标记为"轻微干扰"** | **Medtronic**系列可能受影响，**Dexcom/FreeStyle**影响较小 |
| **传感器性能** | **频繁校准请求** | CGM系统在过去24h内要求 > 2次非计划性校准 | **降低CGM数据置信度** | 传感器不稳定信号。 | 
| | **信号丢失/数据缺口** | 过去24h CGM数据完整性 < 80% | **降低CGM数据置信度** | 影响基于CGM指标的风险评估可靠性。 |
| | **BGM-CGM 巨大差异** | **护士录入的BGM值与同时间的CGM值差异 > 20%** | **触发“一致性警报”** | 最直接的CGM读数不准确信号。 |

**CGM数据置信度调节IGRS行为 (按品牌优化):**
*   **IF `CGM_Data_Confidence` is LOW:**
    *   **行动:** 系统在仪表盘上显著标示"CGM读数可能不准，请以指尖血糖为准！" + 显示具体干扰原因和CGM品牌
    *   **行动:** 自动生成医嘱或任务，要求护士增加指尖血糖监测的频率（例如，从q6h增加到q2h）。
    *   **行动:** 在风险计算中，根据CGM品牌和干扰类型**动态调整**来自CGM动态指标的权重：
        - **药物干扰调整:**
            - **Dexcom G6/G7**: 对乙酰氨基酚干扰时权重降低20%
            - **Medtronic Guardian**: 对乙酰氨基酚干扰时权重降低60%
            - **FreeStyle Libre**: 对乙酰氨基酚干扰时权重降低40%
        - **血液病干扰调整:**
            - **严重贫血(Hct<25%)**: 所有品牌CGM权重降低70%，建议暂停使用
            - **中度贫血(Hct 25-30%)**: CGM权重降低40%，每4小时BGM验证
            - **红细胞增多症(Hct>55%)**: CGM权重降低50%，关注读数波动
            - **血液肿瘤化疗期**: CGM权重降至0%，完全依赖BGM监测
*   **IF `CGM_Data_Confidence` is MEDIUM:**
    *   **行动:** 在UI上显示品牌特异性警告：
        - 药物干扰："Medtronic CGM检测到对乙酰氨基酚干扰，建议增加BGM验证"
        - 血液病影响："检测到轻度贫血(Hct 28%)，CGM可能偏低，建议每6小时BGM验证"
        - 输血影响："患者正在输血，CGM准确性可能受影响，建议每2小时BGM监测"
    *   **行动:** 建议在下一次常规血糖监测时，用BGM进行一次比对。
*   **IF 血液病特殊处理:**
    *   **急性白血病/化疗期:** 系统直接显示"血液病化疗期，CGM不可用，已启动密集BGM监测方案"
    *   **造血干细胞移植期:** 动态评估造血功能恢复情况，逐步调整CGM权重
    *   **输血期间:** 实时监控红细胞压积变化，自动调整CGM置信度
    *   **血小板过低(<20k):** 系统提示"出血风险高，禁止CGM安装，采用无创监测方案"

---

## 6. 出院计划与转归风险 (Discharge Planning & Transition Risk)

识别患者出院后发生不良事件（如再入院）的风险，指导出院规划。

**处理方式:** 创建一个**独立的“出院复杂度评分 (Discharge Complexity Score - DCS)”**，与IGRS并行。

| 评估项目 | 具体指标 / 状态 | 模型处理方式 | 临床意义与依据 | 
| :--- | :--- | :--- | :--- | 
| **“回头客”患者** | 过去6个月内因高/低血糖相关问题再次入院 | **增加DCS评分** | 强预测再入院的因素。 | 
| **出院时无明确随访计划** | EHR中在未来14天内没有已安排的内分泌或PCP随访预约 | **增加DCS评分** | 缺乏随访是再入院主要原因。 | 
| **出院方案复杂性** | 出院时胰岛素方案包含 >2 种不同类型的胰岛素，或每日注射次数 >4 次 | **增加DCS评分** | 复杂方案增加患者依从性难度。 | 
| **新诊断或方案巨变** | 本次住院期间新诊断为糖尿病，或出院方案与入院前方案相比有重大改变 | **增加DCS评分** | 需大量患者教育，高错误风险。 |

---

## 7. 患者中心与社会心理因素 (Patient-Centered & Psychosocial Factors)

考虑患者的整体背景和能力，这些因素对血糖管理依从性和长期结局有显著影响。

**处理方式:** 整合到DCS评分中，或作为独立的“复杂性标记”触发相应会诊建议。

| 评估项目 | 具体指标 / 状态 | 模型处理方式 | 临床意义与依据 | 
| :--- | :--- | :--- | :--- | 
| **健康素养/认知障碍** | EHR中有“Health Literacy-Low”的记录，或存在妨碍学习的认知/精神状态 | **增加DCS评分 / 触发教育会诊** | 影响患者理解和执行医嘱的能力。 | 
| **社会支持系统** | EHR中记录为独居、无家属或社会支持系统薄弱 | **增加DCS评分 / 触发社工会诊** | 缺乏支持系统增加居家管理难度。 | 
| **经济/药物获取障碍** | EHR中有“药物获取困难”或“保险状态不稳定”的记录 | **增加DCS评分 / 触发药学/社工会诊** | 经济因素是药物依从性的重要障碍。 | 
| **精神健康合并症** | EHR诊断中存在抑郁症、焦虑症或“糖尿病痛苦”(Diabetes Distress) | **增加DCS评分 / 触发心理/精神科会诊** | 精神健康问题严重影响自我管理。 |

---

## 8. 精确血糖风险分层算法框架

### 8.1 特征提取算法
- **时序特征算法**：计算血糖变异性指标（CV、MAGE、TIR、TAR、TBR）
- **统计特征算法**：提取血糖分布特征（平均值、标准差、偏度、峰度）
- **动态特征算法**：血糖变化率、加速度、趋势持续时间

### 8.2 风险分层算法

**二级分层策略：**
- **一级分层**：基于临床规则的风险筛查
  - 血糖阈值判定（<3.9或>10.0 mmol/L）
  - 变异性阈值判定（CV>36%）
  - 低血糖频次统计

- **二级分层**：机器学习精确分型
  - **随机森林**：处理非线性特征关系，识别关键风险因子
  - **XGBoost**：梯度提升算法，提高分类精度
  - **LSTM神经网络**：捕捉时序依赖关系，预测血糖脆性趋势

### 8.3 预测算法
- **ARIMA模型**：短期血糖值预测（30-60分钟）
- **Cox回归**：血糖相关并发症风险评估
- **聚类算法**：识别相似血糖模式的患者群体

### 8.4 决策支持算法
- **多属性决策分析**：综合血糖指标、临床特征和预测结果
- **贝叶斯网络**：处理不确定性，给出风险概率
- **规则引擎**：基于临床指南的治疗建议生成

这些算法协同工作，实现从数据收集到精确分型再到个性化干预建议的完整闭环。

---

## 9. 下一步：临床仪表盘 (Dashboard) 设计

有了上述的“后端”评分逻辑，下一步的关键是将这些复杂、多维的数据以一种极其清晰、直观、且具有行动指导意义的方式呈现给一线的临床医生和护士。一个精心设计的临床仪表盘是连接数据与决策的桥梁。

**设计原则:**
*   **信息分层:** 最紧急、最关键的信息（如当前血糖、风险等级）必须最醒目。
*   **双评分显示:** 同时显示IGRS（住院即时风险）和DCS（出院转归风险），以区分即时干预和长期规划。
*   **可解释性:** 用户应能轻松点击查看风险分数的构成，理解“为什么”这个患者是高风险。
*   **趋势可视化:** 不仅显示当前值，更要展示关键指标（血糖、肾功能、炎症标志物）的变化趋势。
*   **行动闭环:** 仪表盘不仅要“报警”，还要提供标准化的处理建议和记录入口，形成“发现问题 -> 分析问题 -> 解决问题 -> 记录方案”的闭环。
*   **数据质量提示:** 明确提示CGM数据置信度，指导临床人员何时需要BGM验证。

---

## 10. 模型优化与验证 (Model Optimization & Validation)

获取既往患者数据是模型从理论走向实践的关键一步。通过对历史数据的分析，我们可以验证模型的有效性，识别其不足，并进行迭代优化，使其更精准地服务于临床需求。

#### **10.1 数据获取与准备 (Data Acquisition & Preparation)**

这是模型优化的基础，也是最耗时、最复杂的一步。

*   **数据来源整合：**
    *   **EHR数据：** 从HIS、LIS、PIS、RIS等系统导出患者的完整病历数据，包括：
        *   **人口统计学信息：** 年龄、性别、诊断（入院诊断、出院诊断、合并症）。
        *   **实验室检验：** 所有血糖相关（HbA1c、随机血糖）、肾功能（eGFR、肌酐）、肝功能、炎症指标（CRP、WBC、PCT）、血常规（Hct）、电解质、血气分析（pH、PaO2）等。
        *   **用药记录：** 胰岛素（类型、剂量、给药时间、途径）、糖皮质激素、升压药、其他影响血糖药物。
        *   **医嘱记录：** 禁食（NPO）、肠内/肠外营养（TPN/肠内营养类型、速率）、透析计划、手术记录、转科记录。
        *   **临床事件记录：** 明确记录的低血糖事件（尤其是严重低血糖）、DKA/HHS事件、感染/脓毒症诊断、再入院记录。
        *   **社会心理评估：** 如果EHR中有相关结构化字段（如健康素养评估、社会支持评估、精神科诊断）。
    *   **CGM数据：** 从CGM数据管理平台导出患者的原始高频血糖数据（通常是每1-5分钟一个点）。
*   **数据清洗与预处理：**
    *   **缺失值处理：** 识别并处理数据缺失（插补、删除或标记）。
    *   **异常值检测：** 识别并处理明显错误的读数。
    *   **数据类型转换：** 确保所有数据格式统一，便于分析。
    *   **时间戳对齐：** 将CGM的高频数据与EHR的事件数据（如用药时间、检验时间）进行精确对齐。
*   **特征工程 (Feature Engineering)：**
    *   根据我们模型中定义的指标，从原始数据中计算衍生特征。例如：
        *   **CGM指标：** TIR、TBR、TAR、CV、GRI、TITR、预测性警报计数。
        *   **EHR指标：** eGFR变化率（过去24h/48h）、CRP/WBC变化率、胰岛素叠加次数、等效强的松剂量、透析周期时间点。
        *   **复杂性指标：** 出院方案复杂性（根据胰岛素种类和注射次数计算）。
*   **结果标签化 (Outcome Labeling)：**
    *   明确定义我们希望模型预测的“不良事件”或“结果”，并将其在历史数据中进行标签化。例如：
        *   **主要结局：** 住院期间发生严重低血糖（血糖<54mg/dL）事件。
        *   **次要结局：** 住院期间发生DKA/HHS、住院时间延长、出院后30天内再入院（因血糖相关原因）。

#### **10.2 模型回顾性验证 (Retrospective Validation)**

在准备好的历史数据集上运行我们当前的IGRS 3.0模型，评估其预测性能。

*   **应用现有模型：** 将IGRS 3.0的评分逻辑和规则应用于历史数据，为每个患者在不同时间点计算风险分数。
*   **性能指标评估：**
    *   **分类模型指标：**
        *   **敏感性 (Sensitivity) / 召回率 (Recall)：** 模型正确识别出高风险患者（实际发生不良事件）的比例。
        *   **特异性 (Specificity)：** 模型正确识别出低风险患者（未发生不良事件）的比例。
        *   **阳性预测值 (PPV) / 精确率 (Precision)：** 模型预测为高风险的患者中，实际发生不良事件的比例。
        *   **阴性预测值 (NPV)：** 模型预测为低风险的患者中，实际未发生不良事件的比例。
        *   **准确率 (Accuracy)：** 模型总体预测正确的比例。
        *   **AUC (Area Under the Curve)：** ROC曲线下面积，综合评估模型区分高低风险患者的能力。
    *   **校准 (Calibration)：** 比较模型预测的风险概率与实际观察到的事件发生率是否一致。
    *   **临床实用性评估：** 评估模型在不同风险等级下，不良事件的发生率差异是否具有临床意义。

#### **10.3 模型迭代优化 (Iterative Optimization)**

根据回顾性验证的结果，对模型进行调整和改进。

*   **权重调整与特征选择：**
    *   **统计分析：** 使用回归分析（如逻辑回归）或机器学习方法（如决策树、随机森林、梯度提升机）来识别哪些特征对预测结局最重要，并优化其权重。
    *   **临床反馈：** 与内分泌专家、重症医生、护士等进行多轮讨论，结合他们的经验，调整分值和规则，确保模型既数据驱动又符合临床直觉。例如，某个因素在统计上不显著，但临床上认为非常重要，则可能需要保留或增加权重。
*   **阈值优化：**
    *   根据临床目标（例如，是更倾向于不错过任何一个高风险患者，还是更倾向于减少误报），调整风险等级的划分阈值（如“紧急”的得分阈值）。
*   **新特征发现：**
    *   通过探索性数据分析，识别历史数据中可能存在但我们当前模型未捕获的新的预测性因素。
*   **子模型精炼：**
    *   对妊娠模型、胰腺术后模型等特殊子模型进行独立优化，确保其在特定人群中的高精度。
*   **数据质量因素的量化：**
    *   进一步量化CGM数据置信度对风险评分的影响，例如，当置信度低时，CGM相关指标的权重可以动态降低。

#### **10.4 前瞻性验证 (Prospective Validation)**

在回顾性优化完成后，模型需要在新的、未见过的数据上进行前瞻性验证。

*   **小范围试点：** 在一个或几个病区部署模型，在真实临床环境中收集数据，并观察模型的实际表现。
*   **持续监测与反馈：** 建立机制，持续收集模型预测结果与实际结局的对比数据，并定期进行性能评估和模型再训练。

#### **10.5 伦理与隐私考量**

*   **数据匿名化/去标识化：** 确保所有用于模型优化和验证的患者数据都经过严格的匿名化处理，保护患者隐私。
*   **模型透明度与可解释性：** 即使引入复杂的机器学习模型，也要确保其决策过程对临床医生是可解释的，避免“黑箱”问题。
*   **偏见检测：** 检查模型是否存在对特定人群（如不同种族、性别）的偏见，并进行纠正。
