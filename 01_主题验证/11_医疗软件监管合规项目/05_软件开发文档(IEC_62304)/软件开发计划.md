# 软件开发计划
## Software Development Plan (IEC 62304:2006)

**文档编号**: SDP-001
**版本**: v1.0
**日期**: 2025-10-10
**作者**: [填写]
**审核人**: [填写]
**批准人**: [填写]

---

## 1. 概述

### 1.1 目的
本软件开发计划(Software Development Plan, SDP)定义了医疗器械软件的开发过程,符合:
- **IEC 62304:2006** - 医疗器械软件生命周期过程
- **ISO 13485:2016** - 质量管理体系
- **ISO 14971:2019** - 风险管理(与软件开发集成)
- **EU MDR 2017/745 Annex I** - GSPR第17.1条(软件验证确认)

### 1.2 适用范围
**产品名称**: [填写产品名称]
**产品版本**: [如 v1.0]
**软件类型**: [x] 独立软件(SaMD)  [ ] 嵌入式软件
**平台**: [x] 移动应用(iOS/Android)  [x] Web应用  [x] 后端服务

### 1.3 软件安全分级(IEC 62304 § 4.3)

根据IEC 62304,软件按照潜在危害严重度分为三个安全等级:

**软件安全等级**: [ ] Class A  [x] Class B  [ ] Class C

#### 分级依据(见风险管理文件 RMP-001):
| 等级 | 定义 | 本产品评估 |
|------|------|----------|
| **Class A** | 软件系统失效**不可能**导致伤害 | ❌ 不适用 - 错误建议可能导致伤害 |
| **Class B** | 软件系统失效**可能**导致**非严重伤害** | ✅ **适用** - 最坏情况为轻微/中度伤害(如短期高血糖) |
| **Class C** | 软件系统失效**可能**导致**死亡或严重伤害** | ❌ 不适用 - 产品不直接控制治疗(仅建议) |

**分级理由**:
本产品为糖尿病管理辅助应用,提供健康建议但不直接控制治疗设备(如胰岛素泵)。根据风险分析(FMEA H-003),最严重后果为不当建议导致慢性并发症加重(严重度评分3-4),但概率极低(已通过风险控制降低)。综合判定为**Class B**。

**注意**: Class B要求执行IEC 62304的大部分流程,但相比Class C可豁免部分文档(如详细架构设计的某些部分)。

---

## 2. 软件开发生命周期模型

### 2.1 选定的生命周期模型
**模型**: [x] 敏捷开发(Agile - Scrum)  [ ] V模型  [ ] 瀑布模型

**理由**:
- 医疗软件需要频繁迭代和用户反馈
- 监管要求可追溯性,敏捷可通过Sprint内嵌验证满足
- 与现代SaaS开发实践一致

### 2.2 敏捷开发流程图
```
┌────────────────────────────────────────────────────────────┐
│         敏捷开发生命周期 (IEC 62304合规)                    │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ Sprint 0: 初始化                                      │ │
│  │ - 软件需求分析(SRS)                                   │ │
│  │ - 软件架构设计(SDD)                                   │ │
│  │ - 风险分析                                            │ │
│  │ - 测试计划                                            │ │
│  └──────────────────────────────────────────────────────┘ │
│                          ↓                                 │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ Sprint 1-N: 迭代开发(2周/Sprint)                      │ │
│  │  ┌─────────────────────────────────────────────────┐ │ │
│  │  │ 1. Sprint计划会                                 │ │ │
│  │  │    - 选择User Story                             │ │ │
│  │  │    - 映射到软件需求(REQ-XXX)                    │ │ │
│  │  └─────────────────────────────────────────────────┘ │ │
│  │  ┌─────────────────────────────────────────────────┐ │ │
│  │  │ 2. 开发                                         │ │ │
│  │  │    - 编码(遵循编码标准)                         │ │ │
│  │  │    - 单元测试(覆盖率>80%)                       │ │ │
│  │  │    - 代码审查(Code Review)                      │ │ │
│  │  └─────────────────────────────────────────────────┘ │ │
│  │  ┌─────────────────────────────────────────────────┐ │ │
│  │  │ 3. 集成与测试                                   │ │ │
│  │  │    - 集成测试                                   │ │ │
│  │  │    - 回归测试(自动化)                           │ │ │
│  │  │    - 风险相关测试(见RTM)                        │ │ │
│  │  └─────────────────────────────────────────────────┘ │ │
│  │  ┌─────────────────────────────────────────────────┐ │ │
│  │  │ 4. Sprint评审与回顾                             │ │ │
│  │  │    - 演示给利益相关方                           │ │ │
│  │  │    - 更新追溯矩阵(RTM)                          │ │ │
│  │  │    - 更新风险分析(如有新风险)                   │ │ │
│  │  └─────────────────────────────────────────────────┘ │ │
│  └──────────────────────────────────────────────────────┘ │
│                          ↓                                 │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ 验证与确认(V&V)                                       │ │
│  │ - 系统测试                                            │ │
│  │ - 可用性测试                                          │ │
│  │ - 安全测试(渗透测试)                                  │ │
│  │ - 临床验证(如需要)                                    │ │
│  └──────────────────────────────────────────────────────┘ │
│                          ↓                                 │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ 发布(Release)                                         │ │
│  │ - 软件配置审计                                        │ │
│  │ - 发布批准                                            │ │
│  └──────────────────────────────────────────────────────┘ │
│                          ↓                                 │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ 上市后维护                                            │ │
│  │ - 问题报告处理(SOP-007)                               │ │
│  │ - 软件更新(补丁/新版本)                               │ │
│  └──────────────────────────────────────────────────────┘ │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

### 2.3 IEC 62304过程映射
| IEC 62304过程 | 敏捷开发阶段 | 交付物 |
|--------------|-------------|--------|
| **5.1 软件开发计划** | Sprint 0 | 本文档(SDP-001) |
| **5.2 软件需求分析** | Sprint 0 + 持续细化 | 软件需求规格(SRS) |
| **5.3 软件架构设计** | Sprint 0 | 软件设计文档(SDD) |
| **5.4 软件详细设计** | 每个Sprint | 详细设计(代码+文档) |
| **5.5 软件单元实现与验证** | 每个Sprint | 代码+单元测试 |
| **5.6 软件集成与集成测试** | 每个Sprint | 集成测试报告 |
| **5.7 软件系统测试** | V&V阶段 | 系统测试报告 |
| **5.8 软件发布** | Release | 发布记录 |

---

## 3. 组织与职责

### 3.1 团队结构
| 角色 | 姓名 | 职责 | 报告对象 |
|------|------|------|---------|
| **软件开发负责人** | [姓名] | 总体负责软件开发,批准SDP | CEO |
| **Scrum Master** | [姓名] | 敏捷流程管理,移除障碍 | 软件开发负责人 |
| **Product Owner** | [姓名] | 定义产品需求,优先级排序 | 软件开发负责人 |
| **前端工程师** (×3) | [姓名] | iOS/Android/Web开发 | Tech Lead |
| **后端工程师** (×3) | [姓名] | API/数据库/算法开发 | Tech Lead |
| **测试工程师** (×2) | [姓名] | 测试执行与自动化 | QA负责人 |
| **DevOps工程师** | [姓名] | CI/CD,基础设施 | Tech Lead |
| **安全工程师** | [姓名] | 网络安全,渗透测试 | CISO |
| **文档工程师** | [姓名] | 技术文档编写 | 软件开发负责人 |

### 3.2 IEC 62304角色映射
| IEC 62304要求的角色 | 本项目对应角色 |
|-------------------|---------------|
| 软件开发负责人 | 软件开发负责人 |
| 软件设计人员 | 前端/后端工程师 |
| 软件测试人员 | 测试工程师(独立) |
| 配置管理员 | DevOps工程师 |

---

## 4. 软件需求管理(IEC 62304 § 5.2)

### 4.1 需求来源
1. **产品定义文档** (PDD-001) - 预期用途,目标用户
2. **风险管理文件** (RMP-001) - 风险控制需求
3. **监管要求** - CE Mark GSPR, HIPAA等
4. **用户反馈** - 可用性测试,上市后反馈

### 4.2 需求分类
| 需求类型 | 编号前缀 | 示例 |
|---------|---------|------|
| 功能需求 | REQ-F-XXX | REQ-F-001 "系统应允许用户录入血糖值" |
| 性能需求 | REQ-P-XXX | REQ-P-001 "API响应时间<200ms (95th percentile)" |
| 安全需求 | REQ-S-XXX | REQ-S-001 "系统应使用AES-256加密静态数据" |
| 可用性需求 | REQ-U-XXX | REQ-U-001 "新用户应在5分钟内完成注册" |
| 监管需求 | REQ-R-XXX | REQ-R-001 "系统应符合HIPAA安全规则" |
| 风险控制需求 | REQ-RC-XXX | REQ-RC-001 "系统应限制血糖输入范围20-600 mg/dL" (来自H-001) |

### 4.3 需求管理工具
**工具**: [x] Jira  [ ] Azure DevOps  [ ] 其他: _______

**需求追溯性**: 每个需求必须追溯到:
- **来源** (如:PDD-001第4.1节,FMEA H-001)
- **设计** (如:SDD第3.2节)
- **实现** (如:Git commit #abc123)
- **验证** (如:测试用例TC-045)

### 4.4 需求变更控制
所有需求变更必须遵循**变更控制流程** (SOP-006):
1. 提交变更请求(Change Request, CR)
2. 影响分析(安全性,风险,进度)
3. 变更控制委员会(CCB)审批
4. 实施变更并更新追溯矩阵

---

## 5. 软件设计(IEC 62304 § 5.3 & 5.4)

### 5.1 架构设计(High-Level Design)
**交付物**: 软件设计文档(SDD-001)

**架构模式**:
- 前端:React Native(移动) + React.js(Web)
- 后端:微服务架构(Python FastAPI)
- 数据库:PostgreSQL(主库) + Redis(缓存)
- 云平台:AWS

**架构图**: 见SDD-001第2节

### 5.2 SOUP(Software of Unknown Provenance)
所有第三方组件必须记录在**SOUP清单** (SOUP-001):

| SOUP名称 | 版本 | 用途 | 风险分析 | 验证方法 |
|---------|------|------|---------|---------|
| React Native | 0.72.6 | 移动前端框架 | 低风险(成熟框架) | 集成测试 |
| FastAPI | 0.104.1 | 后端API框架 | 低风险 | 单元测试 |
| PostgreSQL | 15.3 | 数据库 | 中风险(数据完整性) | 备份测试 |
| AWS SDK | 1.28.0 | 云服务集成 | 中风险(可用性) | 集成测试 |
| [待补充] | | | | |

**SOUP管理要求**(IEC 62304 § 5.3.4):
- [ ] 记录SOUP的已知异常(Known Anomalies)
- [ ] 定期检查SOUP安全公告(CVE)
- [ ] 评估SOUP更新对软件安全性的影响

### 5.3 详细设计(Detailed Design)
对于Class B软件,详细设计可通过以下方式记录:
- **代码注释** (关键算法必须注释)
- **设计文档** (复杂模块,如推荐算法)
- **API文档** (使用Swagger/OpenAPI)

---

## 6. 软件实现(IEC 62304 § 5.5)

### 6.1 编码标准
**前端(JavaScript/TypeScript)**:
- 遵循**ESLint Airbnb规范**
- 使用**Prettier**自动格式化
- 强制类型检查(TypeScript strict mode)

**后端(Python)**:
- 遵循**PEP 8**编码规范
- 使用**Black**自动格式化
- 使用**mypy**静态类型检查

### 6.2 版本控制
**工具**: Git + GitHub Enterprise
**分支策略**:
- `main`: 生产版本(受保护)
- `develop`: 开发集成分支
- `feature/XXX`: 功能分支
- `hotfix/XXX`: 紧急修复分支

**提交规范** (Conventional Commits):
```
<type>(<scope>): <subject>

类型(type):
- feat: 新功能
- fix: Bug修复
- docs: 文档更新
- test: 测试相关
- refactor: 代码重构

示例:
feat(auth): add multi-factor authentication (REQ-S-015)
fix(api): validate blood glucose input range (H-001)
```

### 6.3 代码审查(Code Review)
**要求**:
- 所有代码必须经过至少1名同事审查
- 使用Pull Request机制
- 审查清单:
  - [ ] 代码符合编码标准
  - [ ] 有充分的单元测试
  - [ ] 无明显安全漏洞
  - [ ] 关键代码有注释
  - [ ] 追溯到需求(在PR描述中注明REQ-XXX)

---

## 7. 软件验证(IEC 62304 § 5.5, 5.6, 5.7)

### 7.1 测试层次(V模型)
```
需求(SRS) ←→ 系统测试
   ↓              ↑
架构设计 ←→ 集成测试
   ↓              ↑
详细设计 ←→ 单元测试
```

### 7.2 单元测试
**覆盖率要求**: >80% (分支覆盖率)
**工具**:
- 前端:Jest
- 后端:pytest + coverage.py

**自动化**: 每次Git push自动运行(CI/CD)

### 7.3 集成测试
**测试内容**:
- API端点测试
- 数据库集成测试
- 第三方服务集成(如血糖仪蓝牙连接)

**工具**: Postman + Newman(自动化)

### 7.4 系统测试
**测试计划**: 见测试计划文档(STP-001)
**测试类型**:
- [ ] 功能测试(所有需求)
- [ ] 性能测试(负载测试,压力测试)
- [ ] 安全测试(渗透测试,OWASP Top 10)
- [ ] 可用性测试(15名真实用户)
- [ ] 兼容性测试(iOS 15-17, Android 11-14)
- [ ] 回归测试(自动化)

### 7.5 追溯性(Traceability)
**工具**: 追溯矩阵(RTM, Excel/Jira)

| 需求ID | 需求描述 | 设计 | 实现 | 测试用例 | 测试结果 | 状态 |
|-------|---------|------|------|---------|---------|------|
| REQ-F-001 | 用户录入血糖值 | SDD §3.1 | `BloodGlucoseInput.tsx` | TC-001 | ✅ Pass | 完成 |
| REQ-RC-001 | 血糖输入范围限制 | SDD §3.1.2 | `validation.py` | TC-015 | ✅ Pass | 完成 |
| ... | ... | ... | ... | ... | ... | ... |

---

## 8. 软件配置管理(IEC 62304 § 8)

### 8.1 配置项(Configuration Items)
所有以下项目受配置管理控制:
- [ ] 源代码(Git)
- [ ] 需求文档(SRS)
- [ ] 设计文档(SDD)
- [ ] 测试文档(STP, STR)
- [ ] 风险管理文件(FMEA)
- [ ] 构建脚本(Dockerfile, CI/CD配置)
- [ ] 第三方组件(SOUP清单)

### 8.2 版本标识
**格式**: 语义化版本(Semantic Versioning)
```
主版本.次版本.修订号
例: 1.2.3

主版本(Major): 不兼容的API变更
次版本(Minor): 向后兼容的新功能
修订号(Patch): 向后兼容的Bug修复
```

### 8.3 配置审计
**发布前审计清单**:
- [ ] 所有测试通过
- [ ] 所有需求已实现并验证(RTM检查)
- [ ] 所有高/中风险已缓解
- [ ] 代码审查完成
- [ ] 文档版本与代码版本一致
- [ ] 发布批准签署

---

## 9. 问题解决(IEC 62304 § 9)

### 9.1 问题分类
| 严重性 | 定义 | 响应时间 |
|-------|------|---------|
| **Critical** | 导致系统崩溃或数据丢失 | 4小时 |
| **High** | 核心功能失效 | 24小时 |
| **Medium** | 非核心功能失效 | 1周 |
| **Low** | 用户体验问题 | 下一版本 |

### 9.2 问题处理流程
1. **报告**: 用户/测试人员提交问题(Jira)
2. **分类**: 确定严重性和优先级
3. **分析**: 根因分析(Root Cause Analysis)
4. **风险评估**: 是否引入新风险?(评审RMP-001)
5. **修复**: 实施修复并测试
6. **验证**: 回归测试
7. **关闭**: 记录解决方案

---

## 10. 上市后软件维护(IEC 62304 § 6)

### 10.1 软件维护计划
- **监测**: 用户投诉,错误日志,性能指标
- **更新频率**:
  - 安全补丁:紧急发布(7天内)
  - Bug修复:每月1次(Patch版本)
  - 新功能:每季度1次(Minor版本)

### 10.2 软件更新分类
| 更新类型 | 监管影响 | 需Notified Body审批? |
|---------|---------|---------------------|
| **重大更新** (改变预期用途/风险) | ✅ 是 | ✅ 是 |
| **中度更新** (新功能,但不改变预期用途) | ⚠️ 可能 | ⚠️ 通知Notified Body |
| **轻微更新** (Bug修复,性能优化) | ❌ 否 | ❌ 否(但需记录) |

---

## 11. 文档交付清单

以下文档在软件发布前必须完成:

| 文档 | 编号 | 状态 | 负责人 | 截止日期 |
|------|------|------|--------|---------|
| **软件开发计划** | SDP-001 | ✅ 完成 | [姓名] | Week 2 |
| **软件需求规格** | SRS-001 | 🔄 进行中 | [姓名] | Week 8 |
| **软件设计文档** | SDD-001 | 🔄 进行中 | [姓名] | Week 10 |
| **SOUP清单** | SOUP-001 | 🔄 进行中 | [姓名] | Week 12 |
| **追溯矩阵** | RTM-001 | 🔄 进行中 | [姓名] | Week 40 |
| **测试计划** | STP-001 | ⏸ 待开始 | [姓名] | Week 12 |
| **测试报告** | STR-001 | ⏸ 待开始 | [姓名] | Week 42 |
| **软件发布记录** | SRR-001 | ⏸ 待开始 | [姓名] | Week 44 |

---

## 12. 合规性声明

本软件开发计划符合以下标准:
- [x] IEC 62304:2006 - 医疗器械软件生命周期过程
- [x] ISO 13485:2016 - 质量管理体系
- [x] ISO 14971:2019 - 风险管理(集成到开发流程)
- [x] EU MDR 2017/745 Annex I GSPR 17.1 & 17.2

---

## 13. 审批记录

| 角色 | 姓名 | 签名 | 日期 |
|------|------|------|------|
| 软件开发负责人 | [姓名] | | |
| 质量保证审核 | [姓名] | | |
| 监管事务审核 | [姓名] | | |
| 管理层批准 | [姓名] | | |

---

## 版本历史

| 版本 | 日期 | 作者 | 变更说明 |
|------|------|------|----------|
| v1.0 | 2025-10-10 | [姓名] | 初始版本 |

---

**下一步行动**:
1. [ ] 召集软件开发启动会(Kick-off)
2. [ ] 完成软件需求规格(SRS-001)
3. [ ] 完成软件架构设计(SDD-001)
4. [ ] 建立CI/CD流水线
5. [ ] 开始Sprint 1开发
