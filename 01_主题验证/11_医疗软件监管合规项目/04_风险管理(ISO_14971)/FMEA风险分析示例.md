# FMEA 风险分析工作表
## Failure Mode and Effects Analysis

**文档编号**: RISK-003
**版本**: v1.0
**日期**: 2025-10-10
**产品**: [产品名称]
**分析阶段**: [ ] 设计FMEA  [ ] 过程FMEA  [x] 使用FMEA

---

## 使用说明

本文档提供详细的FMEA示例,帮助团队识别、评估和控制医疗软件风险。每个风险场景都应遵循以下结构进行分析。

---

## FMEA风险分析表

### 风险 #1: 用户输入错误的血糖值

| 项目 | 内容 |
|------|------|
| **危害ID** | H-001 |
| **危害类别** | 数据完整性 - 不准确数据 |
| **危害描述** | 用户手动输入血糖值时,输入了错误的数值 |
| **危害情况(事件序列)** | 1. 用户测量血糖得到120 mg/dL<br>2. 用户误输入为12 mg/dL(遗漏0)<br>3. 应用将12 mg/dL记录为有效数据<br>4. 应用基于错误数据生成健康报告<br>5. 应用显示"严重低血糖警告"<br>6. 用户恐慌或采取不必要的行动(摄入过多糖分) |
| **可合理预见的误用?** | ✅ 是 (输入错误是常见的用户行为) |
| **潜在临床后果** | - 轻度场景:用户焦虑,摄入过多糖分→短期高血糖<br>- 严重场景:用户因错误警告频繁忽略真实低血糖警告 |
| **严重度(S)** - 初始 | **2 (轻微)** - 通常仅导致短期不适,门诊可纠正 |
| **概率(P)** - 初始 | **4 (可能)** - 用户每日输入多次,输入错误概率约3-5% |
| **初始风险评分** | **S × P = 8 (中风险)** |
| **初始风险等级** | ⚠️ **中风险 - 需ALARP** |

---

#### 风险控制措施

| 控制措施ID | 控制类型 | 措施描述 | 实施位置 | 责任人 | 验证方法 | 状态 |
|-----------|---------|---------|---------|--------|---------|------|
| **RC-001-1** | 固有安全设计 | **输入范围限制**:<br>- 限制血糖输入范围为20-600 mg/dL<br>- 超出范围禁止提交 | 前端代码:<br>`BloodGlucoseInput.tsx`<br>后端验证:<br>`validation.py` | 软件工程师 | 单元测试:<br>`test_input_validation.py` | ✅ 已实施 |
| **RC-001-2** | 保护措施 | **异常值二次确认**:<br>- 当输入值<70 mg/dL或>180 mg/dL时<br>- 弹出对话框:"您输入的血糖值为X,请确认是否正确?"<br>- 用户必须点击"确认"或"重新输入" | 前端代码:<br>`ConfirmationDialog.tsx` | 软件工程师 | 集成测试:<br>`test_abnormal_value_flow.py` | ✅ 已实施 |
| **RC-001-3** | 保护措施 | **视觉辅助**:<br>- 输入框显示单位(mg/dL)<br>- 使用颜色编码:绿色(正常),黄色(偏高/低),红色(危险) | 前端代码:<br>`BloodGlucoseInput.tsx` | UI/UX设计师 | 可用性测试 | ✅ 已实施 |
| **RC-001-4** | 使用信息 | **IFU说明**:<br>- 在使用说明书中包含正确输入血糖值的步骤<br>- 附图示例 | IFU文档:<br>第3.2节 | 技术文档工程师 | 可用性测试 | 🔄 进行中 |

---

#### 残余风险评估

| 项目 | 内容 |
|------|------|
| **残余严重度(S')** | **2 (轻微)** - 控制措施未改变严重度 |
| **残余概率(P')** | **2 (罕见)** - 二次确认机制显著降低错误概率至<0.1% |
| **残余风险评分** | **S' × P' = 4 (低风险)** |
| **残余风险等级** | ✅ **低风险 - 可接受** |
| **验证证据** | - 单元测试报告:`TestReport_InputValidation_v1.0.pdf`<br>- 可用性测试报告:`UsabilityTest_Report_v1.0.pdf` (15名用户,0次未检出错误) |
| **可追溯性** | 需求: `REQ-003` "系统应验证所有用户输入"<br>测试: `TC-015` "输入验证测试" |

---

### 风险 #2: 网络连接失败导致重要提醒未送达

| 项目 | 内容 |
|------|------|
| **危害ID** | H-002 |
| **危害类别** | 功能失效 - 网络连接失败 |
| **危害描述** | 用户的手机网络连接中断,导致服务器端生成的重要健康提醒(如用药提醒)无法及时送达 |
| **危害情况(事件序列)** | 1. 用户设置了每日8:00的胰岛素注射提醒<br>2. 8:00时用户手机处于飞行模式或无网络区域<br>3. 服务器推送通知失败<br>4. 用户未收到提醒,遗忘注射胰岛素<br>5. 用户血糖升高→高血糖症状 |
| **可合理预见的误用?** | ✅ 是 (网络不稳定是常见场景) |
| **潜在临床后果** | - 轻度场景:单次遗忘用药→短期高血糖(>200 mg/dL),下次用药时纠正<br>- 中度场景:连续多次遗忘→严重高血糖,需急诊就医 |
| **严重度(S)** - 初始 | **3 (严重)** - 可能需住院治疗(糖尿病酮症酸中毒DKA风险) |
| **概率(P)** - 初始 | **3 (偶尔)** - 网络中断发生概率约0.5%/天 |
| **初始风险评分** | **S × P = 9 (中风险)** |
| **初始风险等级** | ⚠️ **中风险 - 需ALARP** |

---

#### 风险控制措施

| 控制措施ID | 控制类型 | 措施描述 | 实施位置 | 责任人 | 验证方法 | 状态 |
|-----------|---------|---------|---------|--------|---------|------|
| **RC-002-1** | 固有安全设计 | **本地提醒备份**:<br>- 所有提醒同时在本地(设备端)和服务器端设置<br>- 本地提醒不依赖网络,使用设备系统通知<br>- 即使离线也能触发 | 移动端代码:<br>`LocalNotificationManager.swift` (iOS)<br>`LocalNotificationManager.kt` (Android) | 移动端工程师 | 集成测试:<br>飞行模式下提醒测试 | ✅ 已实施 |
| **RC-002-2** | 保护措施 | **网络状态检测与警告**:<br>- 应用检测网络连接状态<br>- 如连续24小时未联网,显示警告:<br>"您已离线24小时,部分功能可能受限,请检查网络" | 移动端代码:<br>`NetworkMonitor.tsx` | 移动端工程师 | 集成测试 | ✅ 已实施 |
| **RC-002-3** | 保护措施 | **重新连接后同步**:<br>- 网络恢复后,自动同步离线期间的数据<br>- 检查是否有未送达的重要提醒,如有则立即推送 | 后端代码:<br>`sync_service.py` | 后端工程师 | 集成测试 | ✅ 已实施 |
| **RC-002-4** | 使用信息 | **IFU警告**:<br>- 在使用说明书中明确说明:<br>"本应用的部分功能需要网络连接。请确保您的设备保持联网,以接收及时的健康提醒。" | IFU文档:<br>第2.1节"系统要求" | 技术文档工程师 | 文档审查 | ✅ 已完成 |

---

#### 残余风险评估

| 项目 | 内容 |
|------|------|
| **残余严重度(S')** | **3 (严重)** - 控制措施未改变严重度(最坏情况仍可能发生) |
| **残余概率(P')** | **1 (极罕见)** - 本地提醒备份机制将网络依赖降至<0.01% |
| **残余风险评分** | **S' × P' = 3 (低风险)** |
| **残余风险等级** | ✅ **低风险 - 可接受** |
| **验证证据** | - 集成测试报告:`TestReport_OfflineMode_v1.0.pdf`<br>- 现场测试:100名用户×30天,0次提醒遗漏 |
| **可追溯性** | 需求: `REQ-012` "系统应支持离线模式基本功能"<br>测试: `TC-045` "离线提醒测试" |

---

### 风险 #3: 算法错误导致错误的健康建议

| 项目 | 内容 |
|------|------|
| **危害ID** | H-003 |
| **危害类别** | 软件缺陷 - 算法逻辑错误 |
| **危害描述** | 健康建议生成算法存在逻辑缺陷,向用户提供了不当的饮食/运动建议 |
| **危害情况(事件序列)** | **示例场景**: 2型糖尿病患者合并慢性肾病(CKD)<br>1. 算法基于高血糖数据,建议用户"增加蛋白质摄入"(标准糖尿病饮食建议)<br>2. 但算法未考虑CKD患者需限制蛋白质摄入<br>3. 用户遵循建议,长期高蛋白饮食<br>4. 肾功能进一步恶化 |
| **可合理预见的误用?** | ❌ 否 (这是设计缺陷,非用户误用) |
| **潜在临床后果** | - 轻度场景:短期不当建议,用户自行纠正或咨询医生<br>- 严重场景:长期遵循错误建议→慢性并发症加重(肾衰竭进展) |
| **严重度(S)** - 初始 | **4 (危重)** - 可能导致永久性器官损害(肾衰竭) |
| **概率(P)** - 初始 | **2 (罕见)** - 假设算法经过验证,但特殊边缘病例可能被遗漏(0.01-0.1%) |
| **初始风险评分** | **S × P = 8 (中风险)** |
| **初始风险等级** | ⚠️ **中风险 - 需ALARP** |

---

#### 风险控制措施

| 控制措施ID | 控制类型 | 措施描述 | 实施位置 | 责任人 | 验证方法 | 状态 |
|-----------|---------|---------|---------|--------|---------|------|
| **RC-003-1** | 固有安全设计 | **多合并症检测**:<br>- 算法增加合并症检测模块<br>- 用户onboarding时收集合并症信息(CKD, 心脏病等)<br>- 算法针对不同合并症调整建议逻辑 | 后端代码:<br>`recommendation_engine.py`<br>`comorbidity_module.py` | 算法工程师<br>临床顾问 | - 算法验证测试(100个临床场景)<br>- 临床专家审查 | ✅ 已实施 |
| **RC-003-2** | 固有安全设计 | **保守建议策略**:<br>- 对于高风险建议(如饮食结构调整),算法采用保守策略<br>- 避免极端建议(如"大幅增加X摄入") | 后端代码:<br>`recommendation_engine.py` | 算法工程师 | 算法单元测试 | ✅ 已实施 |
| **RC-003-3** | 使用信息 | **免责声明与警告**:<br>- 在每条健康建议后显示:<br>"⚠️ 本建议仅供参考,不替代专业医疗建议。如您有合并症或特殊情况,请咨询医生。"<br>- 在IFU中明确说明建议的局限性 | 前端代码:<br>`RecommendationCard.tsx`<br>IFU文档 | 产品经理<br>技术文档工程师 | 可用性测试<br>文档审查 | ✅ 已完成 |
| **RC-003-4** | 使用信息 | **医生审查功能**:<br>- 如用户绑定了医生账户,建议先发送给医生审查<br>- 医生可修改或批准建议 | 后端代码:<br>`physician_review_module.py` | 后端工程师 | 集成测试 | 🔄 计划中 (v2.0) |
| **RC-003-5** | 保护措施 | **上市后监测**:<br>- 收集用户对建议的反馈("有帮助"/"不适用")<br>- 监测不良事件报告<br>- 定期更新算法(每6个月) | PMCF流程<br>SOP-009 | 监管事务 | 不良事件报告审查 | 🔄 持续进行 |

---

#### 残余风险评估

| 项目 | 内容 |
|------|------|
| **残余严重度(S')** | **4 (危重)** - 控制措施未改变严重度(最坏情况仍可能发生) |
| **残余概率(P')** | **1 (极罕见)** - 合并症检测+保守策略+临床审查将概率降至<0.01% |
| **残余风险评分** | **S' × P' = 4 (低风险)** |
| **残余风险等级** | ✅ **低风险 - 可接受** |
| **风险/效益判断** | ✅ **效益超越残余风险**:<br>- 效益:改善血糖控制,提高生活质量(证据:临床文献)<br>- 残余风险:极罕见的错误建议,且有多层保护(免责声明+医生审查) |
| **验证证据** | - 算法验证报告:`Algorithm_Validation_Report_v1.0.pdf` (100个临床场景,0次危险建议)<br>- 临床专家评审意见:`Clinical_Review_Report_v1.0.pdf` |
| **可追溯性** | 需求: `REQ-025` "系统应考虑用户合并症"<br>测试: `TC-078` "合并症算法测试" |

---

### 风险 #4: 未授权访问用户健康数据(网络安全)

| 项目 | 内容 |
|------|------|
| **危害ID** | H-004 |
| **危害类别** | 信息安全 - 隐私泄露 |
| **危害描述** | 黑客通过网络攻击(如SQL注入、XSS攻击)未授权访问后端数据库,窃取用户的受保护健康信息(PHI) |
| **危害情况(事件序列)** | 1. 黑客发现API端点存在SQL注入漏洞<br>2. 黑客利用漏洞访问数据库<br>3. 黑客下载包含姓名、出生日期、医疗记录的数据<br>4. 数据泄露被公开或出售 |
| **可合理预见的误用?** | ✅ 是 (网络攻击是可合理预见的威胁) |
| **潜在临床后果** | - **直接医疗危害**: 低(数据泄露本身不直接导致身体伤害)<br>- **间接危害**: 隐私侵犯→心理伤害(焦虑,信任丧失),潜在歧视风险 |
| **严重度(S)** - 初始 | **2 (轻微)** - 按ISO 14971,无直接身体伤害,但按GDPR/HIPAA属严重违规 |
| **概率(P)** - 初始 | **3 (偶尔)** - 医疗软件是常见攻击目标 |
| **初始风险评分** | **S × P = 6 (中风险)** |
| **初始风险等级** | ⚠️ **中风险 - 需ALARP** |
| **监管注意** | ⚠️ HIPAA违规可能导致巨额罚款($100-$50,000/条违规,最高$150万/年)<br>⚠️ GDPR违规可能罚款高达全球营业额4%或€2000万 |

---

#### 风险控制措施

| 控制措施ID | 控制类型 | 措施描述 | 实施位置 | 责任人 | 验证方法 | 状态 |
|-----------|---------|---------|---------|--------|---------|------|
| **RC-004-1** | 固有安全设计 | **静态加密(Encryption at Rest)**:<br>- 数据库中所有PHI字段使用AES-256加密<br>- 密钥存储在独立的密钥管理服务(AWS KMS) | 后端代码:<br>`encryption_service.py`<br>数据库schema | 后端工程师<br>安全工程师 | 渗透测试 | ✅ 已实施 |
| **RC-004-2** | 固有安全设计 | **传输加密(Encryption in Transit)**:<br>- 所有API通信强制使用TLS 1.3<br>- 禁用TLS 1.2及更早版本 | API Gateway<br>Nginx配置 | DevOps工程师 | SSL Labs测试<br>(评分A+) | ✅ 已实施 |
| **RC-004-3** | 保护措施 | **输入验证与参数化查询**:<br>- 所有用户输入进行严格验证(白名单)<br>- 使用ORM(SQLAlchemy)防止SQL注入<br>- 禁用直接SQL查询 | 后端代码:<br>所有API端点 | 后端工程师 | - SAST工具(SonarQube)<br>- 渗透测试 | ✅ 已实施 |
| **RC-004-4** | 保护措施 | **多因素认证(MFA)**:<br>- 强制所有用户启用MFA(SMS或Authenticator App)<br>- 管理员账户强制硬件密钥(YubiKey) | 认证服务:<br>`auth_service.py` | 安全工程师 | 集成测试 | ✅ 已实施 |
| **RC-004-5** | 保护措施 | **访问控制(RBAC)**:<br>- 基于角色的访问控制(患者/医生/管理员)<br>- 最小权限原则(Least Privilege)<br>- 审计日志记录所有数据访问 | 后端代码:<br>`rbac_middleware.py`<br>审计服务 | 后端工程师 | 渗透测试 | ✅ 已实施 |
| **RC-004-6** | 保护措施 | **渗透测试**:<br>- 上市前:第三方渗透测试(每年1次)<br>- 上市后:持续漏洞扫描(每月) | 外部服务 | CISO | 渗透测试报告 | 🔄 持续进行 |
| **RC-004-7** | 保护措施 | **事件响应计划**:<br>- 制定数据泄露响应SOP<br>- 72小时内通知监管机构(GDPR要求)<br>- 通知受影响用户 | SOP-010<br>事件响应手册 | CISO<br>监管事务 | 桌面演练 | ✅ 已完成 |

---

#### 残余风险评估

| 项目 | 内容 |
|------|------|
| **残余严重度(S')** | **2 (轻微)** - 控制措施未改变严重度 |
| **残余概率(P')** | **1 (极罕见)** - 多层防护(加密+MFA+渗透测试)将概率降至<0.01% |
| **残余风险评分** | **S' × P' = 2 (低风险)** |
| **残余风险等级** | ✅ **低风险 - 可接受** |
| **验证证据** | - 渗透测试报告:`PenetrationTest_Report_2025-09.pdf` (评级:低风险)<br>- HIPAA安全评估:`HIPAA_Security_Assessment_2025-09.pdf` |
| **可追溯性** | 需求: `REQ-040` "系统应符合HIPAA安全规则"<br>测试: `TC-120` "网络安全测试套件" |

---

## FMEA总结表

| 危害ID | 危害描述 | 初始风险 | 控制措施数 | 残余风险 | 状态 |
|-------|---------|---------|-----------|---------|------|
| H-001 | 用户输入错误血糖值 | 8 (中) | 4 | 4 (低) | ✅ 可接受 |
| H-002 | 网络中断导致提醒未送达 | 9 (中) | 4 | 3 (低) | ✅ 可接受 |
| H-003 | 算法错误导致错误建议 | 8 (中) | 5 | 4 (低) | ✅ 可接受 |
| H-004 | 未授权访问健康数据 | 6 (中) | 7 | 2 (低) | ✅ 可接受 |
| H-005 | [待补充] | - | - | - | 🔄 待分析 |
| ... | ... | ... | ... | ... | ... |

---

## 整体残余风险评价

### 所有残余风险汇总
- **不可接受(≥16)**: 0项 ✅
- **高风险(10-15)**: 0项 ✅
- **中风险(4-9)**: 0项 ✅
- **低风险(1-3)**: 4项 ✅

### 风险/效益结论
✅ **整体残余风险可接受**:
- 所有已识别风险均已降低至低风险等级
- 临床效益(改善血糖控制)明显超越残余风险
- 用户已被充分告知风险(IFU + 应用内警告)

---

## 下一步行动

1. [ ] **完成剩余风险识别** (H-005至H-050,目标:识别至少20个风险场景)
2. [ ] **实施所有"计划中"的风险控制措施**
3. [ ] **完成风险控制措施的验证** (所有测试报告)
4. [ ] **建立风险追溯矩阵(RTM)** (需求-风险-测试)
5. [ ] **编写风险管理报告** (RMR-001)
6. [ ] **向Notified Body提交风险分析** (作为技术文档的一部分)

---

## 审批记录

| 角色 | 姓名 | 签名 | 日期 |
|------|------|------|------|
| FMEA负责人 | [姓名] | | |
| 临床顾问 | [姓名] | | |
| 安全工程师 | [姓名] | | |
| 质量保证 | [姓名] | | |

---

**注意**: 本文档提供示例,实际项目中需根据具体产品功能识别所有合理可预见的风险。FDA和CE Mark审核时会重点检查风险分析的完整性和合理性。
